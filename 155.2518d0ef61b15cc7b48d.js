"use strict";(self.webpackChunkdashboard=self.webpackChunkdashboard||[]).push([[155],{155:(H,f,s)=>{s.r(f),s.d(f,{CitiesModule:()=>z});var C=s(8583),m=s(2340),t=s(7716),A=s(1841);let v=(()=>{class n{constructor(e){this.http=e}fetchCitiesList(e){return this.http.get(`${m.N.endPointUrl}admin/city-list`,{params:e})}addCity(e){return this.http.post(`${m.N.endPointUrl}admin/add-city`,e)}editCity(e,i){return this.http.put(`${m.N.endPointUrl}admin/update-city/${i}`,e)}deleteCity(e){return this.http.delete(`${m.N.endPointUrl}admin/delete-city/${e}`)}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(A.eN))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var p=s(5002),c=s(8966),b=s(690),_=s(5319),l=s(3679),u=s(7460),y=s(7093),M=s(7423),S=s(5245),h=s(7322),O=s(8833);function T(n,r){1&n&&(t.TgZ(0,"mat-error"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"validations.required")," "))}function w(n,r){1&n&&(t.TgZ(0,"mat-error"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"validations.required")," "))}function P(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"p",14),t.NdJ("click",function(){return t.CHM(e),t.oxw(),t.MAs(27).click()}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"general.uploadImg")))}function L(n,r){1&n&&(t.TgZ(0,"span",15),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"general.uploading")))}function I(n,r){if(1&n&&t._UZ(0,"img",16),2&n){const e=t.oxw();t.Q6J("src",e.imgLink,t.LSH)}}function q(n,r){1&n&&(t.TgZ(0,"mat-error"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"validations.required")," "))}function k(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"mat-dialog-actions"),t.TgZ(1,"div",17),t.TgZ(2,"button",18),t.NdJ("click",function(){return t.CHM(e),t.oxw().onAdd()}),t.TgZ(3,"span"),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=t.oxw();t.xp6(2),t.Q6J("disabled",e.cityForm.invalid||!e.imgLink.length),t.xp6(2),t.Oqu(t.lcZ(5,2,"citiesManagement.add"))}}function D(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"mat-dialog-actions"),t.TgZ(1,"div",19),t.TgZ(2,"button",20),t.NdJ("click",function(){return t.CHM(e),t.oxw().onSave()}),t.TgZ(3,"span"),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.qZA(),t._UZ(6,"span",21),t.TgZ(7,"button",22),t.NdJ("click",function(){return t.CHM(e),t.oxw().onCancel()}),t.TgZ(8,"span"),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=t.oxw();t.xp6(2),t.Q6J("disabled",e.cityForm.invalid||!e.imgLink.length),t.xp6(2),t.Oqu(t.lcZ(5,3,"couponsManagement.save")),t.xp6(5),t.Oqu(t.lcZ(10,5,"couponsManagement.cancel"))}}let x=(()=>{class n{constructor(e,i,a,o,d,g){this.data=e,this.dialogRef=i,this.fb=a,this.translateService=o,this.commonService=d,this.citiesManagementService=g,this.loading=!1,this.imgLink="",this.uploadLoading=!1,this.subscriptions=new _.w}ngOnInit(){this.initCityForm(),this.handleEditMode()}initCityForm(){this.cityForm=this.fb.group({en:[null,[p.kI.required]],ar:[null,[p.kI.required]],image_url:[null,[p.kI.required]]})}handleEditMode(){var e,i,a,o;"EDIT"===(null===(e=this.data)||void 0===e?void 0:e.mode)&&(this.cityForm.patchValue(null===(i=this.data)||void 0===i?void 0:i.cityData),this.imgLink=null===(o=null===(a=this.data)||void 0===a?void 0:a.cityData)||void 0===o?void 0:o.image_url)}getControl(e){return this.cityForm.get(e)}onAdd(){this.cityForm.valid&&this.imgLink.length&&(this.loading=!0,this.subscriptions.add(this.citiesManagementService.addCity(this.cityForm.value).subscribe({next:e=>{this.loading=!1,this.dialogRef.close({added:!0,addedItem:null==e?void 0:e.city}),this.commonService.handleSuccessMessage(this.translateService.instant("citiesManagement.addSuccess"),this.translateService.instant("general.success"))},error:e=>{this.loading=!1,this.commonService.handleErrorMessage(e.message)}})))}onSave(){this.cityForm.valid&&this.imgLink.length&&(this.loading=!0,this.subscriptions.add(this.citiesManagementService.editCity(this.cityForm.value,this.data.cityData.id).subscribe({next:e=>{this.loading=!1,this.dialogRef.close({updated:!0}),this.commonService.handleSuccessMessage(this.translateService.instant("citiesManagement.updateSuccess"),this.translateService.instant("general.success"))},error:e=>{this.loading=!1,this.commonService.handleErrorMessage(e.message)}})))}onCancel(){this.dialogRef.close()}uploadImg(e){this.uploadLoading=!0;const i=new FormData;i.append("images",e.target.files[0]),this.subscriptions.add(this.commonService.uploadImg(i).subscribe({next:a=>{var o;null===(o=this.getControl("image_url"))||void 0===o||o.patchValue(a.data[0].image_url),this.imgLink=a.data[0].image_url,this.uploadLoading=!1},error:a=>{this.uploadLoading=!1,this.commonService.handleErrorMessage(a.message)}}))}ngOnDestroy(){this.subscriptions.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(c.WI),t.Y36(c.so),t.Y36(l.qu),t.Y36(u.sK),t.Y36(b.v),t.Y36(v))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-add-cities"]],decls:32,vars:18,consts:[[1,"popup-container"],["mat-dialog-title","",1,"d-flex","align-items-center","head"],["fxFlex",""],["mat-icon-button","","matDialogClose","",1,"mat-close-modal"],[1,"content-wrapper"],[3,"formGroup"],["matInput","","formControlName","en","type","text","required",""],[4,"ngIf"],["matInput","","formControlName","ar","type","text","required",""],["class","label file-input",3,"click",4,"ngIf"],["class","text-muted py-3 ps-2 mb-5",4,"ngIf"],["type","file",1,"d-none",3,"change"],["inputFile",""],["class","city-img","alt","",3,"src",4,"ngIf"],[1,"label","file-input",3,"click"],[1,"text-muted","py-3","ps-2","mb-5"],["alt","",1,"city-img",3,"src"],[1,"d-flex","justify-content-center","w-100","mb-4","confirmation-btns"],["mat-stroked-button","",1,"btn","confirm-btn",3,"disabled","click"],[1,"d-flex","justify-content-center","w-100","mb-4","edit-btns"],["mat-stroked-button","",1,"btn","save-btn",3,"disabled","click"],[1,"mx-2"],["mat-flat-button","",1,"btn","cancel-btn",3,"click"]],template:function(e,i){if(1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t._UZ(2,"span",2),t.TgZ(3,"h5"),t._uU(4),t.ALo(5,"translate"),t.qZA(),t._UZ(6,"span",2),t.TgZ(7,"button",3),t.TgZ(8,"mat-icon"),t._uU(9,"close"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(10,"mat-dialog-content",4),t.TgZ(11,"form",5),t.TgZ(12,"mat-form-field"),t.TgZ(13,"mat-label"),t._uU(14),t.ALo(15,"translate"),t.qZA(),t._UZ(16,"input",6),t.YNc(17,T,3,3,"mat-error",7),t.qZA(),t.TgZ(18,"mat-form-field"),t.TgZ(19,"mat-label"),t._uU(20),t.ALo(21,"translate"),t.qZA(),t._UZ(22,"input",8),t.YNc(23,w,3,3,"mat-error",7),t.qZA(),t.YNc(24,P,3,3,"p",9),t.YNc(25,L,3,3,"span",10),t.TgZ(26,"input",11,12),t.NdJ("change",function(o){return i.uploadImg(o)}),t.qZA(),t.YNc(28,I,1,1,"img",13),t.YNc(29,q,3,3,"mat-error",7),t.qZA(),t.qZA(),t.YNc(30,k,6,4,"mat-dialog-actions",7),t.YNc(31,D,11,7,"mat-dialog-actions",7),t.qZA()),2&e){let a,o,d;t.xp6(4),t.hij(" ",t.lcZ(5,12,"ADD"===i.data.mode?"citiesManagement.addCity":"citiesManagement.editCity")," "),t.xp6(7),t.Q6J("formGroup",i.cityForm),t.xp6(3),t.Oqu(t.lcZ(15,14,"citiesManagement.nameEn")),t.xp6(3),t.Q6J("ngIf",(null==(a=i.getControl("en"))?null:a.touched)&&(null==(a=i.getControl("en"))||null==a.errors?null:a.errors.required)),t.xp6(3),t.Oqu(t.lcZ(21,16,"citiesManagement.nameAr")),t.xp6(3),t.Q6J("ngIf",(null==(o=i.getControl("ar"))?null:o.touched)&&(null==(o=i.getControl("ar"))||null==o.errors?null:o.errors.required)),t.xp6(1),t.Q6J("ngIf",!i.uploadLoading),t.xp6(1),t.Q6J("ngIf",i.uploadLoading),t.xp6(3),t.Q6J("ngIf","EDIT"===i.data.mode||"ADD"===i.data.mode&&(null==i.imgLink?null:i.imgLink.length)),t.xp6(1),t.Q6J("ngIf",null==(d=i.getControl("image_url"))||null==d.errors?null:d.errors.required),t.xp6(1),t.Q6J("ngIf","ADD"===(null==i.data?null:i.data.mode)),t.xp6(1),t.Q6J("ngIf","EDIT"===(null==i.data?null:i.data.mode))}},directives:[c.uh,y.yH,M.lW,c.ZT,S.Hw,c.xY,l._Y,l.JL,l.sg,h.KE,h.hX,O.Nt,l.Fj,l.JJ,l.u,l.Q7,C.O5,h.TO,c.H8],pipes:[u.X$],styles:[".head[_ngcontent-%COMP%]{justify-content:center!important}.head[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin-bottom:0}.mat-close-modal[_ngcontent-%COMP%]{line-height:1em!important}.content-wrapper[_ngcontent-%COMP%]{min-height:10em}.content-wrapper[_ngcontent-%COMP%]   .file-input[_ngcontent-%COMP%]{background-color:var(--text-primary);color:var(--white-color);padding:10px 18px;display:inline-block;cursor:pointer;border-radius:5px}.content-wrapper[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%;display:block;margin-bottom:1em}.confirm-btn[_ngcontent-%COMP%]{padding:6px 18px;line-height:1.7em;background-color:var(--text-primary);color:var(--white-color)!important;width:100%}.edit-btns[_ngcontent-%COMP%]   .save-btn[_ngcontent-%COMP%]{padding:6px 18px;line-height:1.7em;background-color:var(--text-primary);color:var(--white-color);width:40%}.edit-btns[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%]{width:40%}.city-img[_ngcontent-%COMP%]{margin-top:.5em;margin-bottom:1em;display:block;height:15em;border:1px solid #ddd;width:100%;object-fit:cover}"]}),n})();var U=s(1393),F=s(1576);function J(n,r){if(1&n&&t._UZ(0,"img",9),2&n){const e=r.$implicit;t.Q6J("src",null==e?null:e.image_url,t.LSH)("alt",null==e?null:e.en)}}const Y=function(){return[10,50,100]},E=function(n){return{image_url:n}};let N=(()=>{class n{constructor(e,i,a,o,d){this.translateService=e,this.citiesManagementService=i,this.dialog=a,this.commonService=o,this.cdr=d,this.citiesData=[],this.loading=!1,this.subscriptions=new _.w,this.columns=[{header:this.translateService.instant("citiesManagement.id"),field:"id",width:"20%"},{header:this.translateService.instant("citiesManagement.imageUrl"),field:"image_url",width:"20%"},{header:this.translateService.instant("citiesManagement.nameEn"),field:"en",width:"20%"},{header:this.translateService.instant("citiesManagement.nameAr"),field:"ar",width:"20%"},{header:this.translateService.instant("citiesManagement.actions"),field:"operation",width:"20%",type:"button",buttons:[{color:"info",type:"icon",icon:"edit",tooltip:this.translateService.instant("citiesManagement.edit"),click:g=>this.onEditCity(g)},{color:"warn",type:"icon",icon:"delete",tooltip:this.translateService.instant("citiesManagement.delete"),click:g=>this.onDeleteCity(g)}]}],this.filterCriteria={page:0,pageSize:10},this.totalItemsCount=0}ngOnInit(){this.fetchCitiesList()}fetchCitiesList(){this.loading=!0,this.subscriptions.add(this.citiesManagementService.fetchCitiesList(Object.assign(Object.assign({},this.filterCriteria),{page:this.filterCriteria.page+1})).subscribe({next:e=>{var i,a;(null==e?void 0:e.successful)&&(this.loading=!1,this.citiesData=e.coupons.data,this.totalItemsCount=null===(a=null===(i=null==e?void 0:e.coupons)||void 0===i?void 0:i.meta)||void 0===a?void 0:a.total),this.loading=!1,this.cdr.detectChanges()},error:e=>{this.loading=!1,this.cdr.detectChanges(),this.commonService.handleErrorMessage(e.message)}}))}onAddCity(){const i=this.dialog.open(x,{disableClose:!0,width:"600px",panelClass:["main-popup"],data:{couponData:{},mode:"ADD"}}).afterClosed().subscribe(a=>{i.unsubscribe(),(null==a?void 0:a.added)&&this.fetchCitiesList()})}onEditCity(e){const a=this.dialog.open(x,{disableClose:!0,width:"600px",panelClass:["main-popup"],data:{cityData:e,mode:"EDIT"}}).afterClosed().subscribe(o=>{a.unsubscribe(),(null==o?void 0:o.updated)&&this.fetchCitiesList()})}onPageChanged(e){this.filterCriteria.page=null==e?void 0:e.pageIndex,this.filterCriteria.pageSize=e.pageSize,this.fetchCitiesList()}onDeleteCity(e){const i=this.dialog.open(U.S,{disableClose:!0,width:"600px",panelClass:["main-popup"],data:{popupHeading:this.translateService.instant("general.warning"),contentMsg:this.translateService.instant("citiesManagement.deleteConfirmation"),cancelBtnText:this.translateService.instant("general.cancel"),confirmBtnText:this.translateService.instant("general.confirm")}}),a=i.componentInstance.confirmationEmitter.subscribe(o=>{o?this.deleteCity(e,i):i.close(),a.unsubscribe()})}deleteCity(e,i){this.subscriptions.add(this.citiesManagementService.deleteCity(e.id).subscribe({next:()=>{i.close(),this.commonService.handleSuccessMessage(this.translateService.instant("citiesManagement.deleteSuccess"),this.translateService.instant("general.success"))},error:a=>{this.commonService.handleErrorMessage(a.message)},complete:()=>{this.fetchCitiesList()}}))}ngOnDestroy(){this.subscriptions.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(u.sK),t.Y36(v),t.Y36(c.uw),t.Y36(b.v),t.Y36(t.sBO))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-cities-management"]],decls:14,vars:26,consts:[[1,"container-fluid","pt-3","pb-4"],[1,"row","pb-4"],[1,"col-lg-6","col-md-6","col-sm-12","title-row"],[1,"title"],[1,"col-lg-6","col-md-6","col-sm-12","button-container"],["mat-raised-button","",1,"btn",3,"click"],[1,"row","table-row"],[3,"data","columns","length","loading","columnResizable","rowSelectable","hideRowSelectionCheckbox","rowHover","rowStriped","columnMovable","expandable","pageOnFront","showPaginator","pageSizeOptions","pageIndex","pageSize","cellTemplate","page"],["image_url",""],[1,"cover-photo",3,"src","alt"]],template:function(e,i){if(1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t.TgZ(3,"h3",3),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.qZA(),t.TgZ(6,"div",4),t.TgZ(7,"button",5),t.NdJ("click",function(){return i.onAddCity()}),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(10,"div",6),t.TgZ(11,"mtx-grid",7),t.NdJ("page",function(o){return i.onPageChanged(o)}),t.qZA(),t.YNc(12,J,1,2,"ng-template",null,8,t.W1O),t.qZA(),t.qZA()),2&e){const a=t.MAs(13);t.xp6(4),t.Oqu(t.lcZ(5,19,"menu.CitiesManagement")),t.xp6(4),t.Oqu(t.lcZ(9,21,"citiesManagement.addCity")),t.xp6(3),t.Q6J("data",i.citiesData)("columns",i.columns)("length",i.totalItemsCount)("loading",i.loading)("columnResizable",!1)("rowSelectable",!1)("hideRowSelectionCheckbox",!0)("rowHover",!0)("rowStriped",!0)("columnMovable",!1)("expandable",!1)("pageOnFront",!1)("showPaginator",!0)("pageSizeOptions",t.DdM(23,Y))("pageIndex",0)("pageSize",5)("cellTemplate",t.VKq(24,E,a))}},directives:[M.lW,F.CM],pipes:[u.X$],styles:[".container-fluid[_ngcontent-%COMP%]{background-color:#f4f4f4}.title-row[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{border-inline-start:6px solid var(--text-primary);color:var(--text-primary);padding-inline-start:4px}.button-container[_ngcontent-%COMP%]{justify-content:end;text-align:end;padding-inline-end:5%}.button-container[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{background-color:var(--text-primary);color:var(--white-color)}.search-container[_ngcontent-%COMP%]{align-self:center}.search-container[_ngcontent-%COMP%]   .search-wrapper[_ngcontent-%COMP%]{background-color:#fff;padding:10px 20px;border-radius:30px;border:1px solid #CDCDCD;width:70%;overflow:hidden}@media (max-width: 1024px){.search-container[_ngcontent-%COMP%]   .search-wrapper[_ngcontent-%COMP%]{width:90%}}@media (max-width: 576px){.search-container[_ngcontent-%COMP%]   .search-wrapper[_ngcontent-%COMP%]{width:100%;padding:8px 10px}}.search-container[_ngcontent-%COMP%]   .search-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background-color:transparent;border:none;font-size:14px;box-shadow:none;width:90%}.search-container[_ngcontent-%COMP%]   .search-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{box-shadow:none;outline:none}.search-container[_ngcontent-%COMP%]   .search-wrapper[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{vertical-align:middle}.filter-container[_ngcontent-%COMP%]{justify-content:end;text-align:end}@media (max-width: 768px){.filter-container[_ngcontent-%COMP%]{margin-top:1em;justify-content:start;text-align:start}}.filter-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:50%;display:inline-block;padding-right:1em;padding-left:1em}.cover-photo[_ngcontent-%COMP%]{width:100px;height:100px;border-radius:5px;object-fit:cover}"]}),n})();var Z=s(3423);const j=[{component:N,path:""}];let R=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[Z.Bz.forChild(j)],Z.Bz]}),n})();var Q=s(4284);let z=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[C.ez,R,l.u5,l.UX,Q.m8]]}),n})()}}]);