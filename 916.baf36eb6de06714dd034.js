"use strict";(self.webpackChunkdashboard=self.webpackChunkdashboard||[]).push([[916],{690:(vs,bn,ct)=>{ct.d(bn,{v:()=>Ke});var u=ct(2340),E=ct(7716),H=ct(2290),Cn=ct(7460),Ze=ct(8583),Ue=ct(1841);let Ke=(()=>{class m{constructor(rt,St,ie,N){this.toaster=rt,this.translateService=St,this.datePipe=ie,this.http=N}dateMapping(rt,St){return this.datePipe.transform(rt,St)}handleSuccessMessage(rt,St){this.toaster.success(rt,St)}handleErrorMessage(rt){this.toaster.error(rt,this.translateService.instant("general.error"))}uploadImg(rt){return this.http.post(`${u.N.endPointUrl}user/hosting/upload-images`,rt)}}return m.\u0275fac=function(rt){return new(rt||m)(E.LFG(H._W),E.LFG(Cn.sK),E.LFG(Ze.uU),E.LFG(Ue.eN))},m.\u0275prov=E.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),m})()},5002:(vs,bn,ct)=>{ct.d(bn,{ML:()=>Jf,Mn:()=>Mf,tP:()=>bu,FP:()=>wf,kI:()=>Tf});var u=ct(7716),E=ct(3679);function H(n){this.content=n}H.prototype={constructor:H,find:function(n){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===n)return t;return-1},get:function(n){var t=this.find(n);return-1==t?void 0:this.content[t+1]},update:function(n,t,e){var r=e&&e!=n?this.remove(e):this,o=r.find(n),i=r.content.slice();return-1==o?i.push(e||n,t):(i[o+1]=t,e&&(i[o]=e)),new H(i)},remove:function(n){var t=this.find(n);if(-1==t)return this;var e=this.content.slice();return e.splice(t,2),new H(e)},addToStart:function(n,t){return new H([n,t].concat(this.remove(n).content))},addToEnd:function(n,t){var e=this.remove(n).content.slice();return e.push(n,t),new H(e)},addBefore:function(n,t,e){var r=this.remove(t),o=r.content.slice(),i=r.find(n);return o.splice(-1==i?o.length:i,0,t,e),new H(o)},forEach:function(n){for(var t=0;t<this.content.length;t+=2)n(this.content[t],this.content[t+1])},prepend:function(n){return(n=H.from(n)).size?new H(n.content.concat(this.subtract(n).content)):this},append:function(n){return(n=H.from(n)).size?new H(this.subtract(n).content.concat(n.content)):this},subtract:function(n){var t=this;n=H.from(n);for(var e=0;e<n.content.length;e+=2)t=t.remove(n.content[e]);return t},get size(){return this.content.length>>1}},H.from=function(n){if(n instanceof H)return n;var t=[];if(n)for(var e in n)t.push(e,n[e]);return new H(t)};const Ze=H;function Ue(n,t,e){for(var r=0;;r++){if(r==n.childCount||r==t.childCount)return n.childCount==t.childCount?null:e;var o=n.child(r),i=t.child(r);if(o!=i){if(!o.sameMarkup(i))return e;if(o.isText&&o.text!=i.text){for(var s=0;o.text[s]==i.text[s];s++)e++;return e}if(o.content.size||i.content.size){var a=Ue(o.content,i.content,e+1);if(null!=a)return a}e+=o.nodeSize}else e+=o.nodeSize}}function Ke(n,t,e,r){for(var o=n.childCount,i=t.childCount;;){if(0==o||0==i)return o==i?null:{a:e,b:r};var s=n.child(--o),a=t.child(--i),c=s.nodeSize;if(s!=a){if(!s.sameMarkup(a))return{a:e,b:r};if(s.isText&&s.text!=a.text){for(var l=0,f=Math.min(s.text.length,a.text.length);l<f&&s.text[s.text.length-l-1]==a.text[a.text.length-l-1];)l++,e--,r--;return{a:e,b:r}}if(s.content.size||a.content.size){var p=Ke(s.content,a.content,e-1,r-1);if(p)return p}e-=c,r-=c}else e-=c,r-=c}}var m=function(t,e){if(this.content=t,this.size=e||0,null==e)for(var r=0;r<t.length;r++)this.size+=t[r].nodeSize},oe={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};m.prototype.nodesBetween=function(t,e,r,o,i){void 0===o&&(o=0);for(var s=0,a=0;a<e;s++){var c=this.content[s],l=a+c.nodeSize;if(l>t&&!1!==r(c,o+a,i,s)&&c.content.size){var f=a+1;c.nodesBetween(Math.max(0,t-f),Math.min(c.content.size,e-f),r,o+f)}a=l}},m.prototype.descendants=function(t){this.nodesBetween(0,this.size,t)},m.prototype.textBetween=function(t,e,r,o){var i="",s=!0;return this.nodesBetween(t,e,function(a,c){a.isText?(i+=a.text.slice(Math.max(t,c)-c,e-c),s=!r):a.isLeaf&&o?(i+="function"==typeof o?o(a):o,s=!r):!s&&a.isBlock&&(i+=r,s=!0)},0),i},m.prototype.append=function(t){if(!t.size)return this;if(!this.size)return t;var e=this.lastChild,r=t.firstChild,o=this.content.slice(),i=0;for(e.isText&&e.sameMarkup(r)&&(o[o.length-1]=e.withText(e.text+r.text),i=1);i<t.content.length;i++)o.push(t.content[i]);return new m(o,this.size+t.size)},m.prototype.cut=function(t,e){if(null==e&&(e=this.size),0==t&&e==this.size)return this;var r=[],o=0;if(e>t)for(var i=0,s=0;s<e;i++){var a=this.content[i],c=s+a.nodeSize;c>t&&((s<t||c>e)&&(a=a.isText?a.cut(Math.max(0,t-s),Math.min(a.text.length,e-s)):a.cut(Math.max(0,t-s-1),Math.min(a.content.size,e-s-1))),r.push(a),o+=a.nodeSize),s=c}return new m(r,o)},m.prototype.cutByIndex=function(t,e){return t==e?m.empty:0==t&&e==this.content.length?this:new m(this.content.slice(t,e))},m.prototype.replaceChild=function(t,e){var r=this.content[t];if(r==e)return this;var o=this.content.slice(),i=this.size+e.nodeSize-r.nodeSize;return o[t]=e,new m(o,i)},m.prototype.addToStart=function(t){return new m([t].concat(this.content),this.size+t.nodeSize)},m.prototype.addToEnd=function(t){return new m(this.content.concat(t),this.size+t.nodeSize)},m.prototype.eq=function(t){if(this.content.length!=t.content.length)return!1;for(var e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0},oe.firstChild.get=function(){return this.content.length?this.content[0]:null},oe.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null},oe.childCount.get=function(){return this.content.length},m.prototype.child=function(t){var e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e},m.prototype.maybeChild=function(t){return this.content[t]},m.prototype.forEach=function(t){for(var e=0,r=0;e<this.content.length;e++){var o=this.content[e];t(o,r,e),r+=o.nodeSize}},m.prototype.findDiffStart=function(t,e){return void 0===e&&(e=0),Ue(this,t,e)},m.prototype.findDiffEnd=function(t,e,r){return void 0===e&&(e=this.size),void 0===r&&(r=t.size),Ke(this,t,e,r)},m.prototype.findIndex=function(t,e){if(void 0===e&&(e=-1),0==t)return St(0,t);if(t==this.size)return St(this.content.length,t);if(t>this.size||t<0)throw new RangeError("Position "+t+" outside of fragment ("+this+")");for(var r=0,o=0;;r++){var s=o+this.child(r).nodeSize;if(s>=t)return s==t||e>0?St(r+1,s):St(r,o);o=s}},m.prototype.toString=function(){return"<"+this.toStringInner()+">"},m.prototype.toStringInner=function(){return this.content.join(", ")},m.prototype.toJSON=function(){return this.content.length?this.content.map(function(t){return t.toJSON()}):null},m.fromJSON=function(t,e){if(!e)return m.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new m(e.map(t.nodeFromJSON))},m.fromArray=function(t){if(!t.length)return m.empty;for(var e,r=0,o=0;o<t.length;o++){var i=t[o];r+=i.nodeSize,o&&i.isText&&t[o-1].sameMarkup(i)?(e||(e=t.slice(0,o)),e[e.length-1]=i.withText(e[e.length-1].text+i.text)):e&&e.push(i)}return new m(e||t,r)},m.from=function(t){if(!t)return m.empty;if(t instanceof m)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new m([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))},Object.defineProperties(m.prototype,oe);var rt={index:0,offset:0};function St(n,t){return rt.index=n,rt.offset=t,rt}function ie(n,t){if(n===t)return!0;if(!n||"object"!=typeof n||!t||"object"!=typeof t)return!1;var e=Array.isArray(n);if(Array.isArray(t)!=e)return!1;if(e){if(n.length!=t.length)return!1;for(var r=0;r<n.length;r++)if(!ie(n[r],t[r]))return!1}else{for(var o in n)if(!(o in t)||!ie(n[o],t[o]))return!1;for(var i in t)if(!(i in n))return!1}return!0}m.empty=new m([],0);var N=function(t,e){this.type=t,this.attrs=e};function wt(n){var t=Error.call(this,n);return t.__proto__=wt.prototype,t}N.prototype.addToSet=function(t){for(var e,r=!1,o=0;o<t.length;o++){var i=t[o];if(this.eq(i))return t;if(this.type.excludes(i.type))e||(e=t.slice(0,o));else{if(i.type.excludes(this.type))return t;!r&&i.type.rank>this.type.rank&&(e||(e=t.slice(0,o)),e.push(this),r=!0),e&&e.push(i)}}return e||(e=t.slice()),r||e.push(this),e},N.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t},N.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1},N.prototype.eq=function(t){return this==t||this.type==t.type&&ie(this.attrs,t.attrs)},N.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return t},N.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");var r=t.marks[e.type];if(!r)throw new RangeError("There is no mark type "+e.type+" in this schema");return r.create(e.attrs)},N.sameSet=function(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(!t[r].eq(e[r]))return!1;return!0},N.setFrom=function(t){if(!t||0==t.length)return N.none;if(t instanceof N)return[t];var e=t.slice();return e.sort(function(r,o){return r.type.rank-o.type.rank}),e},N.none=[],(wt.prototype=Object.create(Error.prototype)).constructor=wt,wt.prototype.name="ReplaceError";var b=function(t,e,r){this.content=t,this.openStart=e,this.openEnd=r},Rr={size:{configurable:!0}};function zr(n,t,e){var r=n.findIndex(t),o=r.index,i=r.offset,s=n.maybeChild(o),a=n.findIndex(e),c=a.index;if(i==t||s.isText){if(a.offset!=e&&!n.child(c).isText)throw new RangeError("Removing non-flat range");return n.cut(0,t).append(n.cut(e))}if(o!=c)throw new RangeError("Removing non-flat range");return n.replaceChild(o,s.copy(zr(s.content,t-i-1,e-i-1)))}function Fr(n,t,e,r){var o=n.findIndex(t),i=o.index,s=o.offset,a=n.maybeChild(i);if(s==t||a.isText)return r&&!r.canReplace(i,i,e)?null:n.cut(0,t).append(e).append(n.cut(t));var c=Fr(a.content,t-s-1,e);return c&&n.replaceChild(i,a.copy(c))}function ys(n,t,e){if(e.openStart>n.depth)throw new wt("Inserted content deeper than insertion position");if(n.depth-e.openStart!=t.depth-e.openEnd)throw new wt("Inconsistent open depths");return Br(n,t,e,0)}function Br(n,t,e,r){var o=n.index(r),i=n.node(r);if(o==t.index(r)&&r<n.depth-e.openStart){var s=Br(n,t,e,r+1);return i.copy(i.content.replaceChild(o,s))}if(e.content.size){if(e.openStart||e.openEnd||n.depth!=r||t.depth!=r){var l=function(n,t){for(var e=t.depth-n.openStart,o=t.node(e).copy(n.content),i=e-1;i>=0;i--)o=t.node(i).copy(m.from(o));return{start:o.resolveNoCache(n.openStart+e),end:o.resolveNoCache(o.content.size-n.openEnd-e)}}(e,n);return jt(i,Vr(n,l.start,l.end,t,r))}var a=n.parent,c=a.content;return jt(a,c.cut(0,n.parentOffset).append(e.content).append(c.cut(t.parentOffset)))}return jt(i,je(n,t,r))}function Lr(n,t){if(!t.type.compatibleContent(n.type))throw new wt("Cannot join "+t.type.name+" onto "+n.type.name)}function kn(n,t,e){var r=n.node(e);return Lr(r,t.node(e)),r}function Kt(n,t){var e=t.length-1;e>=0&&n.isText&&n.sameMarkup(t[e])?t[e]=n.withText(t[e].text+n.text):t.push(n)}function Ce(n,t,e,r){var o=(t||n).node(e),i=0,s=t?t.index(e):o.childCount;n&&(i=n.index(e),n.depth>e?i++:n.textOffset&&(Kt(n.nodeAfter,r),i++));for(var a=i;a<s;a++)Kt(o.child(a),r);t&&t.depth==e&&t.textOffset&&Kt(t.nodeBefore,r)}function jt(n,t){if(!n.type.validContent(t))throw new wt("Invalid content for node "+n.type.name);return n.copy(t)}function Vr(n,t,e,r,o){var i=n.depth>o&&kn(n,t,o+1),s=r.depth>o&&kn(e,r,o+1),a=[];return Ce(null,n,o,a),i&&s&&t.index(o)==e.index(o)?(Lr(i,s),Kt(jt(i,Vr(n,t,e,r,o+1)),a)):(i&&Kt(jt(i,je(n,t,o+1)),a),Ce(t,e,o,a),s&&Kt(jt(s,je(e,r,o+1)),a)),Ce(r,null,o,a),new m(a)}function je(n,t,e){var r=[];return Ce(null,n,e,r),n.depth>e&&Kt(jt(kn(n,t,e+1),je(n,t,e+1)),r),Ce(t,null,e,r),new m(r)}Rr.size.get=function(){return this.content.size-this.openStart-this.openEnd},b.prototype.insertAt=function(t,e){var r=Fr(this.content,t+this.openStart,e,null);return r&&new b(r,this.openStart,this.openEnd)},b.prototype.removeBetween=function(t,e){return new b(zr(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)},b.prototype.eq=function(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd},b.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"},b.prototype.toJSON=function(){if(!this.content.size)return null;var t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t},b.fromJSON=function(t,e){if(!e)return b.empty;var r=e.openStart||0,o=e.openEnd||0;if("number"!=typeof r||"number"!=typeof o)throw new RangeError("Invalid input for Slice.fromJSON");return new b(m.fromJSON(t,e.content),r,o)},b.maxOpen=function(t,e){void 0===e&&(e=!0);for(var r=0,o=0,i=t.firstChild;i&&!i.isLeaf&&(e||!i.type.spec.isolating);i=i.firstChild)r++;for(var s=t.lastChild;s&&!s.isLeaf&&(e||!s.type.spec.isolating);s=s.lastChild)o++;return new b(t,r,o)},Object.defineProperties(b.prototype,Rr),b.empty=new b(m.empty,0,0);var z=function(t,e,r){this.pos=t,this.path=e,this.depth=e.length/3-1,this.parentOffset=r},se={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};z.prototype.resolveDepth=function(t){return null==t?this.depth:t<0?this.depth+t:t},se.parent.get=function(){return this.node(this.depth)},se.doc.get=function(){return this.node(0)},z.prototype.node=function(t){return this.path[3*this.resolveDepth(t)]},z.prototype.index=function(t){return this.path[3*this.resolveDepth(t)+1]},z.prototype.indexAfter=function(t){return t=this.resolveDepth(t),this.index(t)+(t!=this.depth||this.textOffset?1:0)},z.prototype.start=function(t){return 0==(t=this.resolveDepth(t))?0:this.path[3*t-1]+1},z.prototype.end=function(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size},z.prototype.before=function(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]},z.prototype.after=function(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]+this.path[3*t].nodeSize},se.textOffset.get=function(){return this.pos-this.path[this.path.length-1]},se.nodeAfter.get=function(){var n=this.parent,t=this.index(this.depth);if(t==n.childCount)return null;var e=this.pos-this.path[this.path.length-1],r=n.child(t);return e?n.child(t).cut(e):r},se.nodeBefore.get=function(){var n=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(n).cut(0,t):0==n?null:this.parent.child(n-1)},z.prototype.posAtIndex=function(t,e){e=this.resolveDepth(e);for(var r=this.path[3*e],o=0==e?0:this.path[3*e-1]+1,i=0;i<t;i++)o+=r.child(i).nodeSize;return o},z.prototype.marks=function(){var t=this.parent,e=this.index();if(0==t.content.size)return N.none;if(this.textOffset)return t.child(e).marks;var r=t.maybeChild(e-1),o=t.maybeChild(e);if(!r){var i=r;r=o,o=i}for(var s=r.marks,a=0;a<s.length;a++)!1===s[a].type.spec.inclusive&&(!o||!s[a].isInSet(o.marks))&&(s=s[a--].removeFromSet(s));return s},z.prototype.marksAcross=function(t){var e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;for(var r=e.marks,o=t.parent.maybeChild(t.index()),i=0;i<r.length;i++)!1===r[i].type.spec.inclusive&&(!o||!r[i].isInSet(o.marks))&&(r=r[i--].removeFromSet(r));return r},z.prototype.sharedDepth=function(t){for(var e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0},z.prototype.blockRange=function(t,e){if(void 0===t&&(t=this),t.pos<this.pos)return t.blockRange(this);for(var r=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);r>=0;r--)if(t.pos<=this.end(r)&&(!e||e(this.node(r))))return new ke(this,t,r)},z.prototype.sameParent=function(t){return this.pos-this.parentOffset==t.pos-t.parentOffset},z.prototype.max=function(t){return t.pos>this.pos?t:this},z.prototype.min=function(t){return t.pos<this.pos?t:this},z.prototype.toString=function(){for(var t="",e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset},z.resolve=function(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");for(var r=[],o=0,i=e,s=t;;){var a=s.content.findIndex(i),c=a.index,l=a.offset,f=i-l;if(r.push(s,c,o+l),!f||(s=s.child(c)).isText)break;i=f-1,o+=l+1}return new z(e,r,i)},z.resolveCached=function(t,e){for(var r=0;r<Mn.length;r++){var o=Mn[r];if(o.pos==e&&o.doc==t)return o}var i=Mn[Sn]=z.resolve(t,e);return Sn=(Sn+1)%xs,i},Object.defineProperties(z.prototype,se);var Mn=[],Sn=0,xs=12,ke=function(t,e,r){this.$from=t,this.$to=e,this.depth=r},ae={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};ae.start.get=function(){return this.$from.before(this.depth+1)},ae.end.get=function(){return this.$to.after(this.depth+1)},ae.parent.get=function(){return this.$from.node(this.depth)},ae.startIndex.get=function(){return this.$from.index(this.depth)},ae.endIndex.get=function(){return this.$to.indexAfter(this.depth)},Object.defineProperties(ke.prototype,ae);var bs=Object.create(null),T=function(t,e,r,o){this.type=t,this.attrs=e,this.content=r||m.empty,this.marks=o||N.none},ut={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};ut.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size},ut.childCount.get=function(){return this.content.childCount},T.prototype.child=function(t){return this.content.child(t)},T.prototype.maybeChild=function(t){return this.content.maybeChild(t)},T.prototype.forEach=function(t){this.content.forEach(t)},T.prototype.nodesBetween=function(t,e,r,o){void 0===o&&(o=0),this.content.nodesBetween(t,e,r,o,this)},T.prototype.descendants=function(t){this.nodesBetween(0,this.content.size,t)},ut.textContent.get=function(){return this.textBetween(0,this.content.size,"")},T.prototype.textBetween=function(t,e,r,o){return this.content.textBetween(t,e,r,o)},ut.firstChild.get=function(){return this.content.firstChild},ut.lastChild.get=function(){return this.content.lastChild},T.prototype.eq=function(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)},T.prototype.sameMarkup=function(t){return this.hasMarkup(t.type,t.attrs,t.marks)},T.prototype.hasMarkup=function(t,e,r){return this.type==t&&ie(this.attrs,e||t.defaultAttrs||bs)&&N.sameSet(this.marks,r||N.none)},T.prototype.copy=function(t){return void 0===t&&(t=null),t==this.content?this:new this.constructor(this.type,this.attrs,t,this.marks)},T.prototype.mark=function(t){return t==this.marks?this:new this.constructor(this.type,this.attrs,this.content,t)},T.prototype.cut=function(t,e){return 0==t&&e==this.content.size?this:this.copy(this.content.cut(t,e))},T.prototype.slice=function(t,e,r){if(void 0===e&&(e=this.content.size),void 0===r&&(r=!1),t==e)return b.empty;var o=this.resolve(t),i=this.resolve(e),s=r?0:o.sharedDepth(e),a=o.start(s),l=o.node(s).content.cut(o.pos-a,i.pos-a);return new b(l,o.depth-s,i.depth-s)},T.prototype.replace=function(t,e,r){return ys(this.resolve(t),this.resolve(e),r)},T.prototype.nodeAt=function(t){for(var e=this;;){var r=e.content.findIndex(t),i=r.offset;if(!(e=e.maybeChild(r.index)))return null;if(i==t||e.isText)return e;t-=i+1}},T.prototype.childAfter=function(t){var e=this.content.findIndex(t),r=e.index,o=e.offset;return{node:this.content.maybeChild(r),index:r,offset:o}},T.prototype.childBefore=function(t){if(0==t)return{node:null,index:0,offset:0};var e=this.content.findIndex(t),r=e.index,o=e.offset;if(o<t)return{node:this.content.child(r),index:r,offset:o};var i=this.content.child(r-1);return{node:i,index:r-1,offset:o-i.nodeSize}},T.prototype.resolve=function(t){return z.resolveCached(this,t)},T.prototype.resolveNoCache=function(t){return z.resolve(this,t)},T.prototype.rangeHasMark=function(t,e,r){var o=!1;return e>t&&this.nodesBetween(t,e,function(i){return r.isInSet(i.marks)&&(o=!0),!o}),o},ut.isBlock.get=function(){return this.type.isBlock},ut.isTextblock.get=function(){return this.type.isTextblock},ut.inlineContent.get=function(){return this.type.inlineContent},ut.isInline.get=function(){return this.type.isInline},ut.isText.get=function(){return this.type.isText},ut.isLeaf.get=function(){return this.type.isLeaf},ut.isAtom.get=function(){return this.type.isAtom},T.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),Hr(this.marks,t)},T.prototype.contentMatchAt=function(t){var e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e},T.prototype.canReplace=function(t,e,r,o,i){void 0===r&&(r=m.empty),void 0===o&&(o=0),void 0===i&&(i=r.childCount);var s=this.contentMatchAt(t).matchFragment(r,o,i),a=s&&s.matchFragment(this.content,e);if(!a||!a.validEnd)return!1;for(var c=o;c<i;c++)if(!this.type.allowsMarks(r.child(c).marks))return!1;return!0},T.prototype.canReplaceWith=function(t,e,r,o){if(o&&!this.type.allowsMarks(o))return!1;var i=this.contentMatchAt(t).matchType(r),s=i&&i.matchFragment(this.content,e);return!!s&&s.validEnd},T.prototype.canAppend=function(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)},T.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));for(var t=N.none,e=0;e<this.marks.length;e++)t=this.marks[e].addToSet(t);if(!N.sameSet(t,this.marks))throw new RangeError("Invalid collection of marks for node "+this.type.name+": "+this.marks.map(function(r){return r.type.name}));this.content.forEach(function(r){return r.check()})},T.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map(function(r){return r.toJSON()})),t},T.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");var r=null;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=e.marks.map(t.markFromJSON)}if("text"==e.type){if("string"!=typeof e.text)throw new RangeError("Invalid text node in JSON");return t.text(e.text,r)}var o=m.fromJSON(t,e.content);return t.nodeType(e.type).create(e.attrs,o,r)},Object.defineProperties(T.prototype,ut);var Cs=function(n){function t(r,o,i,s){if(n.call(this,r,o,null,s),!i)throw new RangeError("Empty text nodes are not allowed");this.text=i}n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t;var e={textContent:{configurable:!0},nodeSize:{configurable:!0}};return t.prototype.toString=function(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Hr(this.marks,JSON.stringify(this.text))},e.textContent.get=function(){return this.text},t.prototype.textBetween=function(o,i){return this.text.slice(o,i)},e.nodeSize.get=function(){return this.text.length},t.prototype.mark=function(o){return o==this.marks?this:new t(this.type,this.attrs,this.text,o)},t.prototype.withText=function(o){return o==this.text?this:new t(this.type,this.attrs,o,this.marks)},t.prototype.cut=function(o,i){return void 0===o&&(o=0),void 0===i&&(i=this.text.length),0==o&&i==this.text.length?this:this.withText(this.text.slice(o,i))},t.prototype.eq=function(o){return this.sameMarkup(o)&&this.text==o.text},t.prototype.toJSON=function(){var o=n.prototype.toJSON.call(this);return o.text=this.text,o},Object.defineProperties(t.prototype,e),t}(T);function Hr(n,t){for(var e=n.length-1;e>=0;e--)t=n[e].type.name+"("+t+")";return t}var $=function(t){this.validEnd=t,this.next=[],this.wrapCache=[]},Qe={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};$.parse=function(t,e){var r=new Ye(t,e);if(null==r.next)return $.empty;var o=qr(r);r.next&&r.err("Unexpected trailing text");var i=function(n){var t=Object.create(null);return function e(r){var o=[];r.forEach(function(c){n[c].forEach(function(l){var f=l.term,p=l.to;if(f){var h=o.indexOf(f),d=h>-1&&o[h+1];Ur(n,p).forEach(function(g){d||o.push(f,d=[]),-1==d.indexOf(g)&&d.push(g)})}})});for(var i=t[r.join(",")]=new $(r.indexOf(n.length-1)>-1),s=0;s<o.length;s+=2){var a=o[s+1].sort(Zr);i.next.push(o[s],t[a.join(",")]||e(a))}return i}(Ur(n,0))}(function(n){var t=[[]];return o(function i(s,a){if("choice"==s.type)return s.exprs.reduce(function(C,_){return C.concat(i(_,a))},[]);if("seq"==s.type)for(var c=0;;c++){var l=i(s.exprs[c],a);if(c==s.exprs.length-1)return l;o(l,a=e())}else{if("star"==s.type){var f=e();return r(a,f),o(i(s.expr,f),f),[r(f)]}if("plus"==s.type){var p=e();return o(i(s.expr,a),p),o(i(s.expr,p),p),[r(p)]}if("opt"==s.type)return[r(a)].concat(i(s.expr,a));if("range"==s.type){for(var h=a,d=0;d<s.min;d++){var g=e();o(i(s.expr,h),g),h=g}if(-1==s.max)o(i(s.expr,h),h);else for(var v=s.min;v<s.max;v++){var x=e();r(h,x),o(i(s.expr,h),x),h=x}return[r(h)]}if("name"==s.type)return[r(a,null,s.value)]}}(n,0),e()),t;function e(){return t.push([])-1}function r(s,a,c){var l={term:c,to:a};return t[s].push(l),l}function o(s,a){s.forEach(function(c){return c.to=a})}}(o));return function(n,t){for(var e=0,r=[n];e<r.length;e++){for(var o=r[e],i=!o.validEnd,s=[],a=0;a<o.next.length;a+=2){var c=o.next[a],l=o.next[a+1];s.push(c.name),i&&!(c.isText||c.hasRequiredAttrs())&&(i=!1),-1==r.indexOf(l)&&r.push(l)}i&&t.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(i,r),i},$.prototype.matchType=function(t){for(var e=0;e<this.next.length;e+=2)if(this.next[e]==t)return this.next[e+1];return null},$.prototype.matchFragment=function(t,e,r){void 0===e&&(e=0),void 0===r&&(r=t.childCount);for(var o=this,i=e;o&&i<r;i++)o=o.matchType(t.child(i).type);return o},Qe.inlineContent.get=function(){var n=this.next[0];return!!n&&n.isInline},Qe.defaultType.get=function(){for(var n=0;n<this.next.length;n+=2){var t=this.next[n];if(!t.isText&&!t.hasRequiredAttrs())return t}},$.prototype.compatible=function(t){for(var e=0;e<this.next.length;e+=2)for(var r=0;r<t.next.length;r+=2)if(this.next[e]==t.next[r])return!0;return!1},$.prototype.fillBefore=function(t,e,r){void 0===e&&(e=!1),void 0===r&&(r=0);var o=[this];return function i(s,a){var c=s.matchFragment(t,r);if(c&&(!e||c.validEnd))return m.from(a.map(function(d){return d.createAndFill()}));for(var l=0;l<s.next.length;l+=2){var f=s.next[l],p=s.next[l+1];if(!f.isText&&!f.hasRequiredAttrs()&&-1==o.indexOf(p)){o.push(p);var h=i(p,a.concat(f));if(h)return h}}}(this,[])},$.prototype.findWrapping=function(t){for(var e=0;e<this.wrapCache.length;e+=2)if(this.wrapCache[e]==t)return this.wrapCache[e+1];var r=this.computeWrapping(t);return this.wrapCache.push(t,r),r},$.prototype.computeWrapping=function(t){for(var e=Object.create(null),r=[{match:this,type:null,via:null}];r.length;){var o=r.shift(),i=o.match;if(i.matchType(t)){for(var s=[],a=o;a.type;a=a.via)s.push(a.type);return s.reverse()}for(var c=0;c<i.next.length;c+=2){var l=i.next[c];!l.isLeaf&&!l.hasRequiredAttrs()&&!(l.name in e)&&(!o.type||i.next[c+1].validEnd)&&(r.push({match:l.contentMatch,type:l,via:o}),e[l.name]=!0)}}},Qe.edgeCount.get=function(){return this.next.length>>1},$.prototype.edge=function(t){var e=t<<1;if(e>=this.next.length)throw new RangeError("There's no "+t+"th edge in this content match");return{type:this.next[e],next:this.next[e+1]}},$.prototype.toString=function(){var t=[];return function e(r){t.push(r);for(var o=1;o<r.next.length;o+=2)-1==t.indexOf(r.next[o])&&e(r.next[o])}(this),t.map(function(r,o){for(var i=o+(r.validEnd?"*":" ")+" ",s=0;s<r.next.length;s+=2)i+=(s?", ":"")+r.next[s].name+"->"+t.indexOf(r.next[s+1]);return i}).join("\n")},Object.defineProperties($.prototype,Qe),$.empty=new $(!0);var Ye=function(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()},Jr={next:{configurable:!0}};function qr(n){var t=[];do{t.push(ks(n))}while(n.eat("|"));return 1==t.length?t[0]:{type:"choice",exprs:t}}function ks(n){var t=[];do{t.push(Ms(n))}while(n.next&&")"!=n.next&&"|"!=n.next);return 1==t.length?t[0]:{type:"seq",exprs:t}}function Ms(n){for(var t=function(n){if(n.eat("(")){var t=qr(n);return n.eat(")")||n.err("Missing closing paren"),t}if(!/\W/.test(n.next)){var e=function(n,t){var e=n.nodeTypes,r=e[t];if(r)return[r];var o=[];for(var i in e){var s=e[i];s.groups.indexOf(t)>-1&&o.push(s)}return 0==o.length&&n.err("No node type or group '"+t+"' found"),o}(n,n.next).map(function(r){return null==n.inline?n.inline=r.isInline:n.inline!=r.isInline&&n.err("Mixing inline and block content"),{type:"name",value:r}});return n.pos++,1==e.length?e[0]:{type:"choice",exprs:e}}n.err("Unexpected token '"+n.next+"'")}(n);;)if(n.eat("+"))t={type:"plus",expr:t};else if(n.eat("*"))t={type:"star",expr:t};else if(n.eat("?"))t={type:"opt",expr:t};else{if(!n.eat("{"))break;t=Ss(n,t)}return t}function Wr(n){/\D/.test(n.next)&&n.err("Expected number, got '"+n.next+"'");var t=Number(n.next);return n.pos++,t}function Ss(n,t){var e=Wr(n),r=e;return n.eat(",")&&(r="}"!=n.next?Wr(n):-1),n.eat("}")||n.err("Unclosed braced range"),{type:"range",min:e,max:r,expr:t}}function Zr(n,t){return t-n}function Ur(n,t){var e=[];return function r(o){var i=n[o];if(1==i.length&&!i[0].term)return r(i[0].to);e.push(o);for(var s=0;s<i.length;s++){var a=i[s],l=a.to;!a.term&&-1==e.indexOf(l)&&r(l)}}(t),e.sort(Zr)}function Kr(n){var t=Object.create(null);for(var e in n){var r=n[e];if(!r.hasDefault)return null;t[e]=r.default}return t}function jr(n,t){var e=Object.create(null);for(var r in n){var o=t&&t[r];if(void 0===o){var i=n[r];if(!i.hasDefault)throw new RangeError("No value supplied for attribute "+r);o=i.default}e[r]=o}return e}function Qr(n){var t=Object.create(null);if(n)for(var e in n)t[e]=new Yr(n[e]);return t}Jr.next.get=function(){return this.tokens[this.pos]},Ye.prototype.eat=function(t){return this.next==t&&(this.pos++||!0)},Ye.prototype.err=function(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")},Object.defineProperties(Ye.prototype,Jr);var ot=function(t,e,r){this.name=t,this.schema=e,this.spec=r,this.groups=r.group?r.group.split(" "):[],this.attrs=Qr(r.attrs),this.defaultAttrs=Kr(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(r.inline||"text"==t),this.isText="text"==t},ce={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0},whitespace:{configurable:!0}};ce.isInline.get=function(){return!this.isBlock},ce.isTextblock.get=function(){return this.isBlock&&this.inlineContent},ce.isLeaf.get=function(){return this.contentMatch==$.empty},ce.isAtom.get=function(){return this.isLeaf||this.spec.atom},ce.whitespace.get=function(){return this.spec.whitespace||(this.spec.code?"pre":"normal")},ot.prototype.hasRequiredAttrs=function(){for(var t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1},ot.prototype.compatibleContent=function(t){return this==t||this.contentMatch.compatible(t.contentMatch)},ot.prototype.computeAttrs=function(t){return!t&&this.defaultAttrs?this.defaultAttrs:jr(this.attrs,t)},ot.prototype.create=function(t,e,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new T(this,this.computeAttrs(t),m.from(e),N.setFrom(r))},ot.prototype.createChecked=function(t,e,r){if(e=m.from(e),!this.validContent(e))throw new RangeError("Invalid content for node "+this.name);return new T(this,this.computeAttrs(t),e,N.setFrom(r))},ot.prototype.createAndFill=function(t,e,r){if(t=this.computeAttrs(t),(e=m.from(e)).size){var o=this.contentMatch.fillBefore(e);if(!o)return null;e=o.append(e)}var i=this.contentMatch.matchFragment(e).fillBefore(m.empty,!0);return i?new T(this,t,e.append(i),N.setFrom(r)):null},ot.prototype.validContent=function(t){var e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(var r=0;r<t.childCount;r++)if(!this.allowsMarks(t.child(r).marks))return!1;return!0},ot.prototype.allowsMarkType=function(t){return null==this.markSet||this.markSet.indexOf(t)>-1},ot.prototype.allowsMarks=function(t){if(null==this.markSet)return!0;for(var e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0},ot.prototype.allowedMarks=function(t){if(null==this.markSet)return t;for(var e,r=0;r<t.length;r++)this.allowsMarkType(t[r].type)?e&&e.push(t[r]):e||(e=t.slice(0,r));return e?e.length?e:N.empty:t},ot.compile=function(t,e){var r=Object.create(null);t.forEach(function(s,a){return r[s]=new ot(s,e,a)});var o=e.spec.topNode||"doc";if(!r[o])throw new RangeError("Schema is missing its top node type ('"+o+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(var i in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r},Object.defineProperties(ot.prototype,ce);var Yr=function(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default"),this.default=t.default},Gr={isRequired:{configurable:!0}};Gr.isRequired.get=function(){return!this.hasDefault},Object.defineProperties(Yr.prototype,Gr);var Bt=function(t,e,r,o){this.name=t,this.schema=r,this.spec=o,this.attrs=Qr(o.attrs),this.rank=e,this.excluded=null;var i=Kr(this.attrs);this.instance=i&&new N(this,i)};Bt.prototype.create=function(t){return!t&&this.instance?this.instance:new N(this,jr(this.attrs,t))},Bt.compile=function(t,e){var r=Object.create(null),o=0;return t.forEach(function(i,s){return r[i]=new Bt(i,o++,e,s)}),r},Bt.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)t[e].type==this&&(t=t.slice(0,e).concat(t.slice(e+1)),e--);return t},Bt.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t[e]},Bt.prototype.excludes=function(t){return this.excluded.indexOf(t)>-1};var Qt=function(t){for(var e in this.spec={},t)this.spec[e]=t[e];this.spec.nodes=Ze.from(t.nodes),this.spec.marks=Ze.from(t.marks),this.nodes=ot.compile(this.spec.nodes,this),this.marks=Bt.compile(this.spec.marks,this);var r=Object.create(null);for(var o in this.nodes){if(o in this.marks)throw new RangeError(o+" can not be both a node and a mark");var i=this.nodes[o],s=i.spec.content||"",a=i.spec.marks;i.contentMatch=r[s]||(r[s]=$.parse(s,this.nodes)),i.inlineContent=i.contentMatch.inlineContent,i.markSet="_"==a?null:a?Xr(this,a.split(" ")):""!=a&&i.inlineContent?null:[]}for(var c in this.marks){var l=this.marks[c],f=l.spec.excludes;l.excluded=null==f?[l]:""==f?[]:Xr(this,f.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached=Object.create(null),this.cached.wrappings=Object.create(null)};function Xr(n,t){for(var e=[],r=0;r<t.length;r++){var o=t[r],i=n.marks[o],s=i;if(i)e.push(i);else for(var a in n.marks){var c=n.marks[a];("_"==o||c.spec.group&&c.spec.group.split(" ").indexOf(o)>-1)&&e.push(s=c)}if(!s)throw new SyntaxError("Unknown mark type: '"+t[r]+"'")}return e}Qt.prototype.node=function(t,e,r,o){if("string"==typeof t)t=this.nodeType(t);else{if(!(t instanceof ot))throw new RangeError("Invalid node type: "+t);if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}return t.createChecked(e,r,o)},Qt.prototype.text=function(t,e){var r=this.nodes.text;return new Cs(r,r.defaultAttrs,t,N.setFrom(e))},Qt.prototype.mark=function(t,e){return"string"==typeof t&&(t=this.marks[t]),t.create(e)},Qt.prototype.nodeFromJSON=function(t){return T.fromJSON(this,t)},Qt.prototype.markFromJSON=function(t){return N.fromJSON(this,t)},Qt.prototype.nodeType=function(t){var e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e};var dt=function(t,e){var r=this;this.schema=t,this.rules=e,this.tags=[],this.styles=[],e.forEach(function(o){o.tag?r.tags.push(o):o.style&&r.styles.push(o)}),this.normalizeLists=!this.tags.some(function(o){if(!/^(ul|ol)\b/.test(o.tag)||!o.node)return!1;var i=t.nodes[o.node];return i.contentMatch.matchType(i)})};dt.prototype.parse=function(t,e){void 0===e&&(e={});var r=new P(this,e,!1);return r.addAll(t,null,e.from,e.to),r.finish()},dt.prototype.parseSlice=function(t,e){void 0===e&&(e={});var r=new P(this,e,!0);return r.addAll(t,null,e.from,e.to),b.maxOpen(r.finish())},dt.prototype.matchTag=function(t,e,r){for(var o=r?this.tags.indexOf(r)+1:0;o<this.tags.length;o++){var i=this.tags[o];if(As(t,i.tag)&&(void 0===i.namespace||t.namespaceURI==i.namespace)&&(!i.context||e.matchesContext(i.context))){if(i.getAttrs){var s=i.getAttrs(t);if(!1===s)continue;i.attrs=s}return i}}},dt.prototype.matchStyle=function(t,e,r,o){for(var i=o?this.styles.indexOf(o)+1:0;i<this.styles.length;i++){var s=this.styles[i];if(!(0!=s.style.indexOf(t)||s.context&&!r.matchesContext(s.context)||s.style.length>t.length&&(61!=s.style.charCodeAt(t.length)||s.style.slice(t.length+1)!=e))){if(s.getAttrs){var a=s.getAttrs(e);if(!1===a)continue;s.attrs=a}return s}}},dt.schemaRules=function(t){var e=[];function r(c){for(var l=null==c.priority?50:c.priority,f=0;f<e.length;f++){var p=e[f];if((null==p.priority?50:p.priority)<l)break}e.splice(f,0,c)}var l,o=function(c){var l=t.marks[c].spec.parseDOM;l&&l.forEach(function(f){r(f=eo(f)),f.mark=c})};for(var i in t.marks)o(i);for(var a in t.nodes)l=void 0,(l=t.nodes[a].spec.parseDOM)&&l.forEach(function(f){r(f=eo(f)),f.node=a});return e},dt.fromSchema=function(t){return t.cached.domParser||(t.cached.domParser=new dt(t,dt.schemaRules(t)))};var wn={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Ds={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},$r={ol:!0,ul:!0};function to(n,t,e){return null!=t?(t?1:0)|("full"===t?2:0):n&&"pre"==n.whitespace?3:-5&e}var Dt=function(t,e,r,o,i,s,a){this.type=t,this.attrs=e,this.solid=i,this.match=s||(4&a?null:t.contentMatch),this.options=a,this.content=[],this.marks=r,this.activeMarks=N.none,this.pendingMarks=o,this.stashMarks=[]};Dt.prototype.findWrapping=function(t){if(!this.match){if(!this.type)return[];var e=this.type.contentMatch.fillBefore(m.from(t));if(!e){var o,r=this.type.contentMatch;return(o=r.findWrapping(t.type))?(this.match=r,o):null}this.match=this.type.contentMatch.matchFragment(e)}return this.match.findWrapping(t.type)},Dt.prototype.finish=function(t){if(!(1&this.options)){var r,e=this.content[this.content.length-1];e&&e.isText&&(r=/[ \t\r\n\u000c]+$/.exec(e.text))&&(e.text.length==r[0].length?this.content.pop():this.content[this.content.length-1]=e.withText(e.text.slice(0,e.text.length-r[0].length)))}var o=m.from(this.content);return!t&&this.match&&(o=o.append(this.match.fillBefore(m.empty,!0))),this.type?this.type.create(this.attrs,o,this.marks):o},Dt.prototype.popFromStashMark=function(t){for(var e=this.stashMarks.length-1;e>=0;e--)if(t.eq(this.stashMarks[e]))return this.stashMarks.splice(e,1)[0]},Dt.prototype.applyPending=function(t){for(var e=0,r=this.pendingMarks;e<r.length;e++){var o=r[e];(this.type?this.type.allowsMarkType(o.type):Rs(o.type,t))&&!o.isInSet(this.activeMarks)&&(this.activeMarks=o.addToSet(this.activeMarks),this.pendingMarks=o.removeFromSet(this.pendingMarks))}},Dt.prototype.inlineContext=function(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!wn.hasOwnProperty(t.parentNode.nodeName.toLowerCase())};var P=function(t,e,r){this.parser=t,this.options=e,this.isOpen=r;var i,o=e.topNode,s=to(null,e.preserveWhitespace,0)|(r?4:0);i=o?new Dt(o.type,o.attrs,N.none,N.none,!0,e.topMatch||o.type.contentMatch,s):new Dt(r?null:t.schema.topNodeType,null,N.none,N.none,!0,null,s),this.nodes=[i],this.open=0,this.find=e.findPositions,this.needsBlock=!1},Nn={top:{configurable:!0},currentPos:{configurable:!0}};function As(n,t){return(n.matches||n.msMatchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector).call(n,t)}function eo(n){var t={};for(var e in n)t[e]=n[e];return t}function Rs(n,t){var e=t.schema.nodes,r=function(s){var a=e[s];if(a.allowsMarkType(n)){var c=[],l=function(f){c.push(f);for(var p=0;p<f.edgeCount;p++){var h=f.edge(p),g=h.next;if(h.type==t||c.indexOf(g)<0&&l(g))return!0}};if(l(a.contentMatch))return{v:!0}}};for(var o in e){var i=r(o);if(i)return i.v}}Nn.top.get=function(){return this.nodes[this.open]},P.prototype.addDOM=function(t){if(3==t.nodeType)this.addTextNode(t);else if(1==t.nodeType){var e=t.getAttribute("style"),r=e?this.readStyles(function(n){for(var e,t=/\s*([\w-]+)\s*:\s*([^;]+)/g,r=[];e=t.exec(n);)r.push(e[1],e[2].trim());return r}(e)):null,o=this.top;if(null!=r)for(var i=0;i<r.length;i++)this.addPendingMark(r[i]);if(this.addElement(t),null!=r)for(var s=0;s<r.length;s++)this.removePendingMark(r[s],o)}},P.prototype.addTextNode=function(t){var e=t.nodeValue,r=this.top;if(2&r.options||r.inlineContext(t)||/[^ \t\r\n\u000c]/.test(e)){if(1&r.options)e=2&r.options?e.replace(/\r\n?/g,"\n"):e.replace(/\r?\n|\r/g," ");else if(e=e.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(e)&&this.open==this.nodes.length-1){var o=r.content[r.content.length-1],i=t.previousSibling;(!o||i&&"BR"==i.nodeName||o.isText&&/[ \t\r\n\u000c]$/.test(o.text))&&(e=e.slice(1))}e&&this.insertNode(this.parser.schema.text(e)),this.findInText(t)}else this.findInside(t)},P.prototype.addElement=function(t,e){var o,r=t.nodeName.toLowerCase();$r.hasOwnProperty(r)&&this.parser.normalizeLists&&function(n){for(var t=n.firstChild,e=null;t;t=t.nextSibling){var r=1==t.nodeType?t.nodeName.toLowerCase():null;r&&$r.hasOwnProperty(r)&&e?(e.appendChild(t),t=e):"li"==r?e=t:r&&(e=null)}}(t);var i=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(o=this.parser.matchTag(t,this,e));if(i?i.ignore:Ds.hasOwnProperty(r))this.findInside(t),this.ignoreFallback(t);else if(!i||i.skip||i.closeParent){i&&i.closeParent?this.open=Math.max(0,this.open-1):i&&i.skip.nodeType&&(t=i.skip);var s,a=this.top,c=this.needsBlock;if(wn.hasOwnProperty(r))s=!0,a.type||(this.needsBlock=!0);else if(!t.firstChild)return void this.leafFallback(t);this.addAll(t),s&&this.sync(a),this.needsBlock=c}else this.addElementByRule(t,i,!1===i.consuming?o:null)},P.prototype.leafFallback=function(t){"BR"==t.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode("\n"))},P.prototype.ignoreFallback=function(t){"BR"==t.nodeName&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))},P.prototype.readStyles=function(t){var e=N.none;t:for(var r=0;r<t.length;r+=2)for(var o=null;;){var i=this.parser.matchStyle(t[r],t[r+1],this,o);if(!i)continue t;if(i.ignore)return null;if(e=this.parser.schema.marks[i.mark].create(i.attrs).addToSet(e),!1!==i.consuming)break;o=i}return e},P.prototype.addElementByRule=function(t,e,r){var i,s,c,o=this;e.node?(s=this.parser.schema.nodes[e.node]).isLeaf?this.insertNode(s.create(e.attrs))||this.leafFallback(t):i=this.enter(s,e.attrs,e.preserveWhitespace):(c=this.parser.schema.marks[e.mark].create(e.attrs),this.addPendingMark(c));var l=this.top;if(s&&s.isLeaf)this.findInside(t);else if(r)this.addElement(t,r);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach(function(p){return o.insertNode(p)});else{var f=e.contentElement;"string"==typeof f?f=t.querySelector(f):"function"==typeof f&&(f=f(t)),f||(f=t),this.findAround(t,f,!0),this.addAll(f,i)}i&&(this.sync(l),this.open--),c&&this.removePendingMark(c,l)},P.prototype.addAll=function(t,e,r,o){for(var i=r||0,s=r?t.childNodes[r]:t.firstChild,a=null==o?null:t.childNodes[o];s!=a;s=s.nextSibling,++i)this.findAtPoint(t,i),this.addDOM(s),e&&wn.hasOwnProperty(s.nodeName.toLowerCase())&&this.sync(e);this.findAtPoint(t,i)},P.prototype.findPlace=function(t){for(var e,r,o=this.open;o>=0;o--){var i=this.nodes[o],s=i.findWrapping(t);if(s&&(!e||e.length>s.length)&&(e=s,r=i,!s.length)||i.solid)break}if(!e)return!1;this.sync(r);for(var a=0;a<e.length;a++)this.enterInner(e[a],null,!1);return!0},P.prototype.insertNode=function(t){if(t.isInline&&this.needsBlock&&!this.top.type){var e=this.textblockFromContext();e&&this.enterInner(e)}if(this.findPlace(t)){this.closeExtra();var r=this.top;r.applyPending(t.type),r.match&&(r.match=r.match.matchType(t.type));for(var o=r.activeMarks,i=0;i<t.marks.length;i++)(!r.type||r.type.allowsMarkType(t.marks[i].type))&&(o=t.marks[i].addToSet(o));return r.content.push(t.mark(o)),!0}return!1},P.prototype.enter=function(t,e,r){var o=this.findPlace(t.create(e));return o&&this.enterInner(t,e,!0,r),o},P.prototype.enterInner=function(t,e,r,o){this.closeExtra();var i=this.top;i.applyPending(t),i.match=i.match&&i.match.matchType(t,e);var s=to(t,o,i.options);4&i.options&&0==i.content.length&&(s|=4),this.nodes.push(new Dt(t,e,i.activeMarks,i.pendingMarks,r,null,s)),this.open++},P.prototype.closeExtra=function(t){var e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}},P.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)},P.prototype.sync=function(t){for(var e=this.open;e>=0;e--)if(this.nodes[e]==t)return void(this.open=e)},Nn.currentPos.get=function(){this.closeExtra();for(var n=0,t=this.open;t>=0;t--){for(var e=this.nodes[t].content,r=e.length-1;r>=0;r--)n+=e[r].nodeSize;t&&n++}return n},P.prototype.findAtPoint=function(t,e){if(this.find)for(var r=0;r<this.find.length;r++)this.find[r].node==t&&this.find[r].offset==e&&(this.find[r].pos=this.currentPos)},P.prototype.findInside=function(t){if(this.find)for(var e=0;e<this.find.length;e++)null==this.find[e].pos&&1==t.nodeType&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)},P.prototype.findAround=function(t,e,r){if(t!=e&&this.find)for(var o=0;o<this.find.length;o++)null==this.find[o].pos&&1==t.nodeType&&t.contains(this.find[o].node)&&e.compareDocumentPosition(this.find[o].node)&(r?2:4)&&(this.find[o].pos=this.currentPos)},P.prototype.findInText=function(t){if(this.find)for(var e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))},P.prototype.matchesContext=function(t){var e=this;if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);var r=t.split("/"),o=this.options.context,i=!(this.isOpen||o&&o.parent.type!=this.nodes[0].type),s=(i?0:1)-(o?o.depth+1:0),a=function(c,l){for(;c>=0;c--){var f=r[c];if(""==f){if(c==r.length-1||0==c)continue;for(;l>=s;l--)if(a(c-1,l))return!0;return!1}var p=l>0||0==l&&i?e.nodes[l].type:o&&l>=s?o.node(l-s).type:null;if(!p||p.name!=f&&-1==p.groups.indexOf(f))return!1;l--}return!0};return a(r.length-1,this.open)},P.prototype.textblockFromContext=function(){var t=this.options.context;if(t)for(var e=t.depth;e>=0;e--){var r=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(var o in this.parser.schema.nodes){var i=this.parser.schema.nodes[o];if(i.isTextblock&&i.defaultAttrs)return i}},P.prototype.addPendingMark=function(t){var e=function(n,t){for(var e=0;e<t.length;e++)if(n.eq(t[e]))return t[e]}(t,this.top.pendingMarks);e&&this.top.stashMarks.push(e),this.top.pendingMarks=t.addToSet(this.top.pendingMarks)},P.prototype.removePendingMark=function(t,e){for(var r=this.open;r>=0;r--){var o=this.nodes[r];if(o.pendingMarks.lastIndexOf(t)>-1)o.pendingMarks=t.removeFromSet(o.pendingMarks);else{o.activeMarks=t.removeFromSet(o.activeMarks);var s=o.popFromStashMark(t);s&&o.type&&o.type.allowsMarkType(s.type)&&(o.activeMarks=s.addToSet(o.activeMarks))}if(o==e)break}},Object.defineProperties(P.prototype,Nn);var Z=function(t,e){this.nodes=t||{},this.marks=e||{}};function no(n){var t={};for(var e in n){var r=n[e].spec.toDOM;r&&(t[e]=r)}return t}function On(n){return n.document||window.document}Z.prototype.serializeFragment=function(t,e,r){var o=this;void 0===e&&(e={}),r||(r=On(e).createDocumentFragment());var i=r,s=null;return t.forEach(function(a){if(s||a.marks.length){s||(s=[]);for(var c=0,l=0;c<s.length&&l<a.marks.length;){var f=a.marks[l];if(o.marks[f.type.name]){if(!f.eq(s[c])||!1===f.type.spec.spanning)break;c+=2,l++}else l++}for(;c<s.length;)i=s.pop(),s.pop();for(;l<a.marks.length;){var p=a.marks[l++],h=o.serializeMark(p,a.isInline,e);h&&(s.push(p,i),i.appendChild(h.dom),i=h.contentDOM||h.dom)}}i.appendChild(o.serializeNodeInner(a,e))}),r},Z.prototype.serializeNodeInner=function(t,e){void 0===e&&(e={});var r=Z.renderSpec(On(e),this.nodes[t.type.name](t)),o=r.dom,i=r.contentDOM;if(i){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");e.onContent?e.onContent(t,i,e):this.serializeFragment(t.content,e,i)}return o},Z.prototype.serializeNode=function(t,e){void 0===e&&(e={});for(var r=this.serializeNodeInner(t,e),o=t.marks.length-1;o>=0;o--){var i=this.serializeMark(t.marks[o],t.isInline,e);i&&((i.contentDOM||i.dom).appendChild(r),r=i.dom)}return r},Z.prototype.serializeMark=function(t,e,r){void 0===r&&(r={});var o=this.marks[t.type.name];return o&&Z.renderSpec(On(r),o(t,e))},Z.renderSpec=function(t,e,r){if(void 0===r&&(r=null),"string"==typeof e)return{dom:t.createTextNode(e)};if(null!=e.nodeType)return{dom:e};if(e.dom&&null!=e.dom.nodeType)return e;var o=e[0],i=o.indexOf(" ");i>0&&(r=o.slice(0,i),o=o.slice(i+1));var s=null,a=r?t.createElementNS(r,o):t.createElement(o),c=e[1],l=1;if(c&&"object"==typeof c&&null==c.nodeType&&!Array.isArray(c))for(var f in l=2,c)if(null!=c[f]){var p=f.indexOf(" ");p>0?a.setAttributeNS(f.slice(0,p),f.slice(p+1),c[f]):a.setAttribute(f,c[f])}for(var h=l;h<e.length;h++){var d=e[h];if(0===d){if(h<e.length-1||h>l)throw new RangeError("Content hole must be the only child of its parent node");return{dom:a,contentDOM:a}}var g=Z.renderSpec(t,d,r),x=g.contentDOM;if(a.appendChild(g.dom),x){if(s)throw new RangeError("Multiple content holes");s=x}}return{dom:a,contentDOM:s}},Z.fromSchema=function(t){return t.cached.domSerializer||(t.cached.domSerializer=new Z(this.nodesFromSchema(t),this.marksFromSchema(t)))},Z.nodesFromSchema=function(t){var e=no(t.nodes);return e.text||(e.text=function(r){return r.text}),e},Z.marksFromSchema=function(t){return no(t.marks)};var oo=Math.pow(2,16);function Fs(n,t){return n+t*oo}function io(n){return 65535&n}var Tn=function(t,e,r){void 0===e&&(e=!1),void 0===r&&(r=null),this.pos=t,this.deleted=e,this.recover=r},U=function n(t,e){if(void 0===e&&(e=!1),!t.length&&n.empty)return n.empty;this.ranges=t,this.inverted=e};U.prototype.recover=function(t){var n,e=0,r=io(t);if(!this.inverted)for(var o=0;o<r;o++)e+=this.ranges[3*o+2]-this.ranges[3*o+1];return this.ranges[3*r]+e+((n=t)-(65535&n))/oo},U.prototype.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},U.prototype.map=function(t,e){return void 0===e&&(e=1),this._map(t,e,!0)},U.prototype._map=function(t,e,r){for(var o=0,i=this.inverted?2:1,s=this.inverted?1:2,a=0;a<this.ranges.length;a+=3){var c=this.ranges[a]-(this.inverted?o:0);if(c>t)break;var l=this.ranges[a+i],f=this.ranges[a+s],p=c+l;if(t<=p){var d=c+o+((l?t==c?-1:t==p?1:e:e)<0?0:f);if(r)return d;var g=t==(e<0?c:p)?null:Fs(a/3,t-c);return new Tn(d,e<0?t!=c:t!=p,g)}o+=f-l}return r?t+o:new Tn(t+o)},U.prototype.touches=function(t,e){for(var r=0,o=io(e),i=this.inverted?2:1,s=this.inverted?1:2,a=0;a<this.ranges.length;a+=3){var c=this.ranges[a]-(this.inverted?r:0);if(c>t)break;var l=this.ranges[a+i];if(t<=c+l&&a==3*o)return!0;r+=this.ranges[a+s]-l}return!1},U.prototype.forEach=function(t){for(var e=this.inverted?2:1,r=this.inverted?1:2,o=0,i=0;o<this.ranges.length;o+=3){var s=this.ranges[o],a=s-(this.inverted?i:0),c=s+(this.inverted?0:i),l=this.ranges[o+e],f=this.ranges[o+r];t(a,a+l,c,c+f),i+=f-l}},U.prototype.invert=function(){return new U(this.ranges,!this.inverted)},U.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)},U.offset=function(t){return 0==t?U.empty:new U(t<0?[0,-t,0]:[0,0,t])},U.empty=new U([]);var tt=function(t,e,r,o){this.maps=t||[],this.from=r||0,this.to=null==o?this.maps.length:o,this.mirror=e};function le(n){var t=Error.call(this,n);return t.__proto__=le.prototype,t}tt.prototype.slice=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.maps.length),new tt(this.maps,this.mirror,t,e)},tt.prototype.copy=function(){return new tt(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)},tt.prototype.appendMap=function(t,e){this.to=this.maps.push(t),null!=e&&this.setMirror(this.maps.length-1,e)},tt.prototype.appendMapping=function(t){for(var e=0,r=this.maps.length;e<t.maps.length;e++){var o=t.getMirror(e);this.appendMap(t.maps[e],null!=o&&o<e?r+o:null)}},tt.prototype.getMirror=function(t){if(this.mirror)for(var e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]},tt.prototype.setMirror=function(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)},tt.prototype.appendMappingInverted=function(t){for(var e=t.maps.length-1,r=this.maps.length+t.maps.length;e>=0;e--){var o=t.getMirror(e);this.appendMap(t.maps[e].invert(),null!=o&&o>e?r-o-1:null)}},tt.prototype.invert=function(){var t=new tt;return t.appendMappingInverted(this),t},tt.prototype.map=function(t,e){if(void 0===e&&(e=1),this.mirror)return this._map(t,e,!0);for(var r=this.from;r<this.to;r++)t=this.maps[r].map(t,e);return t},tt.prototype.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},tt.prototype._map=function(t,e,r){for(var o=!1,i=this.from;i<this.to;i++){var a=this.maps[i].mapResult(t,e);if(null!=a.recover){var c=this.getMirror(i);if(null!=c&&c>i&&c<this.to){i=c,t=this.maps[c].recover(a.recover);continue}}a.deleted&&(o=!0),t=a.pos}return r?t:new Tn(t,o)},(le.prototype=Object.create(Error.prototype)).constructor=le,le.prototype.name="TransformError";var L=function(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new tt},En={before:{configurable:!0},docChanged:{configurable:!0}};function $e(){throw new Error("Override me")}En.before.get=function(){return this.docs.length?this.docs[0]:this.doc},L.prototype.step=function(t){var e=this.maybeStep(t);if(e.failed)throw new le(e.failed);return this},L.prototype.maybeStep=function(t){var e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e},En.docChanged.get=function(){return this.steps.length>0},L.prototype.addStep=function(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e},Object.defineProperties(L.prototype,En);var Dn=Object.create(null),et=function(){};et.prototype.apply=function(t){return $e()},et.prototype.getMap=function(){return U.empty},et.prototype.invert=function(t){return $e()},et.prototype.map=function(t){return $e()},et.prototype.merge=function(t){return null},et.prototype.toJSON=function(){return $e()},et.fromJSON=function(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");var r=Dn[e.stepType];if(!r)throw new RangeError("No step type "+e.stepType+" defined");return r.fromJSON(t,e)},et.jsonID=function(t,e){if(t in Dn)throw new RangeError("Duplicate use of step JSON ID "+t);return Dn[t]=e,e.prototype.jsonID=t,e};var it=function(t,e){this.doc=t,this.failed=e};it.ok=function(t){return new it(t,null)},it.fail=function(t){return new it(null,t)},it.fromReplace=function(t,e,r,o){try{return it.ok(t.replace(e,r,o))}catch(i){if(i instanceof wt)return it.fail(i.message);throw i}};var Lt=function(n){function t(e,r,o,i){n.call(this),this.from=e,this.to=r,this.slice=o,this.structure=!!i}return n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t,t.prototype.apply=function(r){return this.structure&&In(r,this.from,this.to)?it.fail("Structure replace would overwrite content"):it.fromReplace(r,this.from,this.to,this.slice)},t.prototype.getMap=function(){return new U([this.from,this.to-this.from,this.slice.size])},t.prototype.invert=function(r){return new t(this.from,this.from+this.slice.size,r.slice(this.from,this.to))},t.prototype.map=function(r){var o=r.mapResult(this.from,1),i=r.mapResult(this.to,-1);return o.deleted&&i.deleted?null:new t(o.pos,Math.max(o.pos,i.pos),this.slice)},t.prototype.merge=function(r){if(!(r instanceof t)||r.structure||this.structure)return null;if(this.from+this.slice.size!=r.from||this.slice.openEnd||r.slice.openStart){if(r.to!=this.from||this.slice.openStart||r.slice.openEnd)return null;var i=this.slice.size+r.slice.size==0?b.empty:new b(r.slice.content.append(this.slice.content),r.slice.openStart,this.slice.openEnd);return new t(r.from,this.to,i,this.structure)}var o=this.slice.size+r.slice.size==0?b.empty:new b(this.slice.content.append(r.slice.content),this.slice.openStart,r.slice.openEnd);return new t(this.from,this.to+(r.to-r.from),o,this.structure)},t.prototype.toJSON=function(){var r={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(r.slice=this.slice.toJSON()),this.structure&&(r.structure=!0),r},t.fromJSON=function(r,o){if("number"!=typeof o.from||"number"!=typeof o.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new t(o.from,o.to,b.fromJSON(r,o.slice),!!o.structure)},t}(et);et.jsonID("replace",Lt);var ft=function(n){function t(e,r,o,i,s,a,c){n.call(this),this.from=e,this.to=r,this.gapFrom=o,this.gapTo=i,this.slice=s,this.insert=a,this.structure=!!c}return n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t,t.prototype.apply=function(r){if(this.structure&&(In(r,this.from,this.gapFrom)||In(r,this.gapTo,this.to)))return it.fail("Structure gap-replace would overwrite content");var o=r.slice(this.gapFrom,this.gapTo);if(o.openStart||o.openEnd)return it.fail("Gap is not a flat range");var i=this.slice.insertAt(this.insert,o.content);return i?it.fromReplace(r,this.from,this.to,i):it.fail("Content does not fit in gap")},t.prototype.getMap=function(){return new U([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},t.prototype.invert=function(r){var o=this.gapTo-this.gapFrom;return new t(this.from,this.from+this.slice.size+o,this.from+this.insert,this.from+this.insert+o,r.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},t.prototype.map=function(r){var o=r.mapResult(this.from,1),i=r.mapResult(this.to,-1),s=r.map(this.gapFrom,-1),a=r.map(this.gapTo,1);return o.deleted&&i.deleted||s<o.pos||a>i.pos?null:new t(o.pos,i.pos,s,a,this.slice,this.insert,this.structure)},t.prototype.toJSON=function(){var r={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(r.slice=this.slice.toJSON()),this.structure&&(r.structure=!0),r},t.fromJSON=function(r,o){if("number"!=typeof o.from||"number"!=typeof o.to||"number"!=typeof o.gapFrom||"number"!=typeof o.gapTo||"number"!=typeof o.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new t(o.from,o.to,o.gapFrom,o.gapTo,b.fromJSON(r,o.slice),o.insert,!!o.structure)},t}(et);function In(n,t,e){for(var r=n.resolve(t),o=e-t,i=r.depth;o>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,o--;if(o>0)for(var s=r.node(i).maybeChild(r.indexAfter(i));o>0;){if(!s||s.isLeaf)return!0;s=s.firstChild,o--}return!1}function Ls(n,t,e){return(0==t||n.canReplace(t,n.childCount))&&(e==n.childCount||n.canReplace(0,e))}function Se(n){for(var e=n.parent.content.cutByIndex(n.startIndex,n.endIndex),r=n.depth;;--r){var o=n.$from.node(r),i=n.$from.index(r),s=n.$to.indexAfter(r);if(r<n.depth&&o.canReplace(i,s,e))return r;if(0==r||o.type.spec.isolating||!Ls(o,i,s))break}}function An(n,t,e,r){void 0===r&&(r=n);var o=function(n,t){var e=n.parent,r=n.startIndex,o=n.endIndex,i=e.contentMatchAt(r).findWrapping(t);return i&&e.canReplaceWith(r,o,i.length?i[0]:t)?i:null}(n,t),i=o&&function(n,t){var e=n.parent,r=n.startIndex,o=n.endIndex,i=e.child(r),s=t.contentMatch.findWrapping(i.type);if(!s)return null;for(var c=(s.length?s[s.length-1]:t).contentMatch,l=r;c&&l<o;l++)c=c.matchType(e.child(l).type);return c&&c.validEnd?s:null}(r,t);return i?o.map(so).concat({type:t,attrs:e}).concat(i.map(so)):null}function so(n){return{type:n,attrs:null}}function ue(n,t,e,r){void 0===e&&(e=1);var o=n.resolve(t),i=o.depth-e,s=r&&r[r.length-1]||o.parent;if(i<0||o.parent.type.spec.isolating||!o.parent.canReplace(o.index(),o.parent.childCount)||!s.type.validContent(o.parent.content.cutByIndex(o.index(),o.parent.childCount)))return!1;for(var a=o.depth-1,c=e-2;a>i;a--,c--){var l=o.node(a),f=o.index(a);if(l.type.spec.isolating)return!1;var p=l.content.cutByIndex(f,l.childCount),h=r&&r[c]||l;if(h!=l&&(p=p.replaceChild(0,h.type.create(h.attrs))),!l.canReplace(f+1,l.childCount)||!h.type.validContent(p))return!1}var d=o.indexAfter(i),g=r&&r[0];return o.node(i).canReplaceWith(d,d,g?g.type:o.node(i+1).type)}function Pn(n,t){var e=n.resolve(t),r=e.index();return function(n,t){return n&&t&&!n.isLeaf&&n.canAppend(t)}(e.nodeBefore,e.nodeAfter)&&e.parent.canReplace(r,r+1)}function Rn(n,t,e){for(var r=[],o=0;o<n.childCount;o++){var i=n.child(o);i.content.size&&(i=i.copy(Rn(i.content,t,i))),i.isInline&&(i=t(i,e,o)),r.push(i)}return m.fromArray(r)}et.jsonID("replaceAround",ft),L.prototype.lift=function(n,t){for(var e=n.$from,r=n.$to,o=n.depth,i=e.before(o+1),s=r.after(o+1),a=i,c=s,l=m.empty,f=0,p=o,h=!1;p>t;p--)h||e.index(p)>0?(h=!0,l=m.from(e.node(p).copy(l)),f++):a--;for(var d=m.empty,g=0,v=o,x=!1;v>t;v--)x||r.after(v+1)<r.end(v)?(x=!0,d=m.from(r.node(v).copy(d)),g++):c++;return this.step(new ft(a,c,i,s,new b(l.append(d),f,g),l.size-f,!0))},L.prototype.wrap=function(n,t){for(var e=m.empty,r=t.length-1;r>=0;r--){if(e.size){var o=t[r].type.contentMatch.matchFragment(e);if(!o||!o.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}e=m.from(t[r].type.create(t[r].attrs,e))}var i=n.start,s=n.end;return this.step(new ft(i,s,i,s,new b(e,0,0),t.length,!0))},L.prototype.setBlockType=function(n,t,e,r){var o=this;if(void 0===t&&(t=n),!e.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var i=this.steps.length;return this.doc.nodesBetween(n,t,function(s,a){if(s.isTextblock&&!s.hasMarkup(e,r)&&function(n,t,e){var r=n.resolve(t),o=r.index();return r.parent.canReplaceWith(o,o+1,e)}(o.doc,o.mapping.slice(i).map(a),e)){o.clearIncompatible(o.mapping.slice(i).map(a,1),e);var c=o.mapping.slice(i),l=c.map(a,1),f=c.map(a+s.nodeSize,1);return o.step(new ft(l,f,l+1,f-1,new b(m.from(e.create(r,null,s.marks)),0,0),1,!0)),!1}}),this},L.prototype.setNodeMarkup=function(n,t,e,r){var o=this.doc.nodeAt(n);if(!o)throw new RangeError("No node at given position");t||(t=o.type);var i=t.create(e,null,r||o.marks);if(o.isLeaf)return this.replaceWith(n,n+o.nodeSize,i);if(!t.validContent(o.content))throw new RangeError("Invalid content for node type "+t.name);return this.step(new ft(n,n+o.nodeSize,n+1,n+o.nodeSize-1,new b(m.from(i),0,0),1,!0))},L.prototype.split=function(n,t,e){void 0===t&&(t=1);for(var r=this.doc.resolve(n),o=m.empty,i=m.empty,s=r.depth,a=r.depth-t,c=t-1;s>a;s--,c--){o=m.from(r.node(s).copy(o));var l=e&&e[c];i=m.from(l?l.type.create(l.attrs,i):r.node(s).copy(i))}return this.step(new Lt(n,n,new b(o.append(i),t,t),!0))},L.prototype.join=function(n,t){void 0===t&&(t=1);var e=new Lt(n-t,n+t,b.empty,!0);return this.step(e)};var zn=function(n){function t(e,r,o){n.call(this),this.from=e,this.to=r,this.mark=o}return n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t,t.prototype.apply=function(r){var o=this,i=r.slice(this.from,this.to),s=r.resolve(this.from),a=s.node(s.sharedDepth(this.to)),c=new b(Rn(i.content,function(l,f){return l.isAtom&&f.type.allowsMarkType(o.mark.type)?l.mark(o.mark.addToSet(l.marks)):l},a),i.openStart,i.openEnd);return it.fromReplace(r,this.from,this.to,c)},t.prototype.invert=function(){return new we(this.from,this.to,this.mark)},t.prototype.map=function(r){var o=r.mapResult(this.from,1),i=r.mapResult(this.to,-1);return o.deleted&&i.deleted||o.pos>=i.pos?null:new t(o.pos,i.pos,this.mark)},t.prototype.merge=function(r){if(r instanceof t&&r.mark.eq(this.mark)&&this.from<=r.to&&this.to>=r.from)return new t(Math.min(this.from,r.from),Math.max(this.to,r.to),this.mark)},t.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},t.fromJSON=function(r,o){if("number"!=typeof o.from||"number"!=typeof o.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new t(o.from,o.to,r.markFromJSON(o.mark))},t}(et);et.jsonID("addMark",zn);var we=function(n){function t(e,r,o){n.call(this),this.from=e,this.to=r,this.mark=o}return n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t,t.prototype.apply=function(r){var o=this,i=r.slice(this.from,this.to),s=new b(Rn(i.content,function(a){return a.mark(o.mark.removeFromSet(a.marks))}),i.openStart,i.openEnd);return it.fromReplace(r,this.from,this.to,s)},t.prototype.invert=function(){return new zn(this.from,this.to,this.mark)},t.prototype.map=function(r){var o=r.mapResult(this.from,1),i=r.mapResult(this.to,-1);return o.deleted&&i.deleted||o.pos>=i.pos?null:new t(o.pos,i.pos,this.mark)},t.prototype.merge=function(r){if(r instanceof t&&r.mark.eq(this.mark)&&this.from<=r.to&&this.to>=r.from)return new t(Math.min(this.from,r.from),Math.max(this.to,r.to),this.mark)},t.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},t.fromJSON=function(r,o){if("number"!=typeof o.from||"number"!=typeof o.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new t(o.from,o.to,r.markFromJSON(o.mark))},t}(et);function Fn(n,t,e,r){if(void 0===e&&(e=t),void 0===r&&(r=b.empty),t==e&&!r.size)return null;var o=n.resolve(t),i=n.resolve(e);return co(o,i,r)?new Lt(t,e,r):new gt(o,i,r).fit()}function co(n,t,e){return!e.openStart&&!e.openEnd&&n.start()==t.start()&&n.parent.canReplace(n.index(),t.index(),e.content)}et.jsonID("removeMark",we),L.prototype.addMark=function(n,t,e){var r=this,o=[],i=[],s=null,a=null;return this.doc.nodesBetween(n,t,function(c,l,f){if(c.isInline){var p=c.marks;if(!e.isInSet(p)&&f.type.allowsMarkType(e.type)){for(var h=Math.max(l,n),d=Math.min(l+c.nodeSize,t),g=e.addToSet(p),v=0;v<p.length;v++)p[v].isInSet(g)||(s&&s.to==h&&s.mark.eq(p[v])?s.to=d:o.push(s=new we(h,d,p[v])));a&&a.to==h?a.to=d:i.push(a=new zn(h,d,e))}}}),o.forEach(function(c){return r.step(c)}),i.forEach(function(c){return r.step(c)}),this},L.prototype.removeMark=function(n,t,e){var r=this;void 0===e&&(e=null);var o=[],i=0;return this.doc.nodesBetween(n,t,function(s,a){if(s.isInline){i++;var c=null;if(e instanceof Bt)for(var f,l=s.marks;f=e.isInSet(l);)(c||(c=[])).push(f),l=f.removeFromSet(l);else e?e.isInSet(s.marks)&&(c=[e]):c=s.marks;if(c&&c.length)for(var p=Math.min(a+s.nodeSize,t),h=0;h<c.length;h++){for(var d=c[h],g=void 0,v=0;v<o.length;v++){var x=o[v];x.step==i-1&&d.eq(o[v].style)&&(g=x)}g?(g.to=p,g.step=i):o.push({style:d,from:Math.max(a,n),to:p,step:i})}}}),o.forEach(function(s){return r.step(new we(s.from,s.to,s.style))}),this},L.prototype.clearIncompatible=function(n,t,e){void 0===e&&(e=t.contentMatch);for(var r=this.doc.nodeAt(n),o=[],i=n+1,s=0;s<r.childCount;s++){var a=r.child(s),c=i+a.nodeSize,l=e.matchType(a.type,a.attrs);if(l){e=l;for(var f=0;f<a.marks.length;f++)t.allowsMarkType(a.marks[f].type)||this.step(new we(i,c,a.marks[f]))}else o.push(new Lt(i,c,b.empty));i=c}if(!e.validEnd){var p=e.fillBefore(m.empty,!0);this.replace(i,i,new b(p,0,0))}for(var h=o.length-1;h>=0;h--)this.step(o[h]);return this},L.prototype.replace=function(n,t,e){void 0===t&&(t=n),void 0===e&&(e=b.empty);var r=Fn(this.doc,n,t,e);return r&&this.step(r),this},L.prototype.replaceWith=function(n,t,e){return this.replace(n,t,new b(m.from(e),0,0))},L.prototype.delete=function(n,t){return this.replace(n,t,b.empty)},L.prototype.insert=function(n,t){return this.replaceWith(n,n,t)};var gt=function(t,e,r){this.$to=e,this.$from=t,this.unplaced=r,this.frontier=[];for(var o=0;o<=t.depth;o++){var i=t.node(o);this.frontier.push({type:i.type,match:i.contentMatchAt(t.indexAfter(o))})}this.placed=m.empty;for(var s=t.depth;s>0;s--)this.placed=m.from(t.node(s).copy(this.placed))},lo={depth:{configurable:!0}};function Ne(n,t,e){return 0==t?n.cutByIndex(e):n.replaceChild(0,n.firstChild.copy(Ne(n.firstChild.content,t-1,e)))}function Oe(n,t,e){return 0==t?n.append(e):n.replaceChild(n.childCount-1,n.lastChild.copy(Oe(n.lastChild.content,t-1,e)))}function Bn(n,t){for(var e=0;e<t;e++)n=n.firstChild.content;return n}function uo(n,t,e){if(t<=0)return n;var r=n.content;return t>1&&(r=r.replaceChild(0,uo(r.firstChild,t-1,1==r.childCount?e-1:0))),t>0&&(r=n.type.contentMatch.fillBefore(r).append(r),e<=0&&(r=r.append(n.type.contentMatch.matchFragment(r).fillBefore(m.empty,!0)))),n.copy(r)}function Ln(n,t,e,r,o){var i=n.node(t),s=o?n.indexAfter(t):n.index(t);if(s==i.childCount&&!e.compatibleContent(i.type))return null;var a=r.fillBefore(i.content,!0,s);return a&&!function(n,t,e){for(var r=e;r<t.childCount;r++)if(!n.allowsMarks(t.child(r).marks))return!0;return!1}(e,i.content,s)?a:null}function Us(n){return n.spec.defining||n.spec.definingForContent}function fo(n,t,e,r,o){if(t<e){var i=n.firstChild;n=n.replaceChild(0,i.copy(fo(i.content,t+1,e,r,i)))}if(t>r){var s=o.contentMatchAt(0),a=s.fillBefore(n).append(n);n=a.append(s.matchFragment(a).fillBefore(m.empty,!0))}return n}function po(n,t){for(var e=[],o=Math.min(n.depth,t.depth);o>=0;o--){var i=n.start(o);if(i<n.pos-(n.depth-o)||t.end(o)>t.pos+(t.depth-o)||n.node(o).type.spec.isolating||t.node(o).type.spec.isolating)break;(i==t.start(o)||o==n.depth&&o==t.depth&&n.parent.inlineContent&&t.parent.inlineContent&&o&&t.start(o-1)==i-1)&&e.push(o)}return e}lo.depth.get=function(){return this.frontier.length-1},gt.prototype.fit=function(){for(;this.unplaced.size;){var t=this.findFittable();t?this.placeNodes(t):this.openMore()||this.dropNode()}var e=this.mustMoveInline(),r=this.placed.size-this.depth-this.$from.depth,o=this.$from,i=this.close(e<0?this.$to:o.doc.resolve(e));if(!i)return null;for(var s=this.placed,a=o.depth,c=i.depth;a&&c&&1==s.childCount;)s=s.firstChild.content,a--,c--;var l=new b(s,a,c);return e>-1?new ft(o.pos,e,this.$to.pos,this.$to.end(),l,r):l.size||o.pos!=this.$to.pos?new Lt(o.pos,i.pos,l):void 0},gt.prototype.findFittable=function(){for(var t=1;t<=2;t++)for(var e=this.unplaced.openStart;e>=0;e--)for(var o=void 0,i=(e?(o=Bn(this.unplaced.content,e-1).firstChild).content:this.unplaced.content).firstChild,s=this.depth;s>=0;s--){var a=this.frontier[s],c=a.type,l=a.match,f=void 0,p=void 0;if(1==t&&(i?l.matchType(i.type)||(p=l.fillBefore(m.from(i),!1)):c.compatibleContent(o.type)))return{sliceDepth:e,frontierDepth:s,parent:o,inject:p};if(2==t&&i&&(f=l.findWrapping(i.type)))return{sliceDepth:e,frontierDepth:s,parent:o,wrap:f};if(o&&l.matchType(o.type))break}},gt.prototype.openMore=function(){var t=this.unplaced,e=t.content,r=t.openStart,o=t.openEnd,i=Bn(e,r);return!(!i.childCount||i.firstChild.isLeaf||(this.unplaced=new b(e,r+1,Math.max(o,i.size+r>=e.size-o?r+1:0)),0))},gt.prototype.dropNode=function(){var t=this.unplaced,e=t.content,r=t.openStart,o=t.openEnd,i=Bn(e,r);if(i.childCount<=1&&r>0){var s=e.size-r<=r+i.size;this.unplaced=new b(Ne(e,r-1,1),r-1,s?r-1:o)}else this.unplaced=new b(Ne(e,r,1),r,o)},gt.prototype.placeNodes=function(t){for(var e=t.sliceDepth,r=t.frontierDepth,o=t.parent,i=t.inject,s=t.wrap;this.depth>r;)this.closeFrontierNode();if(s)for(var a=0;a<s.length;a++)this.openFrontierNode(s[a]);var c=this.unplaced,l=o?o.content:c.content,f=c.openStart-e,p=0,h=[],d=this.frontier[r],g=d.match,v=d.type;if(i){for(var x=0;x<i.childCount;x++)h.push(i.child(x));g=g.matchFragment(i)}for(var C=l.size+e-(c.content.size-c.openEnd);p<l.childCount;){var _=l.child(p),S=g.matchType(_.type);if(!S)break;(++p>1||0==f||_.content.size)&&(g=S,h.push(uo(_.mark(v.allowedMarks(_.marks)),1==p?f:0,p==l.childCount?C:-1)))}var k=p==l.childCount;k||(C=-1),this.placed=Oe(this.placed,r,m.from(h)),this.frontier[r].match=g,k&&C<0&&o&&o.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var M=0,O=l;M<C;M++){var R=O.lastChild;this.frontier.push({type:R.type,match:R.contentMatchAt(R.childCount)}),O=R.content}this.unplaced=k?0==e?b.empty:new b(Ne(c.content,e-1,1),e-1,C<0?c.openEnd:e-1):new b(Ne(c.content,e,p),c.openStart,c.openEnd)},gt.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock)return-1;var e,t=this.frontier[this.depth];if(!t.type.isTextblock||!Ln(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;for(var o=this.$to.depth,i=this.$to.after(o);o>1&&i==this.$to.end(--o);)++i;return i},gt.prototype.findCloseLevel=function(t){t:for(var e=Math.min(this.depth,t.depth);e>=0;e--){var r=this.frontier[e],o=r.match,i=r.type,s=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),a=Ln(t,e,i,o,s);if(a){for(var c=e-1;c>=0;c--){var l=this.frontier[c],h=Ln(t,c,l.type,l.match,!0);if(!h||h.childCount)continue t}return{depth:e,fit:a,move:s?t.doc.resolve(t.after(e+1)):t}}}},gt.prototype.close=function(t){var e=this.findCloseLevel(t);if(!e)return null;for(;this.depth>e.depth;)this.closeFrontierNode();e.fit.childCount&&(this.placed=Oe(this.placed,e.depth,e.fit)),t=e.move;for(var r=e.depth+1;r<=t.depth;r++){var o=t.node(r),i=o.type.contentMatch.fillBefore(o.content,!0,t.index(r));this.openFrontierNode(o.type,o.attrs,i)}return t},gt.prototype.openFrontierNode=function(t,e,r){var o=this.frontier[this.depth];o.match=o.match.matchType(t),this.placed=Oe(this.placed,this.depth,m.from(t.create(e,r))),this.frontier.push({type:t,match:t.contentMatch})},gt.prototype.closeFrontierNode=function(){var e=this.frontier.pop().match.fillBefore(m.empty,!0);e.childCount&&(this.placed=Oe(this.placed,this.frontier.length,e))},Object.defineProperties(gt.prototype,lo),L.prototype.replaceRange=function(n,t,e){if(!e.size)return this.deleteRange(n,t);var r=this.doc.resolve(n),o=this.doc.resolve(t);if(co(r,o,e))return this.step(new Lt(n,t,e));var i=po(r,this.doc.resolve(t));0==i[i.length-1]&&i.pop();var s=-(r.depth+1);i.unshift(s);for(var a=r.depth,c=r.pos-1;a>0;a--,c--){var l=r.node(a).type.spec;if(l.defining||l.definingAsContext||l.isolating)break;i.indexOf(a)>-1?s=a:r.before(a)==c&&i.splice(1,0,-a)}for(var f=i.indexOf(s),p=[],h=e.openStart,d=e.content,g=0;;g++){var v=d.firstChild;if(p.push(v),g==e.openStart)break;d=v.content}for(var x=h-1;x>=0;x--){var C=p[x].type,_=Us(C);if(_&&r.node(f).type!=C)h=x;else if(_||!C.isTextblock)break}for(var S=e.openStart;S>=0;S--){var k=(S+h+1)%(e.openStart+1),M=p[k];if(M)for(var O=0;O<i.length;O++){var R=i[(O+f)%i.length],B=!0;R<0&&(B=!1,R=-R);var G=r.node(R-1),X=r.index(R-1);if(G.canReplaceWith(X,X,M.type,M.marks))return this.replace(r.before(R),B?o.after(R):t,new b(fo(e.content,0,e.openStart,k),k,e.openEnd))}}for(var Ft=this.steps.length,kt=i.length-1;kt>=0&&(this.replace(n,t,e),!(this.steps.length>Ft));kt--){var Mt=i[kt];Mt<0||(n=r.before(Mt),t=o.after(Mt))}return this},L.prototype.replaceRangeWith=function(n,t,e){if(!e.isInline&&n==t&&this.doc.resolve(n).parent.content.size){var r=function(n,t,e){var r=n.resolve(t);if(r.parent.canReplaceWith(r.index(),r.index(),e))return t;if(0==r.parentOffset)for(var o=r.depth-1;o>=0;o--){var i=r.index(o);if(r.node(o).canReplaceWith(i,i,e))return r.before(o+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(var s=r.depth-1;s>=0;s--){var a=r.indexAfter(s);if(r.node(s).canReplaceWith(a,a,e))return r.after(s+1);if(a<r.node(s).childCount)return null}}(this.doc,n,e.type);null!=r&&(n=t=r)}return this.replaceRange(n,t,new b(m.from(e),0,0))},L.prototype.deleteRange=function(n,t){for(var e=this.doc.resolve(n),r=this.doc.resolve(t),o=po(e,r),i=0;i<o.length;i++){var s=o[i],a=i==o.length-1;if(a&&0==s||e.node(s).type.contentMatch.validEnd)return this.delete(e.start(s),r.end(s));if(s>0&&(a||e.node(s-1).canReplace(e.index(s-1),r.indexAfter(s-1))))return this.delete(e.before(s),r.after(s))}for(var c=1;c<=e.depth&&c<=r.depth;c++)if(n-e.start(c)==e.depth-c&&t>e.end(c)&&r.end(c)-t!=r.depth-c)return this.delete(e.before(c),t);return this.delete(n,t)};var Vn=Object.create(null),D=function(t,e,r){this.ranges=r||[new Ks(t.min(e),t.max(e))],this.$anchor=t,this.$head=e},Vt={anchor:{configurable:!0},head:{configurable:!0},from:{configurable:!0},to:{configurable:!0},$from:{configurable:!0},$to:{configurable:!0},empty:{configurable:!0}};Vt.anchor.get=function(){return this.$anchor.pos},Vt.head.get=function(){return this.$head.pos},Vt.from.get=function(){return this.$from.pos},Vt.to.get=function(){return this.$to.pos},Vt.$from.get=function(){return this.ranges[0].$from},Vt.$to.get=function(){return this.ranges[0].$to},Vt.empty.get=function(){for(var n=this.ranges,t=0;t<n.length;t++)if(n[t].$from.pos!=n[t].$to.pos)return!1;return!0},D.prototype.content=function(){return this.$from.node(0).slice(this.from,this.to,!0)},D.prototype.replace=function(t,e){void 0===e&&(e=b.empty);for(var r=e.content.lastChild,o=null,i=0;i<e.openEnd;i++)o=r,r=r.lastChild;for(var s=t.steps.length,a=this.ranges,c=0;c<a.length;c++){var l=a[c],f=l.$from,p=l.$to,h=t.mapping.slice(s);t.replaceRange(h.map(f.pos),h.map(p.pos),c?b.empty:e),0==c&&ho(t,s,(r?r.isInline:o&&o.isTextblock)?-1:1)}},D.prototype.replaceWith=function(t,e){for(var r=t.steps.length,o=this.ranges,i=0;i<o.length;i++){var s=o[i],a=s.$from,c=s.$to,l=t.mapping.slice(r),f=l.map(a.pos),p=l.map(c.pos);i?t.deleteRange(f,p):(t.replaceRangeWith(f,p,e),ho(t,r,e.isInline?-1:1))}},D.findFrom=function(t,e,r){var o=t.parent.inlineContent?new F(t):fe(t.node(0),t.parent,t.pos,t.index(),e,r);if(o)return o;for(var i=t.depth-1;i>=0;i--){var s=e<0?fe(t.node(0),t.node(i),t.before(i+1),t.index(i),e,r):fe(t.node(0),t.node(i),t.after(i+1),t.index(i)+1,e,r);if(s)return s}},D.near=function(t,e){return void 0===e&&(e=1),this.findFrom(t,e)||this.findFrom(t,-e)||new It(t.node(0))},D.atStart=function(t){return fe(t,t,0,0,1)||new It(t)},D.atEnd=function(t){return fe(t,t,t.content.size,t.childCount,-1)||new It(t)},D.fromJSON=function(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");var r=Vn[e.type];if(!r)throw new RangeError("No selection type "+e.type+" defined");return r.fromJSON(t,e)},D.jsonID=function(t,e){if(t in Vn)throw new RangeError("Duplicate use of selection JSON ID "+t);return Vn[t]=e,e.prototype.jsonID=t,e},D.prototype.getBookmark=function(){return F.between(this.$anchor,this.$head).getBookmark()},Object.defineProperties(D.prototype,Vt),D.prototype.visible=!0;var Ks=function(t,e){this.$from=t,this.$to=e},F=function(n){function t(r,o){void 0===o&&(o=r),n.call(this,r,o)}n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t;var e={$cursor:{configurable:!0}};return e.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null},t.prototype.map=function(o,i){var s=o.resolve(i.map(this.head));if(!s.parent.inlineContent)return n.near(s);var a=o.resolve(i.map(this.anchor));return new t(a.parent.inlineContent?a:s,s)},t.prototype.replace=function(o,i){if(void 0===i&&(i=b.empty),n.prototype.replace.call(this,o,i),i==b.empty){var s=this.$from.marksAcross(this.$to);s&&o.ensureMarks(s)}},t.prototype.eq=function(o){return o instanceof t&&o.anchor==this.anchor&&o.head==this.head},t.prototype.getBookmark=function(){return new Te(this.anchor,this.head)},t.prototype.toJSON=function(){return{type:"text",anchor:this.anchor,head:this.head}},t.fromJSON=function(o,i){if("number"!=typeof i.anchor||"number"!=typeof i.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new t(o.resolve(i.anchor),o.resolve(i.head))},t.create=function(o,i,s){void 0===s&&(s=i);var a=o.resolve(i);return new this(a,s==i?a:o.resolve(s))},t.between=function(o,i,s){var a=o.pos-i.pos;if((!s||a)&&(s=a>=0?1:-1),!i.parent.inlineContent){var c=n.findFrom(i,s,!0)||n.findFrom(i,-s,!0);if(!c)return n.near(i,s);i=c.$head}return o.parent.inlineContent||(0==a||(o=(n.findFrom(o,-s,!0)||n.findFrom(o,s,!0)).$anchor).pos<i.pos!=a<0)&&(o=i),new t(o,i)},Object.defineProperties(t.prototype,e),t}(D);D.jsonID("text",F);var Te=function(t,e){this.anchor=t,this.head=e};Te.prototype.map=function(t){return new Te(t.map(this.anchor),t.map(this.head))},Te.prototype.resolve=function(t){return F.between(t.resolve(this.anchor),t.resolve(this.head))};var w=function(n){function t(e){var r=e.nodeAfter,o=e.node(0).resolve(e.pos+r.nodeSize);n.call(this,e,o),this.node=r}return n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t,t.prototype.map=function(r,o){var i=o.mapResult(this.anchor),s=i.deleted,c=r.resolve(i.pos);return s?n.near(c):new t(c)},t.prototype.content=function(){return new b(m.from(this.node),0,0)},t.prototype.eq=function(r){return r instanceof t&&r.anchor==this.anchor},t.prototype.toJSON=function(){return{type:"node",anchor:this.anchor}},t.prototype.getBookmark=function(){return new tn(this.anchor)},t.fromJSON=function(r,o){if("number"!=typeof o.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new t(r.resolve(o.anchor))},t.create=function(r,o){return new this(r.resolve(o))},t.isSelectable=function(r){return!r.isText&&!1!==r.type.spec.selectable},t}(D);w.prototype.visible=!1,D.jsonID("node",w);var tn=function(t){this.anchor=t};tn.prototype.map=function(t){var e=t.mapResult(this.anchor),o=e.pos;return e.deleted?new Te(o,o):new tn(o)},tn.prototype.resolve=function(t){var e=t.resolve(this.anchor),r=e.nodeAfter;return r&&w.isSelectable(r)?new w(e):D.near(e)};var It=function(n){function t(e){n.call(this,e.resolve(0),e.resolve(e.content.size))}return n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t,t.prototype.replace=function(r,o){if(void 0===o&&(o=b.empty),o==b.empty){r.delete(0,r.doc.content.size);var i=n.atStart(r.doc);i.eq(r.selection)||r.setSelection(i)}else n.prototype.replace.call(this,r,o)},t.prototype.toJSON=function(){return{type:"all"}},t.fromJSON=function(r){return new t(r)},t.prototype.map=function(r){return new t(r)},t.prototype.eq=function(r){return r instanceof t},t.prototype.getBookmark=function(){return js},t}(D);D.jsonID("all",It);var js={map:function(){return this},resolve:function(t){return new It(t)}};function fe(n,t,e,r,o,i){if(t.inlineContent)return F.create(n,e);for(var s=r-(o>0?0:1);o>0?s<t.childCount:s>=0;s+=o){var a=t.child(s);if(a.isAtom){if(!i&&w.isSelectable(a))return w.create(n,e-(o<0?a.nodeSize:0))}else{var c=fe(n,a,e+o,o<0?a.childCount:0,o,i);if(c)return c}e+=a.nodeSize*o}}function ho(n,t,e){var r=n.steps.length-1;if(!(r<t)){var s,o=n.steps[r];(o instanceof Lt||o instanceof ft)&&(n.mapping.maps[r].forEach(function(a,c,l,f){null==s&&(s=f)}),n.setSelection(D.near(n.doc.resolve(s),e)))}}var Qs=function(n){function t(r){n.call(this,r.doc),this.time=Date.now(),this.curSelection=r.selection,this.curSelectionFor=0,this.storedMarks=r.storedMarks,this.updated=0,this.meta=Object.create(null)}n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t;var e={selection:{configurable:!0},selectionSet:{configurable:!0},storedMarksSet:{configurable:!0},isGeneric:{configurable:!0},scrolledIntoView:{configurable:!0}};return e.selection.get=function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection},t.prototype.setSelection=function(o){if(o.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=o,this.curSelectionFor=this.steps.length,this.updated=-3&(1|this.updated),this.storedMarks=null,this},e.selectionSet.get=function(){return(1&this.updated)>0},t.prototype.setStoredMarks=function(o){return this.storedMarks=o,this.updated|=2,this},t.prototype.ensureMarks=function(o){return N.sameSet(this.storedMarks||this.selection.$from.marks(),o)||this.setStoredMarks(o),this},t.prototype.addStoredMark=function(o){return this.ensureMarks(o.addToSet(this.storedMarks||this.selection.$head.marks()))},t.prototype.removeStoredMark=function(o){return this.ensureMarks(o.removeFromSet(this.storedMarks||this.selection.$head.marks()))},e.storedMarksSet.get=function(){return(2&this.updated)>0},t.prototype.addStep=function(o,i){n.prototype.addStep.call(this,o,i),this.updated=-3&this.updated,this.storedMarks=null},t.prototype.setTime=function(o){return this.time=o,this},t.prototype.replaceSelection=function(o){return this.selection.replace(this,o),this},t.prototype.replaceSelectionWith=function(o,i){var s=this.selection;return!1!==i&&(o=o.mark(this.storedMarks||(s.empty?s.$from.marks():s.$from.marksAcross(s.$to)||N.none))),s.replaceWith(this,o),this},t.prototype.deleteSelection=function(){return this.selection.replace(this),this},t.prototype.insertText=function(o,i,s){void 0===s&&(s=i);var a=this.doc.type.schema;if(null==i)return o?this.replaceSelectionWith(a.text(o),!0):this.deleteSelection();if(!o)return this.deleteRange(i,s);var c=this.storedMarks;if(!c){var l=this.doc.resolve(i);c=s==i?l.marks():l.marksAcross(this.doc.resolve(s))}return this.replaceRangeWith(i,s,a.text(o,c)),this.selection.empty||this.setSelection(D.near(this.selection.$to)),this},t.prototype.setMeta=function(o,i){return this.meta["string"==typeof o?o:o.key]=i,this},t.prototype.getMeta=function(o){return this.meta["string"==typeof o?o:o.key]},e.isGeneric.get=function(){for(var r in this.meta)return!1;return!0},t.prototype.scrollIntoView=function(){return this.updated|=4,this},e.scrolledIntoView.get=function(){return(4&this.updated)>0},Object.defineProperties(t.prototype,e),t}(L);function vo(n,t){return t&&n?n.bind(t):n}var Ee=function(t,e,r){this.name=t,this.init=vo(e.init,r),this.apply=vo(e.apply,r)},Ys=[new Ee("doc",{init:function(t){return t.doc||t.schema.topNodeType.createAndFill()},apply:function(t){return t.doc}}),new Ee("selection",{init:function(t,e){return t.selection||D.atStart(e.doc)},apply:function(t){return t.selection}}),new Ee("storedMarks",{init:function(t){return t.storedMarks||null},apply:function(t,e,r,o){return o.selection.$cursor?t.storedMarks:null}}),new Ee("scrollToSelection",{init:function(){return 0},apply:function(t,e){return t.scrolledIntoView?e+1:e}})],Hn=function(t,e){var r=this;this.schema=t,this.fields=Ys.concat(),this.plugins=[],this.pluginsByKey=Object.create(null),e&&e.forEach(function(o){if(r.pluginsByKey[o.key])throw new RangeError("Adding different instances of a keyed plugin ("+o.key+")");r.plugins.push(o),r.pluginsByKey[o.key]=o,o.spec.state&&r.fields.push(new Ee(o.key,o.spec.state,o))})},nt=function(t){this.config=t},nn={schema:{configurable:!0},plugins:{configurable:!0},tr:{configurable:!0}};nn.schema.get=function(){return this.config.schema},nn.plugins.get=function(){return this.config.plugins},nt.prototype.apply=function(t){return this.applyTransaction(t).state},nt.prototype.filterTransaction=function(t,e){void 0===e&&(e=-1);for(var r=0;r<this.config.plugins.length;r++)if(r!=e){var o=this.config.plugins[r];if(o.spec.filterTransaction&&!o.spec.filterTransaction.call(o,t,this))return!1}return!0},nt.prototype.applyTransaction=function(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};for(var e=[t],r=this.applyInner(t),o=null;;){for(var i=!1,s=0;s<this.config.plugins.length;s++){var a=this.config.plugins[s];if(a.spec.appendTransaction){var c=o?o[s].n:0,l=o?o[s].state:this,f=c<e.length&&a.spec.appendTransaction.call(a,c?e.slice(c):e,l,r);if(f&&r.filterTransaction(f,s)){if(f.setMeta("appendedTransaction",t),!o){o=[];for(var p=0;p<this.config.plugins.length;p++)o.push(p<s?{state:r,n:e.length}:{state:this,n:0})}e.push(f),r=r.applyInner(f),i=!0}o&&(o[s]={state:r,n:e.length})}}if(!i)return{state:r,transactions:e}}},nt.prototype.applyInner=function(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var e=new nt(this.config),r=this.config.fields,o=0;o<r.length;o++){var i=r[o];e[i.name]=i.apply(t,this[i.name],this,e)}for(var s=0;s<De.length;s++)De[s](this,t,e);return e},nn.tr.get=function(){return new Qs(this)},nt.create=function(t){for(var e=new Hn(t.doc?t.doc.type.schema:t.schema,t.plugins),r=new nt(e),o=0;o<e.fields.length;o++)r[e.fields[o].name]=e.fields[o].init(t,r);return r},nt.prototype.reconfigure=function(t){for(var e=new Hn(this.schema,t.plugins),r=e.fields,o=new nt(e),i=0;i<r.length;i++){var s=r[i].name;o[s]=this.hasOwnProperty(s)?this[s]:r[i].init(t,o)}return o},nt.prototype.toJSON=function(t){var e={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(e.storedMarks=this.storedMarks.map(function(s){return s.toJSON()})),t&&"object"==typeof t)for(var r in t){if("doc"==r||"selection"==r)throw new RangeError("The JSON fields `doc` and `selection` are reserved");var o=t[r],i=o.spec.state;i&&i.toJSON&&(e[r]=i.toJSON.call(o,this[o.key]))}return e},nt.fromJSON=function(t,e,r){if(!e)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");var o=new Hn(t.schema,t.plugins),i=new nt(o);return o.fields.forEach(function(s){if("doc"==s.name)i.doc=T.fromJSON(t.schema,e.doc);else if("selection"==s.name)i.selection=D.fromJSON(i.doc,e.selection);else if("storedMarks"==s.name)e.storedMarks&&(i.storedMarks=e.storedMarks.map(t.schema.markFromJSON));else{if(r)for(var a in r){var c=r[a],l=c.spec.state;if(c.key==s.name&&l&&l.fromJSON&&Object.prototype.hasOwnProperty.call(e,a))return void(i[s.name]=l.fromJSON.call(c,t,e[a],i))}i[s.name]=s.init(t,i)}}),i},nt.addApplyListener=function(t){De.push(t)},nt.removeApplyListener=function(t){var e=De.indexOf(t);e>-1&&De.splice(e,1)},Object.defineProperties(nt.prototype,nn);var De=[];function yo(n,t,e){for(var r in n){var o=n[r];o instanceof Function?o=o.bind(t):"handleDOMEvents"==r&&(o=yo(o,t,{})),e[r]=o}return e}var _t=function(t){this.props={},t.props&&yo(t.props,this,this.props),this.spec=t,this.key=t.key?t.key.key:_o("plugin")};_t.prototype.getState=function(t){return t[this.key]};var Jn=Object.create(null);function _o(n){return n in Jn?n+"$"+ ++Jn[n]:(Jn[n]=0,n+"$")}var xt=function(t){void 0===t&&(t="key"),this.key=_o(t)};xt.prototype.get=function(t){return t.config.pluginsByKey[this.key]},xt.prototype.getState=function(t){return t[this.key]};var y={};if("undefined"!=typeof navigator&&"undefined"!=typeof document){var qn=/Edge\/(\d+)/.exec(navigator.userAgent),xo=/MSIE \d/.test(navigator.userAgent),Wn=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),Zn=y.ie=!!(xo||Wn||qn);y.ie_version=xo?document.documentMode||6:Wn?+Wn[1]:qn?+qn[1]:null,y.gecko=!Zn&&/gecko\/(\d+)/i.test(navigator.userAgent),y.gecko_version=y.gecko&&+(/Firefox\/(\d+)/.exec(navigator.userAgent)||[0,0])[1];var Un=!Zn&&/Chrome\/(\d+)/.exec(navigator.userAgent);y.chrome=!!Un,y.chrome_version=Un&&+Un[1],y.safari=!Zn&&/Apple Computer/.test(navigator.vendor),y.ios=y.safari&&(/Mobile\/\w+/.test(navigator.userAgent)||navigator.maxTouchPoints>2),y.mac=y.ios||/Mac/.test(navigator.platform),y.android=/Android \d/.test(navigator.userAgent),y.webkit="webkitFontSmoothing"in document.documentElement.style,y.webkit_version=y.webkit&&+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]}var pt=function(n){for(var t=0;;t++)if(!(n=n.previousSibling))return t},Kn=function(n){var t=n.assignedSlot||n.parentNode;return t&&11==t.nodeType?t.host:t},bo=null,At=function(n,t,e){var r=bo||(bo=document.createRange());return r.setEnd(n,null==e?n.nodeValue.length:e),r.setStart(n,t||0),r},Ie=function(n,t,e,r){return e&&(Co(n,t,e,r,-1)||Co(n,t,e,r,1))},Gs=/^(img|br|input|textarea|hr)$/i;function Co(n,t,e,r,o){for(;;){if(n==e&&t==r)return!0;if(t==(o<0?0:Nt(n))){var i=n.parentNode;if(!i||1!=i.nodeType||$s(n)||Gs.test(n.nodeName)||"false"==n.contentEditable)return!1;t=pt(n)+(o<0?0:1),n=i}else{if(1!=n.nodeType)return!1;if("false"==(n=n.childNodes[t+(o<0?-1:0)]).contentEditable)return!1;t=o<0?Nt(n):0}}}function Nt(n){return 3==n.nodeType?n.nodeValue.length:n.childNodes.length}function $s(n){for(var t,e=n;e&&!(t=e.pmViewDesc);e=e.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==n||t.contentDOM==n)}var jn=function(n){var t=n.isCollapsed;return t&&y.chrome&&n.rangeCount&&!n.getRangeAt(0).collapsed&&(t=!1),t};function pe(n,t){var e=document.createEvent("Event");return e.initEvent("keydown",!0,!0),e.keyCode=n,e.key=e.code=t,e}function ta(n){return{left:0,right:n.documentElement.clientWidth,top:0,bottom:n.documentElement.clientHeight}}function Ht(n,t){return"number"==typeof n?n:n[t]}function ea(n){var t=n.getBoundingClientRect();return{left:t.left,right:t.left+n.clientWidth*(t.width/n.offsetWidth||1),top:t.top,bottom:t.top+n.clientHeight*(t.height/n.offsetHeight||1)}}function Mo(n){for(var t=[],e=n.ownerDocument;n&&(t.push({dom:n,top:n.scrollTop,left:n.scrollLeft}),n!=e);n=Kn(n));return t}function So(n,t){for(var e=0;e<n.length;e++){var r=n[e],o=r.dom,i=r.top,s=r.left;o.scrollTop!=i+t&&(o.scrollTop=i+t),o.scrollLeft!=s&&(o.scrollLeft=s)}}var he=null;function wo(n,t){for(var e,o,r=2e8,i=0,s=t.top,a=t.top,c=n.firstChild,l=0;c;c=c.nextSibling,l++){var f=void 0;if(1==c.nodeType)f=c.getClientRects();else{if(3!=c.nodeType)continue;f=At(c).getClientRects()}for(var p=0;p<f.length;p++){var h=f[p];if(h.top<=s&&h.bottom>=a){s=Math.max(h.bottom,s),a=Math.min(h.top,a);var d=h.left>t.left?h.left-t.left:h.right<t.left?t.left-h.right:0;if(d<r){e=c,r=d,o=d&&3==e.nodeType?{left:h.right<t.left?h.right:h.left,top:t.top}:t,1==c.nodeType&&d&&(i=l+(t.left>=(h.left+h.right)/2?1:0));continue}}!e&&(t.left>=h.right&&t.top>=h.top||t.left>=h.left&&t.top>=h.bottom)&&(i=l+1)}}return e&&3==e.nodeType?function(n,t){for(var e=n.nodeValue.length,r=document.createRange(),o=0;o<e;o++){r.setEnd(n,o+1),r.setStart(n,o);var i=Jt(r,1);if(i.top!=i.bottom&&Qn(t,i))return{node:n,offset:o+(t.left>=(i.left+i.right)/2?1:0)}}return{node:n,offset:0}}(e,o):!e||r&&1==e.nodeType?{node:n,offset:i}:wo(e,o)}function Qn(n,t){return n.left>=t.left-1&&n.left<=t.right+1&&n.top>=t.top-1&&n.top<=t.bottom+1}function No(n,t,e){var r=n.childNodes.length;if(r&&e.top<e.bottom)for(var o=Math.max(0,Math.min(r-1,Math.floor(r*(t.top-e.top)/(e.bottom-e.top))-2)),i=o;;){var s=n.childNodes[i];if(1==s.nodeType)for(var a=s.getClientRects(),c=0;c<a.length;c++){var l=a[c];if(Qn(t,l))return No(s,t,l)}if((i=(i+1)%r)==o)break}return n}function la(n,t){var e,r,i,s,o=n.dom.ownerDocument;if(o.caretPositionFromPoint)try{var a=o.caretPositionFromPoint(t.left,t.top);a&&(i=(e=a).offsetNode,s=e.offset)}catch(x){}if(!i&&o.caretRangeFromPoint){var c=o.caretRangeFromPoint(t.left,t.top);c&&(i=(r=c).startContainer,s=r.startOffset)}var f,l=(n.root.elementFromPoint?n.root:o).elementFromPoint(t.left,t.top+1);if(!l||!n.dom.contains(1!=l.nodeType?l.parentNode:l)){var p=n.dom.getBoundingClientRect();if(!Qn(t,p)||!(l=No(n.dom,t,p)))return null}if(y.safari)for(var h=l;i&&h;h=Kn(h))h.draggable&&(i=s=null);if(l=function(n,t){var e=n.parentNode;return e&&/^li$/i.test(e.nodeName)&&t.left<n.getBoundingClientRect().left?e:n}(l,t),i){if(y.gecko&&1==i.nodeType&&(s=Math.min(s,i.childNodes.length))<i.childNodes.length){var g,d=i.childNodes[s];"IMG"==d.nodeName&&(g=d.getBoundingClientRect()).right<=t.left&&g.bottom>t.top&&s++}i==n.dom&&s==i.childNodes.length-1&&1==i.lastChild.nodeType&&t.top>i.lastChild.getBoundingClientRect().bottom?f=n.state.doc.content.size:(0==s||1!=i.nodeType||"BR"!=i.childNodes[s-1].nodeName)&&(f=function(n,t,e,r){for(var o=-1,i=t;i!=n.dom;){var s=n.docView.nearestDesc(i,!0);if(!s)return null;if(s.node.isBlock&&s.parent){var a=s.dom.getBoundingClientRect();if(a.left>r.left||a.top>r.top)o=s.posBefore;else{if(!(a.right<r.left||a.bottom<r.top))break;o=s.posAfter}}i=s.dom.parentNode}return o>-1?o:n.docView.posFromDOM(t,e)}(n,i,s,t))}null==f&&(f=function(n,t,e){var r=wo(t,e),o=r.node,i=r.offset,s=-1;if(1==o.nodeType&&!o.firstChild){var a=o.getBoundingClientRect();s=a.left!=a.right&&e.left>(a.left+a.right)/2?1:-1}return n.docView.posFromDOM(o,i,s)}(n,l,t));var v=n.docView.nearestDesc(l,!0);return{pos:f,inside:v?v.posAtStart-v.border:-1}}function Jt(n,t){var e=n.getClientRects();return e.length?e[t<0?0:e.length-1]:n.getBoundingClientRect()}var ua=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function Oo(n,t,e){var r=n.docView.domFromPos(t,e<0?-1:1),o=r.node,i=r.offset,s=y.webkit||y.gecko;if(3==o.nodeType){if(!s||!ua.test(o.nodeValue)&&(e<0?i:i!=o.nodeValue.length)){var f=i,p=i,h=e<0?1:-1;return e<0&&!i?(p++,h=-1):e>=0&&i==o.nodeValue.length?(f--,h=1):e<0?f--:p++,Ae(Jt(At(o,f,p),h),h<0)}var a=Jt(At(o,i,i),e);if(y.gecko&&i&&/\s/.test(o.nodeValue[i-1])&&i<o.nodeValue.length){var c=Jt(At(o,i-1,i-1),-1);if(c.top==a.top){var l=Jt(At(o,i,i+1),-1);if(l.top!=a.top)return Ae(l,l.left<c.left)}}return a}if(!n.state.doc.resolve(t).parent.inlineContent){if(i&&(e<0||i==Nt(o))){var d=o.childNodes[i-1];if(1==d.nodeType)return Yn(d.getBoundingClientRect(),!1)}if(i<Nt(o)){var g=o.childNodes[i];if(1==g.nodeType)return Yn(g.getBoundingClientRect(),!0)}return Yn(o.getBoundingClientRect(),e>=0)}if(i&&(e<0||i==Nt(o))){var v=o.childNodes[i-1],x=3==v.nodeType?At(v,Nt(v)-(s?0:1)):1!=v.nodeType||"BR"==v.nodeName&&v.nextSibling?null:v;if(x)return Ae(Jt(x,1),!1)}if(i<Nt(o)){for(var C=o.childNodes[i];C.pmViewDesc&&C.pmViewDesc.ignoreForCoords;)C=C.nextSibling;var _=C?3==C.nodeType?At(C,0,s?0:1):1==C.nodeType?C:null:null;if(_)return Ae(Jt(_,-1),!0)}return Ae(Jt(3==o.nodeType?At(o):o,-e),e>=0)}function Ae(n,t){if(0==n.width)return n;var e=t?n.left:n.right;return{top:n.top,bottom:n.bottom,left:e,right:e}}function Yn(n,t){if(0==n.height)return n;var e=t?n.top:n.bottom;return{top:e,bottom:e,left:n.left,right:n.right}}function To(n,t,e){var r=n.state,o=n.root.activeElement;r!=t&&n.updateState(t),o!=n.dom&&n.focus();try{return e()}finally{r!=t&&n.updateState(r),o!=n.dom&&o&&o.focus()}}var pa=/[\u0590-\u08ac]/,Eo=null,Do=null,Io=!1;var A=function(t,e,r,o){this.parent=t,this.children=e,this.dom=r,r.pmViewDesc=this,this.contentDOM=o,this.dirty=0},Ot={size:{configurable:!0},border:{configurable:!0},posBefore:{configurable:!0},posAtStart:{configurable:!0},posAfter:{configurable:!0},posAtEnd:{configurable:!0},contentLost:{configurable:!0},domAtom:{configurable:!0},ignoreForCoords:{configurable:!0}};A.prototype.matchesWidget=function(){return!1},A.prototype.matchesMark=function(){return!1},A.prototype.matchesNode=function(){return!1},A.prototype.matchesHack=function(t){return!1},A.prototype.parseRule=function(){return null},A.prototype.stopEvent=function(){return!1},Ot.size.get=function(){for(var n=0,t=0;t<this.children.length;t++)n+=this.children[t].size;return n},Ot.border.get=function(){return 0},A.prototype.destroy=function(){this.parent=null,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=null);for(var t=0;t<this.children.length;t++)this.children[t].destroy()},A.prototype.posBeforeChild=function(t){for(var e=0,r=this.posAtStart;e<this.children.length;e++){var o=this.children[e];if(o==t)return r;r+=o.size}},Ot.posBefore.get=function(){return this.parent.posBeforeChild(this)},Ot.posAtStart.get=function(){return this.parent?this.parent.posBeforeChild(this)+this.border:0},Ot.posAfter.get=function(){return this.posBefore+this.size},Ot.posAtEnd.get=function(){return this.posAtStart+this.size-2*this.border},A.prototype.localPosFromDOM=function(t,e,r){if(this.contentDOM&&this.contentDOM.contains(1==t.nodeType?t:t.parentNode)){if(r<0){var o,i;if(t==this.contentDOM)o=t.childNodes[e-1];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;o=t.previousSibling}for(;o&&(!(i=o.pmViewDesc)||i.parent!=this);)o=o.previousSibling;return o?this.posBeforeChild(i)+i.size:this.posAtStart}var s,a;if(t==this.contentDOM)s=t.childNodes[e];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;s=t.nextSibling}for(;s&&(!(a=s.pmViewDesc)||a.parent!=this);)s=s.nextSibling;return s?this.posBeforeChild(a):this.posAtEnd}var c;if(t==this.dom&&this.contentDOM)c=e>pt(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))c=2&t.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==e)for(var l=t;;l=l.parentNode){if(l==this.dom){c=!1;break}if(l.parentNode.firstChild!=l)break}if(null==c&&e==t.childNodes.length)for(var f=t;;f=f.parentNode){if(f==this.dom){c=!0;break}if(f.parentNode.lastChild!=f)break}}return(null==c?r>0:c)?this.posAtEnd:this.posAtStart},A.prototype.nearestDesc=function(t,e){for(var r=!0,o=t;o;o=o.parentNode){var i=this.getDesc(o);if(i&&(!e||i.node)){if(!r||!i.nodeDOM||(1==i.nodeDOM.nodeType?i.nodeDOM.contains(1==t.nodeType?t:t.parentNode):i.nodeDOM==t))return i;r=!1}}},A.prototype.getDesc=function(t){for(var e=t.pmViewDesc,r=e;r;r=r.parent)if(r==this)return e},A.prototype.posFromDOM=function(t,e,r){for(var o=t;o;o=o.parentNode){var i=this.getDesc(o);if(i)return i.localPosFromDOM(t,e,r)}return-1},A.prototype.descAt=function(t){for(var e=0,r=0;e<this.children.length;e++){var o=this.children[e],i=r+o.size;if(r==t&&i!=r){for(;!o.border&&o.children.length;)o=o.children[0];return o}if(t<i)return o.descAt(t-r-o.border);r=i}},A.prototype.domFromPos=function(t,e){if(!this.contentDOM)return{node:this.dom,offset:0};for(var r=0,o=0,i=0;r<this.children.length;r++){var s=this.children[r],a=i+s.size;if(a>t||s instanceof Fo){o=t-i;break}i=a}if(o)return this.children[r].domFromPos(o-this.children[r].border,e);for(var c=void 0;r&&!(c=this.children[r-1]).size&&c instanceof Po&&c.widget.type.side>=0;r--);if(e<=0){for(var l,f=!0;(l=r?this.children[r-1]:null)&&l.dom.parentNode!=this.contentDOM;r--,f=!1);return l&&e&&f&&!l.border&&!l.domAtom?l.domFromPos(l.size,e):{node:this.contentDOM,offset:l?pt(l.dom)+1:0}}for(var p,h=!0;(p=r<this.children.length?this.children[r]:null)&&p.dom.parentNode!=this.contentDOM;r++,h=!1);return p&&h&&!p.border&&!p.domAtom?p.domFromPos(0,e):{node:this.contentDOM,offset:p?pt(p.dom):this.contentDOM.childNodes.length}},A.prototype.parseRange=function(t,e,r){if(void 0===r&&(r=0),0==this.children.length)return{node:this.contentDOM,from:t,to:e,fromOffset:0,toOffset:this.contentDOM.childNodes.length};for(var o=-1,i=-1,s=r,a=0;;a++){var c=this.children[a],l=s+c.size;if(-1==o&&t<=l){var f=s+c.border;if(t>=f&&e<=l-c.border&&c.node&&c.contentDOM&&this.contentDOM.contains(c.contentDOM))return c.parseRange(t,e,f);t=s;for(var p=a;p>0;p--){var h=this.children[p-1];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(1)){o=pt(h.dom)+1;break}t-=h.size}-1==o&&(o=0)}if(o>-1&&(l>e||a==this.children.length-1)){e=l;for(var d=a+1;d<this.children.length;d++){var g=this.children[d];if(g.size&&g.dom.parentNode==this.contentDOM&&!g.emptyChildAt(-1)){i=pt(g.dom);break}e+=g.size}-1==i&&(i=this.contentDOM.childNodes.length);break}s=l}return{node:this.contentDOM,from:t,to:e,fromOffset:o,toOffset:i}},A.prototype.emptyChildAt=function(t){if(this.border||!this.contentDOM||!this.children.length)return!1;var e=this.children[t<0?0:this.children.length-1];return 0==e.size||e.emptyChildAt(t)},A.prototype.domAfterPos=function(t){var e=this.domFromPos(t,0),r=e.node,o=e.offset;if(1!=r.nodeType||o==r.childNodes.length)throw new RangeError("No node after pos "+t);return r.childNodes[o]},A.prototype.setSelection=function(t,e,r,o){for(var i=Math.min(t,e),s=Math.max(t,e),a=0,c=0;a<this.children.length;a++){var l=this.children[a],f=c+l.size;if(i>c&&s<f)return l.setSelection(t-c-l.border,e-c-l.border,r,o);c=f}var p=this.domFromPos(t,t?-1:1),h=e==t?p:this.domFromPos(e,e?-1:1),d=r.getSelection(),g=!1;if((y.gecko||y.safari)&&t==e){var v=p.node,x=p.offset;if(3==v.nodeType){if((g=x&&"\n"==v.nodeValue[x-1])&&x==v.nodeValue.length)for(var C=v,_=void 0;C;C=C.parentNode){if(_=C.nextSibling){"BR"==_.nodeName&&(p=h={node:_.parentNode,offset:pt(_)+1});break}var S=C.pmViewDesc;if(S&&S.node&&S.node.isBlock)break}}else{var k=v.childNodes[x-1];g=k&&("BR"==k.nodeName||"false"==k.contentEditable)}}if(y.gecko&&d.focusNode&&d.focusNode!=h.node&&1==d.focusNode.nodeType){var M=d.focusNode.childNodes[d.focusOffset];M&&"false"==M.contentEditable&&(o=!0)}if(o||g&&y.safari||!Ie(p.node,p.offset,d.anchorNode,d.anchorOffset)||!Ie(h.node,h.offset,d.focusNode,d.focusOffset)){var O=!1;if((d.extend||t==e)&&!g){d.collapse(p.node,p.offset);try{t!=e&&d.extend(h.node,h.offset),O=!0}catch(G){if(!(G instanceof DOMException))throw G}}if(!O){if(t>e){var R=p;p=h,h=R}var B=document.createRange();B.setEnd(h.node,h.offset),B.setStart(p.node,p.offset),d.removeAllRanges(),d.addRange(B)}}},A.prototype.ignoreMutation=function(t){return!this.contentDOM&&"selection"!=t.type},Ot.contentLost.get=function(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)},A.prototype.markDirty=function(t,e){for(var r=0,o=0;o<this.children.length;o++){var i=this.children[o],s=r+i.size;if(r==s?t<=s&&e>=r:t<s&&e>r){var a=r+i.border,c=s-i.border;if(t>=a&&e<=c)return this.dirty=t==r||e==s?2:1,void(t!=a||e!=c||!i.contentLost&&i.dom.parentNode==this.contentDOM?i.markDirty(t-a,e-a):i.dirty=3);i.dirty=i.dom!=i.contentDOM||i.dom.parentNode!=this.contentDOM||i.children.length?3:2}r=s}this.dirty=2},A.prototype.markParentsDirty=function(){for(var t=1,e=this.parent;e;e=e.parent,t++){var r=1==t?2:1;e.dirty<r&&(e.dirty=r)}},Ot.domAtom.get=function(){return!1},Ot.ignoreForCoords.get=function(){return!1},Object.defineProperties(A.prototype,Ot);var qt=[],Po=function(n){function t(r,o,i,s){var a,c=o.type.toDOM;if("function"==typeof c&&(c=c(i,function(){return a?a.parent?a.parent.posBeforeChild(a):void 0:s})),!o.type.spec.raw){if(1!=c.nodeType){var l=document.createElement("span");l.appendChild(c),c=l}c.contentEditable=!1,c.classList.add("ProseMirror-widget")}n.call(this,r,qt,c,null),this.widget=o,a=this}n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t;var e={domAtom:{configurable:!0}};return t.prototype.matchesWidget=function(o){return 0==this.dirty&&o.type.eq(this.widget.type)},t.prototype.parseRule=function(){return{ignore:!0}},t.prototype.stopEvent=function(o){var i=this.widget.spec.stopEvent;return!!i&&i(o)},t.prototype.ignoreMutation=function(o){return"selection"!=o.type||this.widget.spec.ignoreSelection},t.prototype.destroy=function(){this.widget.type.destroy(this.dom),n.prototype.destroy.call(this)},e.domAtom.get=function(){return!0},Object.defineProperties(t.prototype,e),t}(A),ga=function(n){function t(r,o,i,s){n.call(this,r,qt,o,null),this.textDOM=i,this.text=s}n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t;var e={size:{configurable:!0}};return e.size.get=function(){return this.text.length},t.prototype.localPosFromDOM=function(o,i){return o!=this.textDOM?this.posAtStart+(i?this.size:0):this.posAtStart+i},t.prototype.domFromPos=function(o){return{node:this.textDOM,offset:o}},t.prototype.ignoreMutation=function(o){return"characterData"===o.type&&o.target.nodeValue==o.oldValue},Object.defineProperties(t.prototype,e),t}(A),rn=function(n){function t(e,r,o,i){n.call(this,e,[],o,i),this.mark=r}return n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t,t.create=function(r,o,i,s){var a=s.nodeViews[o.type.name],c=a&&a(o,s,i);return(!c||!c.dom)&&(c=Z.renderSpec(document,o.type.spec.toDOM(o,i))),new t(r,o,c.dom,c.contentDOM||c.dom)},t.prototype.parseRule=function(){return 3&this.dirty||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}},t.prototype.matchesMark=function(r){return 3!=this.dirty&&this.mark.eq(r)},t.prototype.markDirty=function(r,o){if(n.prototype.markDirty.call(this,r,o),0!=this.dirty){for(var i=this.parent;!i.node;)i=i.parent;i.dirty<this.dirty&&(i.dirty=this.dirty),this.dirty=0}},t.prototype.slice=function(r,o,i){var s=t.create(this.parent,this.mark,!0,i),a=this.children,c=this.size;o<c&&(a=$n(a,o,c,i)),r>0&&(a=$n(a,0,r,i));for(var l=0;l<a.length;l++)a[l].parent=s;return s.children=a,s},t}(A),Re=function(n){function t(r,o,i,s,a,c,l,f,p){n.call(this,r,o.isLeaf?qt:[],a,c),this.nodeDOM=l,this.node=o,this.outerDeco=i,this.innerDeco=s,c&&this.updateChildren(f,p)}n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t;var e={size:{configurable:!0},border:{configurable:!0},domAtom:{configurable:!0}};return t.create=function(o,i,s,a,c,l){var f,h,p=c.nodeViews[i.type.name],d=p&&p(i,c,function(){return h?h.parent?h.parent.posBeforeChild(h):void 0:l},s,a),g=d&&d.dom,v=d&&d.contentDOM;if(i.isText)if(g){if(3!=g.nodeType)throw new RangeError("Text must be rendered as a DOM text node")}else g=document.createTextNode(i.text);else g||(g=(f=Z.renderSpec(document,i.type.spec.toDOM(i))).dom,v=f.contentDOM);!v&&!i.isText&&"BR"!=g.nodeName&&(g.hasAttribute("contenteditable")||(g.contentEditable=!1),i.type.spec.draggable&&(g.draggable=!0));var x=g;return g=Vo(g,s,i),d?h=new ma(o,i,s,a,g,v,x,d,c,l+1):i.isText?new zo(o,i,s,a,g,x,c):new t(o,i,s,a,g,v,x,c,l+1)},t.prototype.parseRule=function(){var o=this;if(this.node.type.spec.reparseInView)return null;var i={node:this.node.type.name,attrs:this.node.attrs};if("pre"==this.node.type.whitespace&&(i.preserveWhitespace="full"),this.contentDOM)if(this.contentLost){for(var s=this.children.length-1;s>=0;s--){var a=this.children[s];if(this.dom.contains(a.dom.parentNode)){i.contentElement=a.dom.parentNode;break}}i.contentElement||(i.getContent=function(){return m.empty})}else i.contentElement=this.contentDOM;else i.getContent=function(){return o.node.content};return i},t.prototype.matchesNode=function(o,i,s){return 0==this.dirty&&o.eq(this.node)&&Xn(i,this.outerDeco)&&s.eq(this.innerDeco)},e.size.get=function(){return this.node.nodeSize},e.border.get=function(){return this.node.isLeaf?0:1},t.prototype.updateChildren=function(o,i){var s=this,a=this.node.inlineContent,c=i,l=o.composing&&this.localCompositionInfo(o,i),f=l&&l.pos>-1?l:null,p=l&&l.pos<0,h=new mt(this,f&&f.node);(function(n,t,e,r){var o=t.locals(n),i=0;if(0!=o.length)for(var c=0,l=[],f=null,p=0;;){if(c<o.length&&o[c].to==i){for(var h=o[c++],d=void 0;c<o.length&&o[c].to==i;)(d||(d=[h])).push(o[c++]);if(d){d.sort(_a);for(var g=0;g<d.length;g++)e(d[g],p,!!f)}else e(h,p,!!f)}var v=void 0,x=void 0;if(f)x=-1,v=f,f=null;else{if(!(p<n.childCount))break;x=p,v=n.child(p++)}for(var C=0;C<l.length;C++)l[C].to<=i&&l.splice(C--,1);for(;c<o.length&&o[c].from<=i&&o[c].to>i;)l.push(o[c++]);var _=i+v.nodeSize;if(v.isText){var S=_;c<o.length&&o[c].from<S&&(S=o[c].from);for(var k=0;k<l.length;k++)l[k].to<S&&(S=l[k].to);S<_&&(f=v.cut(S-i),v=v.cut(0,S-i),_=S,x=-1)}r(v,l.length?v.isInline&&!v.isLeaf?l.filter(function(O){return!O.inline}):l.slice():qt,t.forChild(i,v),x),i=_}else for(var s=0;s<n.childCount;s++){var a=n.child(s);r(a,o,t.forChild(i,a),s),i+=a.nodeSize}})(this.node,this.innerDeco,function(d,g,v){d.spec.marks?h.syncToMarks(d.spec.marks,a,o):d.type.side>=0&&!v&&h.syncToMarks(g==s.node.childCount?N.none:s.node.child(g).marks,a,o),h.placeWidget(d,o,c)},function(d,g,v,x){var C;h.syncToMarks(d.marks,a,o),h.findNodeMatch(d,g,v,x)||p&&o.state.selection.from>c&&o.state.selection.to<c+d.nodeSize&&(C=h.findIndexWithChild(l.node))>-1&&h.updateNodeAt(d,g,v,C,o)||h.updateNextNode(d,g,v,o,x)||h.addNode(d,g,v,o,c),c+=d.nodeSize}),h.syncToMarks(qt,a,o),this.node.isTextblock&&h.addTextblockHacks(),h.destroyRest(),(h.changed||2==this.dirty)&&(f&&this.protectLocalComposition(o,f),Bo(this.contentDOM,this.children,o),y.ios&&function(n){if("UL"==n.nodeName||"OL"==n.nodeName){var t=n.style.cssText;n.style.cssText=t+"; list-style: square !important",window.getComputedStyle(n),n.style.cssText=t}}(this.dom))},t.prototype.localCompositionInfo=function(o,i){var s=o.state.selection,a=s.from,c=s.to;if(!(!(o.state.selection instanceof F)||a<i||c>i+this.node.content.size)){var l=o.root.getSelection(),f=function(n,t){for(;;){if(3==n.nodeType)return n;if(1==n.nodeType&&t>0){if(n.childNodes.length>t&&3==n.childNodes[t].nodeType)return n.childNodes[t];t=Nt(n=n.childNodes[t-1])}else{if(!(1==n.nodeType&&t<n.childNodes.length))return null;n=n.childNodes[t],t=0}}}(l.focusNode,l.focusOffset);if(f&&this.dom.contains(f.parentNode)){if(this.node.inlineContent){var p=f.nodeValue,h=function(n,t,e,r){for(var o=0,i=0;o<n.childCount&&i<=r;){var s=n.child(o++),a=i;if(i+=s.nodeSize,s.isText){for(var c=s.text;o<n.childCount;){var l=n.child(o++);if(i+=l.nodeSize,!l.isText)break;c+=l.text}if(i>=e){var f=a<r?c.lastIndexOf(t,r-a-1):-1;if(f>=0&&f+t.length+a>=e)return a+f;if(e==r&&c.length>=r+t.length-a&&c.slice(r-a,r-a+t.length)==t)return r}}}return-1}(this.node.content,p,a-i,c-i);return h<0?null:{node:f,pos:h,text:p}}return{node:f,pos:-1}}}},t.prototype.protectLocalComposition=function(o,i){var s=i.node,a=i.pos,c=i.text;if(!this.getDesc(s)){for(var l=s;l.parentNode!=this.contentDOM;l=l.parentNode){for(;l.previousSibling;)l.parentNode.removeChild(l.previousSibling);for(;l.nextSibling;)l.parentNode.removeChild(l.nextSibling);l.pmViewDesc&&(l.pmViewDesc=null)}var f=new ga(this,l,s,c);o.compositionNodes.push(f),this.children=$n(this.children,a,a+c.length,o,f)}},t.prototype.update=function(o,i,s,a){return!(3==this.dirty||!o.sameMarkup(this.node)||(this.updateInner(o,i,s,a),0))},t.prototype.updateInner=function(o,i,s,a){this.updateOuterDeco(i),this.node=o,this.innerDeco=s,this.contentDOM&&this.updateChildren(a,this.posAtStart),this.dirty=0},t.prototype.updateOuterDeco=function(o){if(!Xn(o,this.outerDeco)){var i=1!=this.nodeDOM.nodeType,s=this.dom;this.dom=Lo(this.dom,this.nodeDOM,Gn(this.outerDeco,this.node,i),Gn(o,this.node,i)),this.dom!=s&&(s.pmViewDesc=null,this.dom.pmViewDesc=this),this.outerDeco=o}},t.prototype.selectNode=function(){this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)},t.prototype.deselectNode=function(){this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable")},e.domAtom.get=function(){return this.node.isAtom},Object.defineProperties(t.prototype,e),t}(A);function Ro(n,t,e,r,o){return Vo(r,t,n),new Re(null,n,t,e,r,r,r,o,0)}var zo=function(n){function t(r,o,i,s,a,c,l){n.call(this,r,o,i,s,a,null,c,l)}n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t;var e={domAtom:{configurable:!0}};return t.prototype.parseRule=function(){for(var o=this.nodeDOM.parentNode;o&&o!=this.dom&&!o.pmIsDeco;)o=o.parentNode;return{skip:o||!0}},t.prototype.update=function(o,i,s,a){return!(3==this.dirty||0!=this.dirty&&!this.inParent()||!o.sameMarkup(this.node)||(this.updateOuterDeco(i),(0!=this.dirty||o.text!=this.node.text)&&o.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=o.text,a.trackWrites==this.nodeDOM&&(a.trackWrites=null)),this.node=o,this.dirty=0,0))},t.prototype.inParent=function(){for(var o=this.parent.contentDOM,i=this.nodeDOM;i;i=i.parentNode)if(i==o)return!0;return!1},t.prototype.domFromPos=function(o){return{node:this.nodeDOM,offset:o}},t.prototype.localPosFromDOM=function(o,i,s){return o==this.nodeDOM?this.posAtStart+Math.min(i,this.node.text.length):n.prototype.localPosFromDOM.call(this,o,i,s)},t.prototype.ignoreMutation=function(o){return"characterData"!=o.type&&"selection"!=o.type},t.prototype.slice=function(o,i,s){var a=this.node.cut(o,i),c=document.createTextNode(a.text);return new t(this.parent,a,this.outerDeco,this.innerDeco,c,c,s)},t.prototype.markDirty=function(o,i){n.prototype.markDirty.call(this,o,i),this.dom!=this.nodeDOM&&(0==o||i==this.nodeDOM.nodeValue.length)&&(this.dirty=3)},e.domAtom.get=function(){return!1},Object.defineProperties(t.prototype,e),t}(Re),Fo=function(n){function t(){n.apply(this,arguments)}n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t;var e={domAtom:{configurable:!0},ignoreForCoords:{configurable:!0}};return t.prototype.parseRule=function(){return{ignore:!0}},t.prototype.matchesHack=function(o){return 0==this.dirty&&this.dom.nodeName==o},e.domAtom.get=function(){return!0},e.ignoreForCoords.get=function(){return"IMG"==this.dom.nodeName},Object.defineProperties(t.prototype,e),t}(A),ma=function(n){function t(e,r,o,i,s,a,c,l,f,p){n.call(this,e,r,o,i,s,a,c,f,p),this.spec=l}return n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t,t.prototype.update=function(r,o,i,s){if(3==this.dirty)return!1;if(this.spec.update){var a=this.spec.update(r,o,i);return a&&this.updateInner(r,o,i,s),a}return!(!this.contentDOM&&!r.isLeaf)&&n.prototype.update.call(this,r,o,i,s)},t.prototype.selectNode=function(){this.spec.selectNode?this.spec.selectNode():n.prototype.selectNode.call(this)},t.prototype.deselectNode=function(){this.spec.deselectNode?this.spec.deselectNode():n.prototype.deselectNode.call(this)},t.prototype.setSelection=function(r,o,i,s){this.spec.setSelection?this.spec.setSelection(r,o,i):n.prototype.setSelection.call(this,r,o,i,s)},t.prototype.destroy=function(){this.spec.destroy&&this.spec.destroy(),n.prototype.destroy.call(this)},t.prototype.stopEvent=function(r){return!!this.spec.stopEvent&&this.spec.stopEvent(r)},t.prototype.ignoreMutation=function(r){return this.spec.ignoreMutation?this.spec.ignoreMutation(r):n.prototype.ignoreMutation.call(this,r)},t}(Re);function Bo(n,t,e){for(var r=n.firstChild,o=!1,i=0;i<t.length;i++){var s=t[i],a=s.dom;if(a.parentNode==n){for(;a!=r;)r=Ho(r),o=!0;r=r.nextSibling}else o=!0,n.insertBefore(a,r);if(s instanceof rn){var c=r?r.previousSibling:n.lastChild;Bo(s.contentDOM,s.children,e),r=c?c.nextSibling:n.firstChild}}for(;r;)r=Ho(r),o=!0;o&&e.trackWrites==n&&(e.trackWrites=null)}function ze(n){n&&(this.nodeName=n)}ze.prototype=Object.create(null);var Yt=[new ze];function Gn(n,t,e){if(0==n.length)return Yt;for(var r=e?Yt[0]:new ze,o=[r],i=0;i<n.length;i++){var s=n[i].type.attrs;if(s)for(var a in s.nodeName&&o.push(r=new ze(s.nodeName)),s){var c=s[a];null!=c&&(e&&1==o.length&&o.push(r=new ze(t.isInline?"span":"div")),"class"==a?r.class=(r.class?r.class+" ":"")+c:"style"==a?r.style=(r.style?r.style+";":"")+c:"nodeName"!=a&&(r[a]=c))}}return o}function Lo(n,t,e,r){if(e==Yt&&r==Yt)return t;for(var o=t,i=0;i<r.length;i++){var s=r[i],a=e[i];if(i){var c=void 0;a&&a.nodeName==s.nodeName&&o!=n&&(c=o.parentNode)&&c.tagName.toLowerCase()==s.nodeName||((c=document.createElement(s.nodeName)).pmIsDeco=!0,c.appendChild(o),a=Yt[0]),o=c}va(o,a||Yt[0],s)}return o}function va(n,t,e){for(var r in t)"class"!=r&&"style"!=r&&"nodeName"!=r&&!(r in e)&&n.removeAttribute(r);for(var o in e)"class"!=o&&"style"!=o&&"nodeName"!=o&&e[o]!=t[o]&&n.setAttribute(o,e[o]);if(t.class!=e.class){for(var i=t.class?t.class.split(" ").filter(Boolean):qt,s=e.class?e.class.split(" ").filter(Boolean):qt,a=0;a<i.length;a++)-1==s.indexOf(i[a])&&n.classList.remove(i[a]);for(var c=0;c<s.length;c++)-1==i.indexOf(s[c])&&n.classList.add(s[c]);0==n.classList.length&&n.removeAttribute("class")}if(t.style!=e.style){if(t.style)for(var f,l=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g;f=l.exec(t.style);)n.style.removeProperty(f[1]);e.style&&(n.style.cssText+=e.style)}}function Vo(n,t,e){return Lo(n,n,Yt,Gn(t,e,1!=n.nodeType))}function Xn(n,t){if(n.length!=t.length)return!1;for(var e=0;e<n.length;e++)if(!n[e].type.eq(t[e].type))return!1;return!0}function Ho(n){var t=n.nextSibling;return n.parentNode.removeChild(n),t}var mt=function(t,e){this.top=t,this.lock=e,this.index=0,this.stack=[],this.changed=!1,this.preMatch=function(n,t){var e=t,r=e.children.length,o=n.childCount,i=new Map,s=[];t:for(;o>0;){for(var a=void 0;;)if(r){var c=e.children[r-1];if(!(c instanceof rn)){a=c,r--;break}e=c,r=c.children.length}else{if(e==t)break t;r=e.parent.children.indexOf(e),e=e.parent}var l=a.node;if(l){if(l!=n.child(o-1))break;--o,i.set(a,o),s.push(a)}}return{index:o,matched:i,matches:s.reverse()}}(t.node.content,t)};function _a(n,t){return n.type.side-t.type.side}function $n(n,t,e,r,o){for(var i=[],s=0,a=0;s<n.length;s++){var c=n[s],l=a,f=a+=c.size;l>=e||f<=t?i.push(c):(l<t&&i.push(c.slice(0,t-l,r)),o&&(i.push(o),o=null),f>e&&i.push(c.slice(e-l,c.size,r)))}return i}function Jo(n,t){var e=n.root.getSelection(),r=n.state.doc;if(!e.focusNode)return null;var o=n.docView.nearestDesc(e.focusNode),i=o&&0==o.size,s=n.docView.posFromDOM(e.focusNode,e.focusOffset);if(s<0)return null;var c,l,a=r.resolve(s);if(jn(e)){for(c=a;o&&!o.node;)o=o.parent;if(o&&o.node.isAtom&&w.isSelectable(o.node)&&o.parent&&(!o.node.isInline||!function(n,t,e){for(var r=0==t,o=t==Nt(n);r||o;){if(n==e)return!0;var i=pt(n);if(!(n=n.parentNode))return!1;r=r&&0==i,o=o&&i==Nt(n)}}(e.focusNode,e.focusOffset,o.dom))){var f=o.posBefore;l=new w(s==f?a:r.resolve(f))}}else{var p=n.docView.posFromDOM(e.anchorNode,e.anchorOffset);if(p<0)return null;c=r.resolve(p)}return l||(l=er(n,c,a,"pointer"==t||n.state.selection.head<a.pos&&!i?1:-1)),l}function qo(n){return n.editable?n.hasFocus():nr(n)&&document.activeElement&&document.activeElement.contains(n.dom)}function Wt(n,t){var e=n.state.selection;if(Ko(n,e),qo(n)){if(!t&&n.mouseDown&&n.mouseDown.allowDefault&&y.chrome){var r=n.root.getSelection(),o=n.domObserver.currentSelection;if(r.anchorNode&&Ie(r.anchorNode,r.anchorOffset,o.anchorNode,o.anchorOffset))return n.mouseDown.delayedSelectionSync=!0,void n.domObserver.setCurSelection()}if(n.domObserver.disconnectSelection(),n.cursorWrapper)!function(n){var t=n.root.getSelection(),e=document.createRange(),r=n.cursorWrapper.dom,o="IMG"==r.nodeName;o?e.setEnd(r.parentNode,pt(r)+1):e.setEnd(r,0),e.collapse(!1),t.removeAllRanges(),t.addRange(e),!o&&!n.state.selection.visible&&y.ie&&y.ie_version<=11&&(r.disabled=!0,r.disabled=!1)}(n);else{var a,c,i=e.anchor,s=e.head;Wo&&!(e instanceof F)&&(e.$from.parent.inlineContent||(a=Zo(n,e.from)),!e.empty&&!e.$from.parent.inlineContent&&(c=Zo(n,e.to))),n.docView.setSelection(i,s,n.root,t),Wo&&(a&&Uo(a),c&&Uo(c)),e.visible?n.dom.classList.remove("ProseMirror-hideselection"):(n.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&function(n){var t=n.dom.ownerDocument;t.removeEventListener("selectionchange",n.hideSelectionGuard);var e=n.root.getSelection(),r=e.anchorNode,o=e.anchorOffset;t.addEventListener("selectionchange",n.hideSelectionGuard=function(){(e.anchorNode!=r||e.anchorOffset!=o)&&(t.removeEventListener("selectionchange",n.hideSelectionGuard),setTimeout(function(){(!qo(n)||n.state.selection.visible)&&n.dom.classList.remove("ProseMirror-hideselection")},20))})}(n))}n.domObserver.setCurSelection(),n.domObserver.connectSelection()}}mt.prototype.destroyBetween=function(t,e){if(t!=e){for(var r=t;r<e;r++)this.top.children[r].destroy();this.top.children.splice(t,e-t),this.changed=!0}},mt.prototype.destroyRest=function(){this.destroyBetween(this.index,this.top.children.length)},mt.prototype.syncToMarks=function(t,e,r){for(var o=0,i=this.stack.length>>1,s=Math.min(i,t.length);o<s&&(o==i-1?this.top:this.stack[o+1<<1]).matchesMark(t[o])&&!1!==t[o].type.spec.spanning;)o++;for(;o<i;)this.destroyRest(),this.top.dirty=0,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<t.length;){this.stack.push(this.top,this.index+1);for(var a=-1,c=this.index;c<Math.min(this.index+3,this.top.children.length);c++)if(this.top.children[c].matchesMark(t[i])){a=c;break}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{var l=rn.create(this.top,t[i],e,r);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,i++}},mt.prototype.findNodeMatch=function(t,e,r,o){var s,i=-1;if(o>=this.preMatch.index&&(s=this.preMatch.matches[o-this.preMatch.index]).parent==this.top&&s.matchesNode(t,e,r))i=this.top.children.indexOf(s,this.index);else for(var a=this.index,c=Math.min(this.top.children.length,a+5);a<c;a++){var l=this.top.children[a];if(l.matchesNode(t,e,r)&&!this.preMatch.matched.has(l)){i=a;break}}return!(i<0||(this.destroyBetween(this.index,i),this.index++,0))},mt.prototype.updateNodeAt=function(t,e,r,o,i){return!!this.top.children[o].update(t,e,r,i)&&(this.destroyBetween(this.index,o),this.index=o+1,!0)},mt.prototype.findIndexWithChild=function(t){for(;;){var e=t.parentNode;if(!e)return-1;if(e==this.top.contentDOM){var r=t.pmViewDesc;if(r)for(var o=this.index;o<this.top.children.length;o++)if(this.top.children[o]==r)return o;return-1}t=e}},mt.prototype.updateNextNode=function(t,e,r,o,i){for(var s=this.index;s<this.top.children.length;s++){var a=this.top.children[s];if(a instanceof Re){var c=this.preMatch.matched.get(a);if(null!=c&&c!=i)return!1;var l=a.dom;if((!this.lock||!(l==this.lock||1==l.nodeType&&l.contains(this.lock.parentNode))||t.isText&&a.node&&a.node.isText&&a.nodeDOM.nodeValue==t.text&&3!=a.dirty&&Xn(e,a.outerDeco))&&a.update(t,e,r,o))return this.destroyBetween(this.index,s),a.dom!=l&&(this.changed=!0),this.index++,!0;break}}return!1},mt.prototype.addNode=function(t,e,r,o,i){this.top.children.splice(this.index++,0,Re.create(this.top,t,e,r,o,i)),this.changed=!0},mt.prototype.placeWidget=function(t,e,r){var o=this.index<this.top.children.length?this.top.children[this.index]:null;if(!o||!o.matchesWidget(t)||t!=o.widget&&o.widget.type.toDOM.parentNode){var i=new Po(this.top,t,e,r);this.top.children.splice(this.index++,0,i),this.changed=!0}else this.index++},mt.prototype.addTextblockHacks=function(){for(var t=this.top.children[this.index-1];t instanceof rn;)t=t.children[t.children.length-1];(!t||!(t instanceof zo)||/\n$/.test(t.node.text))&&((y.safari||y.chrome)&&t&&"false"==t.dom.contentEditable&&this.addHackNode("IMG"),this.addHackNode("BR"))},mt.prototype.addHackNode=function(t){if(this.index<this.top.children.length&&this.top.children[this.index].matchesHack(t))this.index++;else{var e=document.createElement(t);"IMG"==t&&(e.className="ProseMirror-separator",e.alt=""),"BR"==t&&(e.className="ProseMirror-trailingBreak"),this.top.children.splice(this.index++,0,new Fo(this.top,qt,e,null)),this.changed=!0}};var Wo=y.safari||y.chrome&&y.chrome_version<63;function Zo(n,t){var e=n.docView.domFromPos(t,0),r=e.node,o=e.offset,i=o<r.childNodes.length?r.childNodes[o]:null,s=o?r.childNodes[o-1]:null;if(y.safari&&i&&"false"==i.contentEditable)return tr(i);if(!(i&&"false"!=i.contentEditable||s&&"false"!=s.contentEditable)){if(i)return tr(i);if(s)return tr(s)}}function tr(n){return n.contentEditable="true",y.safari&&n.draggable&&(n.draggable=!1,n.wasDraggable=!0),n}function Uo(n){n.contentEditable="false",n.wasDraggable&&(n.draggable=!0,n.wasDraggable=null)}function Ko(n,t){if(t instanceof w){var e=n.docView.descAt(t.from);e!=n.lastSelectedViewDesc&&(jo(n),e&&e.selectNode(),n.lastSelectedViewDesc=e)}else jo(n)}function jo(n){n.lastSelectedViewDesc&&(n.lastSelectedViewDesc.parent&&n.lastSelectedViewDesc.deselectNode(),n.lastSelectedViewDesc=null)}function er(n,t,e,r){return n.someProp("createSelectionBetween",function(o){return o(n,t,e)})||F.between(t,e,r)}function nr(n){var t=n.root.getSelection();if(!t.anchorNode)return!1;try{return n.dom.contains(3==t.anchorNode.nodeType?t.anchorNode.parentNode:t.anchorNode)&&(n.editable||n.dom.contains(3==t.focusNode.nodeType?t.focusNode.parentNode:t.focusNode))}catch(e){return!1}}function rr(n,t){var e=n.selection,r=e.$anchor,o=e.$head,i=t>0?r.max(o):r.min(o),s=i.parent.inlineContent?i.depth?n.doc.resolve(t>0?i.after():i.before()):null:i;return s&&D.findFrom(s,t)}function Gt(n,t){return n.dispatch(n.state.tr.setSelection(t).scrollIntoView()),!0}function Qo(n,t,e){var r=n.state.selection;if(!(r instanceof F)){if(r instanceof w&&r.node.isInline)return Gt(n,new F(t>0?r.$to:r.$from));var l=rr(n.state,t);return!!l&&Gt(n,l)}if(!r.empty||e.indexOf("s")>-1)return!1;if(n.endOfTextblock(t>0?"right":"left")){var o=rr(n.state,t);return!!(o&&o instanceof w)&&Gt(n,o)}if(!(y.mac&&e.indexOf("m")>-1)){var a,i=r.$head,s=i.textOffset?null:t<0?i.nodeBefore:i.nodeAfter;if(!s||s.isText)return!1;var c=t<0?i.pos-s.nodeSize:i.pos;return!!(s.isAtom||(a=n.docView.descAt(c))&&!a.contentDOM)&&(w.isSelectable(s)?Gt(n,new w(t<0?n.state.doc.resolve(i.pos-s.nodeSize):i)):!!y.webkit&&Gt(n,new F(n.state.doc.resolve(t<0?c:c+s.nodeSize))))}}function on(n){return 3==n.nodeType?n.nodeValue.length:n.childNodes.length}function Fe(n){var t=n.pmViewDesc;return t&&0==t.size&&(n.nextSibling||"BR"!=n.nodeName)}function or(n){var t=n.root.getSelection(),e=t.focusNode,r=t.focusOffset;if(e){var o,i,s=!1;for(y.gecko&&1==e.nodeType&&r<on(e)&&Fe(e.childNodes[r])&&(s=!0);;)if(r>0){if(1!=e.nodeType)break;var a=e.childNodes[r-1];if(Fe(a))o=e,i=--r;else{if(3!=a.nodeType)break;r=(e=a).nodeValue.length}}else{if(Yo(e))break;for(var c=e.previousSibling;c&&Fe(c);)o=e.parentNode,i=pt(c),c=c.previousSibling;if(c)r=on(e=c);else{if((e=e.parentNode)==n.dom)break;r=0}}s?sr(n,t,e,r):o&&sr(n,t,o,i)}}function ir(n){var t=n.root.getSelection(),e=t.focusNode,r=t.focusOffset;if(e){for(var i,s,o=on(e);;)if(r<o){if(1!=e.nodeType)break;if(!Fe(e.childNodes[r]))break;i=e,s=++r}else{if(Yo(e))break;for(var c=e.nextSibling;c&&Fe(c);)i=c.parentNode,s=pt(c)+1,c=c.nextSibling;if(c)r=0,o=on(e=c);else{if((e=e.parentNode)==n.dom)break;r=o=0}}i&&sr(n,t,i,s)}}function Yo(n){var t=n.pmViewDesc;return t&&t.node&&t.node.isBlock}function sr(n,t,e,r){if(jn(t)){var o=document.createRange();o.setEnd(e,r),o.setStart(e,r),t.removeAllRanges(),t.addRange(o)}else t.extend&&t.extend(e,r);n.domObserver.setCurSelection();var i=n.state;setTimeout(function(){n.state==i&&Wt(n)},50)}function Go(n,t,e){var r=n.state.selection;if(r instanceof F&&!r.empty||e.indexOf("s")>-1||y.mac&&e.indexOf("m")>-1)return!1;var o=r.$from,i=r.$to;if(!o.parent.inlineContent||n.endOfTextblock(t<0?"up":"down")){var s=rr(n.state,t);if(s&&s instanceof w)return Gt(n,s)}if(!o.parent.inlineContent){var a=t<0?o:i,c=r instanceof It?D.near(a,t):D.findFrom(a,t);return!!c&&Gt(n,c)}return!1}function Xo(n,t){if(!(n.state.selection instanceof F))return!0;var e=n.state.selection,r=e.$head,i=e.empty;if(!r.sameParent(e.$anchor))return!0;if(!i)return!1;if(n.endOfTextblock(t>0?"forward":"backward"))return!0;var s=!r.textOffset&&(t<0?r.nodeBefore:r.nodeAfter);if(s&&!s.isText){var a=n.state.tr;return t<0?a.delete(r.pos-s.nodeSize,r.pos):a.delete(r.pos,r.pos+s.nodeSize),n.dispatch(a),!0}return!1}function $o(n,t,e){n.domObserver.stop(),t.contentEditable=e,n.domObserver.start()}function Ia(n){var t=n.pmViewDesc;if(t)return t.parseRule();if("BR"==n.nodeName&&n.parentNode){if(y.safari&&/^(ul|ol)$/i.test(n.parentNode.nodeName)){var e=document.createElement("div");return e.appendChild(document.createElement("li")),{skip:e}}if(n.parentNode.lastChild==n||y.safari&&/^(tr|table)$/i.test(n.parentNode.nodeName))return{ignore:!0}}else if("IMG"==n.nodeName&&n.getAttribute("mark-placeholder"))return{ignore:!0}}function ti(n,t,e){return Math.max(e.anchor,e.head)>t.content.size?null:er(n,t.resolve(e.anchor),t.resolve(e.head))}function ar(n,t,e){for(var r=n.depth,o=t?n.end():n.pos;r>0&&(t||n.indexAfter(r)==n.node(r).childCount);)r--,o++,t=!1;if(e)for(var i=n.node(r).maybeChild(n.indexAfter(r));i&&!i.isLeaf;)i=i.firstChild,o++;return o}function ei(n,t){for(var e=[],r=t.content,o=t.openStart,i=t.openEnd;o>1&&i>1&&1==r.childCount&&1==r.firstChild.childCount;){o--,i--;var s=r.firstChild;e.push(s.type.name,s.attrs!=s.type.defaultAttrs?s.attrs:null),r=s.content}var a=n.someProp("clipboardSerializer")||Z.fromSchema(n.state.schema),c=li(),l=c.createElement("div");l.appendChild(a.serializeFragment(r,{document:c}));for(var p,f=l.firstChild;f&&1==f.nodeType&&(p=ai[f.nodeName.toLowerCase()]);){for(var h=p.length-1;h>=0;h--){for(var d=c.createElement(p[h]);l.firstChild;)d.appendChild(l.firstChild);l.appendChild(d),"tbody"!=p[h]&&(o++,i++)}f=l.firstChild}return f&&1==f.nodeType&&f.setAttribute("data-pm-slice",o+" "+i+" "+JSON.stringify(e)),{dom:l,text:n.someProp("clipboardTextSerializer",function(v){return v(t)})||t.content.textBetween(0,t.content.size,"\n\n")}}function ni(n,t,e,r,o){var i,a,s=o.parent.type.spec.code;if(!e&&!t)return null;var c=t&&(r||s||!e);if(c){if(n.someProp("transformPastedText",function(M){t=M(t,s||r)}),s)return t?new b(m.from(n.state.schema.text(t.replace(/\r\n?/g,"\n"))),0,0):b.empty;var l=n.someProp("clipboardTextParser",function(M){return M(t,o,r)});if(l)a=l;else{var f=o.marks(),h=n.state.schema,d=Z.fromSchema(h);i=document.createElement("div"),t.split(/(?:\r\n?|\n)+/).forEach(function(M){var O=i.appendChild(document.createElement("p"));M&&O.appendChild(d.serializeNode(h.text(M,f)))})}}else n.someProp("transformPastedHTML",function(M){e=M(e)}),i=function(n){var t=/^(\s*<meta [^>]*>)*/.exec(n);t&&(n=n.slice(t[0].length));var o,e=li().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(n);if((o=r&&ai[r[1].toLowerCase()])&&(n=o.map(function(s){return"<"+s+">"}).join("")+n+o.map(function(s){return"</"+s+">"}).reverse().join("")),e.innerHTML=n,o)for(var i=0;i<o.length;i++)e=e.querySelector(o[i])||e;return e}(e),y.webkit&&function(n){for(var t=n.querySelectorAll(y.chrome?"span:not([class]):not([style])":"span.Apple-converted-space"),e=0;e<t.length;e++){var r=t[e];1==r.childNodes.length&&"\xa0"==r.textContent&&r.parentNode&&r.parentNode.replaceChild(n.ownerDocument.createTextNode(" "),r)}}(i);var g=i&&i.querySelector("[data-pm-slice]"),v=g&&/^(\d+) (\d+) (.*)/.exec(g.getAttribute("data-pm-slice"));if(!a){var x=n.someProp("clipboardParser")||n.someProp("domParser")||dt.fromSchema(n.state.schema);a=x.parseSlice(i,{preserveWhitespace:!(!c&&!v),context:o,ruleFromNode:function(O){if("BR"==O.nodeName&&!O.nextSibling&&O.parentNode&&!Fa.test(O.parentNode.nodeName))return{ignore:!0}}})}if(v)a=function(n,t){if(!n.size)return n;var r,e=n.content.firstChild.type.schema;try{r=JSON.parse(t)}catch(l){return n}for(var o=n.content,i=n.openStart,s=n.openEnd,a=r.length-2;a>=0;a-=2){var c=e.nodes[r[a]];if(!c||c.hasRequiredAttrs())break;o=m.from(c.create(r[a+1],o)),i++,s++}return new b(o,i,s)}(si(a,+v[1],+v[2]),v[3]);else if((a=b.maxOpen(function(n,t){if(n.childCount<2)return n;for(var e=function(i){var a=t.node(i).contentMatchAt(t.index(i)),c=void 0,l=[];if(n.forEach(function(f){if(l){var h,p=a.findWrapping(f.type);if(!p)return l=null;if(h=l.length&&c.length&&oi(p,c,f,l[l.length-1],0))l[l.length-1]=h;else{l.length&&(l[l.length-1]=ii(l[l.length-1],c.length));var d=ri(f,p);l.push(d),a=a.matchType(d.type,d.attrs),c=p}}}),l)return{v:m.from(l)}},r=t.depth;r>=0;r--){var o=e(r);if(o)return o.v}return n}(a.content,o),!0)).openStart||a.openEnd){for(var C=0,_=0,S=a.content.firstChild;C<a.openStart&&!S.type.spec.isolating;C++,S=S.firstChild);for(var k=a.content.lastChild;_<a.openEnd&&!k.type.spec.isolating;_++,k=k.lastChild);a=si(a,C,_)}return n.someProp("transformPasted",function(M){a=M(a)}),a}var Fa=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function ri(n,t,e){void 0===e&&(e=0);for(var r=t.length-1;r>=e;r--)n=t[r].create(null,m.from(n));return n}function oi(n,t,e,r,o){if(o<n.length&&o<t.length&&n[o]==t[o]){var i=oi(n,t,e,r.lastChild,o+1);if(i)return r.copy(r.content.replaceChild(r.childCount-1,i));if(r.contentMatchAt(r.childCount).matchType(o==n.length-1?e.type:n[o+1]))return r.copy(r.content.append(m.from(ri(e,n,o+1))))}}function ii(n,t){if(0==t)return n;var e=n.content.replaceChild(n.childCount-1,ii(n.lastChild,t-1)),r=n.contentMatchAt(n.childCount).fillBefore(m.empty,!0);return n.copy(e.append(r))}function cr(n,t,e,r,o,i){var s=t<0?n.firstChild:n.lastChild,a=s.content;return o<r-1&&(a=cr(a,t,e,r,o+1,i)),o>=e&&(a=t<0?s.contentMatchAt(0).fillBefore(a,n.childCount>1||i<=o).append(a):a.append(s.contentMatchAt(s.childCount).fillBefore(m.empty,!0))),n.replaceChild(t<0?0:n.childCount-1,s.copy(a))}function si(n,t,e){return t<n.openStart&&(n=new b(cr(n.content,-1,t,n.openStart,0,n.openEnd),t,n.openEnd)),e<n.openEnd&&(n=new b(cr(n.content,1,e,n.openEnd,0,0),n.openStart,e)),n}var ai={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},ci=null;function li(){return ci||(ci=document.implementation.createHTMLDocument("title"))}var Ja={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},lr=y.ie&&y.ie_version<=11,ur=function(){this.anchorNode=this.anchorOffset=this.focusNode=this.focusOffset=null};ur.prototype.set=function(t){this.anchorNode=t.anchorNode,this.anchorOffset=t.anchorOffset,this.focusNode=t.focusNode,this.focusOffset=t.focusOffset},ur.prototype.eq=function(t){return t.anchorNode==this.anchorNode&&t.anchorOffset==this.anchorOffset&&t.focusNode==this.focusNode&&t.focusOffset==this.focusOffset};var ht=function(t,e){var r=this;this.view=t,this.handleDOMChange=e,this.queue=[],this.flushingSoon=-1,this.observer=window.MutationObserver&&new window.MutationObserver(function(o){for(var i=0;i<o.length;i++)r.queue.push(o[i]);y.ie&&y.ie_version<=11&&o.some(function(s){return"childList"==s.type&&s.removedNodes.length||"characterData"==s.type&&s.oldValue.length>s.target.nodeValue.length})?r.flushSoon():r.flush()}),this.currentSelection=new ur,lr&&(this.onCharData=function(o){r.queue.push({target:o.target,type:"characterData",oldValue:o.prevValue}),r.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.suppressingSelectionUpdates=!1};ht.prototype.flushSoon=function(){var t=this;this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(function(){t.flushingSoon=-1,t.flush()},20))},ht.prototype.forceFlush=function(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())},ht.prototype.start=function(){this.observer&&this.observer.observe(this.view.dom,Ja),lr&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()},ht.prototype.stop=function(){var t=this;if(this.observer){var e=this.observer.takeRecords();if(e.length){for(var r=0;r<e.length;r++)this.queue.push(e[r]);window.setTimeout(function(){return t.flush()},20)}this.observer.disconnect()}lr&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()},ht.prototype.connectSelection=function(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)},ht.prototype.disconnectSelection=function(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)},ht.prototype.suppressSelectionUpdates=function(){var t=this;this.suppressingSelectionUpdates=!0,setTimeout(function(){return t.suppressingSelectionUpdates=!1},50)},ht.prototype.onSelectionChange=function(){if((!(n=this.view).editable||n.root.activeElement==n.dom)&&nr(n)){if(this.suppressingSelectionUpdates)return Wt(this.view);if(y.ie&&y.ie_version<=11&&!this.view.state.selection.empty){var t=this.view.root.getSelection();if(t.focusNode&&Ie(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset))return this.flushSoon()}this.flush()}var n},ht.prototype.setCurSelection=function(){this.currentSelection.set(this.view.root.getSelection())},ht.prototype.ignoreSelectionChange=function(t){if(0==t.rangeCount)return!0;var e=t.getRangeAt(0).commonAncestorContainer,r=this.view.docView.nearestDesc(e);return r&&r.ignoreMutation({type:"selection",target:3==e.nodeType?e.parentNode:e})?(this.setCurSelection(),!0):void 0},ht.prototype.flush=function(){if(this.view.docView&&!(this.flushingSoon>-1)){var t=this.observer?this.observer.takeRecords():[];this.queue.length&&(t=this.queue.concat(t),this.queue.length=0);var e=this.view.root.getSelection(),r=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(e)&&nr(this.view)&&!this.ignoreSelectionChange(e),o=-1,i=-1,s=!1,a=[];if(this.view.editable)for(var c=0;c<t.length;c++){var l=this.registerMutation(t[c],a);l&&(o=o<0?l.from:Math.min(l.from,o),i=i<0?l.to:Math.max(l.to,i),l.typeOver&&(s=!0))}if(y.gecko&&a.length>1){var f=a.filter(function(d){return"BR"==d.nodeName});if(2==f.length){var p=f[0],h=f[1];p.parentNode&&p.parentNode.parentNode==h.parentNode?h.remove():p.remove()}}(o>-1||r)&&(o>-1&&(this.view.docView.markDirty(o,i),ui||(ui=!0,"normal"==getComputedStyle(this.view.dom).whiteSpace&&console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."))),this.handleDOMChange(o,i,s,a),this.view.docView&&this.view.docView.dirty?this.view.updateState(this.view.state):this.currentSelection.eq(e)||Wt(this.view),this.currentSelection.set(e))}},ht.prototype.registerMutation=function(t,e){if(e.indexOf(t.target)>-1)return null;var r=this.view.docView.nearestDesc(t.target);if("attributes"==t.type&&(r==this.view.docView||"contenteditable"==t.attributeName||"style"==t.attributeName&&!t.oldValue&&!t.target.getAttribute("style"))||!r||r.ignoreMutation(t))return null;if("childList"==t.type){for(var o=0;o<t.addedNodes.length;o++)e.push(t.addedNodes[o]);if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(t.target))return{from:r.posBefore,to:r.posAfter};var i=t.previousSibling,s=t.nextSibling;if(y.ie&&y.ie_version<=11&&t.addedNodes.length)for(var a=0;a<t.addedNodes.length;a++){var c=t.addedNodes[a],l=c.previousSibling,f=c.nextSibling;(!l||Array.prototype.indexOf.call(t.addedNodes,l)<0)&&(i=l),(!f||Array.prototype.indexOf.call(t.addedNodes,f)<0)&&(s=f)}var p=i&&i.parentNode==t.target?pt(i)+1:0,h=r.localPosFromDOM(t.target,p,-1),d=s&&s.parentNode==t.target?pt(s):t.target.childNodes.length;return{from:h,to:r.localPosFromDOM(t.target,d,1)}}return"attributes"==t.type?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:{from:r.posAtStart,to:r.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}};var ui=!1,lt={},st={};function Xt(n,t){n.lastSelectionOrigin=t,n.lastSelectionTime=Date.now()}function fr(n){n.someProp("handleDOMEvents",function(t){for(var e in t)n.eventHandlers[e]||n.dom.addEventListener(e,n.eventHandlers[e]=function(r){return pr(n,r)})})}function pr(n,t){return n.someProp("handleDOMEvents",function(e){var r=e[t.type];return!!r&&(r(n,t)||t.defaultPrevented)})}function sn(n){return{left:n.clientX,top:n.clientY}}function hr(n,t,e,r,o){if(-1==r)return!1;for(var i=n.state.doc.resolve(r),s=function(l){if(n.someProp(t,function(f){return l>i.depth?f(n,e,i.nodeAfter,i.before(l),o,!0):f(n,e,i.node(l),i.before(l),o,!1)}))return{v:!0}},a=i.depth+1;a>0;a--){var c=s(a);if(c)return c.v}return!1}function de(n,t,e){n.focused||n.focus();var r=n.state.tr.setSelection(t);"pointer"==e&&r.setMeta("pointer",!0),n.dispatch(r)}function Xa(n,t,e,r){return hr(n,"handleDoubleClickOn",t,e,r)||n.someProp("handleDoubleClick",function(o){return o(n,t,r)})}function $a(n,t,e,r){return hr(n,"handleTripleClickOn",t,e,r)||n.someProp("handleTripleClick",function(o){return o(n,t,r)})||function(n,t,e){if(0!=e.button)return!1;var r=n.state.doc;if(-1==t)return!!r.inlineContent&&(de(n,F.create(r,0,r.content.size),"pointer"),!0);for(var o=r.resolve(t),i=o.depth+1;i>0;i--){var s=i>o.depth?o.nodeAfter:o.node(i),a=o.before(i);if(s.inlineContent)de(n,F.create(r,a+1,a+1+s.content.size),"pointer");else{if(!w.isSelectable(s))continue;de(n,w.create(r,a),"pointer")}return!0}}(n,e,r)}function dr(n){return cn(n)}st.keydown=function(n,t){if(n.shiftKey=16==t.keyCode||t.shiftKey,!pi(n,t)&&(n.lastKeyCode=t.keyCode,n.lastKeyCodeTime=Date.now(),!y.android||!y.chrome||13!=t.keyCode))if(229!=t.keyCode&&n.domObserver.forceFlush(),!y.ios||13!=t.keyCode||t.ctrlKey||t.altKey||t.metaKey)n.someProp("handleKeyDown",function(r){return r(n,t)})||function(n,t){var e=t.keyCode,r=function(n){var t="";return n.ctrlKey&&(t+="c"),n.metaKey&&(t+="m"),n.altKey&&(t+="a"),n.shiftKey&&(t+="s"),t}(t);return 8==e||y.mac&&72==e&&"c"==r?Xo(n,-1)||or(n):46==e||y.mac&&68==e&&"c"==r?Xo(n,1)||ir(n):13==e||27==e||(37==e?Qo(n,-1,r)||or(n):39==e?Qo(n,1,r)||ir(n):38==e?Go(n,-1,r)||or(n):40==e?function(n){if(y.safari&&!(n.state.selection.$head.parentOffset>0)){var t=n.root.getSelection(),e=t.focusNode;if(e&&1==e.nodeType&&0==t.focusOffset&&e.firstChild&&"false"==e.firstChild.contentEditable){var o=e.firstChild;$o(n,o,!0),setTimeout(function(){return $o(n,o,!1)},20)}}}(n)||Go(n,1,r)||ir(n):r==(y.mac?"m":"c")&&(66==e||73==e||89==e||90==e))}(n,t)?t.preventDefault():Xt(n,"key");else{var e=Date.now();n.lastIOSEnter=e,n.lastIOSEnterFallbackTimeout=setTimeout(function(){n.lastIOSEnter==e&&(n.someProp("handleKeyDown",function(r){return r(n,pe(13,"Enter"))}),n.lastIOSEnter=0)},200)}},st.keyup=function(n,t){16==t.keyCode&&(n.shiftKey=!1)},st.keypress=function(n,t){if(!(pi(n,t)||!t.charCode||t.ctrlKey&&!t.altKey||y.mac&&t.metaKey)){if(n.someProp("handleKeyPress",function(o){return o(n,t)}))return void t.preventDefault();var e=n.state.selection;if(!(e instanceof F&&e.$from.sameParent(e.$to))){var r=String.fromCharCode(t.charCode);n.someProp("handleTextInput",function(o){return o(n,e.$from.pos,e.$to.pos,r)})||n.dispatch(n.state.tr.insertText(r).scrollIntoView()),t.preventDefault()}}};var fi=y.mac?"metaKey":"ctrlKey";lt.mousedown=function(n,t){n.shiftKey=t.shiftKey;var e=dr(n),r=Date.now(),o="singleClick";r-n.lastClick.time<500&&function(n,t){var e=t.x-n.clientX,r=t.y-n.clientY;return e*e+r*r<100}(t,n.lastClick)&&!t[fi]&&("singleClick"==n.lastClick.type?o="doubleClick":"doubleClick"==n.lastClick.type&&(o="tripleClick")),n.lastClick={time:r,x:t.clientX,y:t.clientY,type:o};var i=n.posAtCoords(sn(t));!i||("singleClick"==o?(n.mouseDown&&n.mouseDown.done(),n.mouseDown=new an(n,i,t,e)):("doubleClick"==o?Xa:$a)(n,i.pos,i.inside,t)?t.preventDefault():Xt(n,"pointer"))};var an=function(t,e,r,o){var s,a,i=this;if(this.view=t,this.startDoc=t.state.doc,this.pos=e,this.event=r,this.flushed=o,this.selectNode=r[fi],this.allowDefault=r.shiftKey,this.delayedSelectionSync=!1,e.inside>-1)s=t.state.doc.nodeAt(e.inside),a=e.inside;else{var c=t.state.doc.resolve(e.pos);s=c.parent,a=c.depth?c.before():0}this.mightDrag=null;var l=o?null:r.target,f=l?t.docView.nearestDesc(l,!0):null;this.target=f?f.dom:null;var h=t.state.selection;(0==r.button&&s.type.spec.draggable&&!1!==s.type.spec.selectable||h instanceof w&&h.from<=a&&h.to>a)&&(this.mightDrag={node:s,pos:a,addAttr:this.target&&!this.target.draggable,setUneditable:this.target&&y.gecko&&!this.target.hasAttribute("contentEditable")}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(function(){i.view.mouseDown==i&&i.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),t.root.addEventListener("mouseup",this.up=this.up.bind(this)),t.root.addEventListener("mousemove",this.move=this.move.bind(this)),Xt(t,"pointer")};function pi(n,t){return!!n.composing||!!(y.safari&&Math.abs(t.timeStamp-n.compositionEndedAt)<500)&&(n.compositionEndedAt=-2e8,!0)}an.prototype.done=function(){var t=this;this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(function(){return Wt(t.view)}),this.view.mouseDown=null},an.prototype.up=function(t){if(this.done(),this.view.dom.contains(3==t.target.nodeType?t.target.parentNode:t.target)){var e=this.pos;this.view.state.doc!=this.startDoc&&(e=this.view.posAtCoords(sn(t))),this.allowDefault||!e?Xt(this.view,"pointer"):function(n,t,e,r,o){return hr(n,"handleClickOn",t,e,r)||n.someProp("handleClick",function(i){return i(n,t,r)})||(o?function(n,t){if(-1==t)return!1;var r,o,e=n.state.selection;e instanceof w&&(r=e.node);for(var i=n.state.doc.resolve(t),s=i.depth+1;s>0;s--){var a=s>i.depth?i.nodeAfter:i.node(s);if(w.isSelectable(a)){o=r&&e.$from.depth>0&&s>=e.$from.depth&&i.before(e.$from.depth+1)==e.$from.pos?i.before(e.$from.depth):i.before(s);break}}return null!=o&&(de(n,w.create(n.state.doc,o),"pointer"),!0)}(n,e):function(n,t){if(-1==t)return!1;var e=n.state.doc.resolve(t),r=e.nodeAfter;return!!(r&&r.isAtom&&w.isSelectable(r))&&(de(n,new w(e),"pointer"),!0)}(n,e))}(this.view,e.pos,e.inside,t,this.selectNode)?t.preventDefault():0==t.button&&(this.flushed||y.safari&&this.mightDrag&&!this.mightDrag.node.isAtom||y.chrome&&!(this.view.state.selection instanceof F)&&Math.min(Math.abs(e.pos-this.view.state.selection.from),Math.abs(e.pos-this.view.state.selection.to))<=2)?(de(this.view,D.near(this.view.state.doc.resolve(e.pos)),"pointer"),t.preventDefault()):Xt(this.view,"pointer")}},an.prototype.move=function(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0),Xt(this.view,"pointer"),0==t.buttons&&this.done()},lt.touchdown=function(n){dr(n),Xt(n,"pointer")},lt.contextmenu=function(n){return dr(n)};var ec=y.android?5e3:-1;function hi(n,t){clearTimeout(n.composingTimeout),t>-1&&(n.composingTimeout=setTimeout(function(){return cn(n)},t))}function di(n){for(n.composing&&(n.composing=!1,n.compositionEndedAt=function(){var n=document.createEvent("Event");return n.initEvent("event",!0,!0),n.timeStamp}());n.compositionNodes.length>0;)n.compositionNodes.pop().markParentsDirty()}function cn(n,t){if(!(y.android&&n.domObserver.flushingSoon>=0)){if(n.domObserver.forceFlush(),di(n),t||n.docView&&n.docView.dirty){var e=Jo(n);return e&&!e.eq(n.state.selection)?n.dispatch(n.state.tr.setSelection(e)):n.updateState(n.state),!0}return!1}}st.compositionstart=st.compositionupdate=function(n){if(!n.composing){n.domObserver.flush();var t=n.state,e=t.selection.$from;if(t.selection.empty&&(t.storedMarks||!e.textOffset&&e.parentOffset&&e.nodeBefore.marks.some(function(a){return!1===a.type.spec.inclusive})))n.markCursor=n.state.storedMarks||e.marks(),cn(n,!0),n.markCursor=null;else if(cn(n),y.gecko&&t.selection.empty&&e.parentOffset&&!e.textOffset&&e.nodeBefore.marks.length)for(var r=n.root.getSelection(),o=r.focusNode,i=r.focusOffset;o&&1==o.nodeType&&0!=i;){var s=i<0?o.lastChild:o.childNodes[i-1];if(!s)break;if(3==s.nodeType){r.collapse(s,s.nodeValue.length);break}o=s,i=-1}n.composing=!0}hi(n,ec)},st.compositionend=function(n,t){n.composing&&(n.composing=!1,n.compositionEndedAt=t.timeStamp,hi(n,20))};var ge=y.ie&&y.ie_version<15||y.ios&&y.webkit_version<604;function gr(n,t,e,r){var o=ni(n,t,e,n.shiftKey,n.state.selection.$from);if(n.someProp("handlePaste",function(a){return a(n,r,o||b.empty)}))return!0;if(!o)return!1;var i=function(n){return 0==n.openStart&&0==n.openEnd&&1==n.content.childCount?n.content.firstChild:null}(o),s=i?n.state.tr.replaceSelectionWith(i,n.shiftKey):n.state.tr.replaceSelection(o);return n.dispatch(s.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}lt.copy=st.cut=function(n,t){var e=n.state.selection,r="cut"==t.type;if(!e.empty){var o=ge?null:t.clipboardData,s=ei(n,e.content()),a=s.dom,c=s.text;o?(t.preventDefault(),o.clearData(),o.setData("text/html",a.innerHTML),o.setData("text/plain",c)):function(n,t){if(n.dom.parentNode){var e=n.dom.parentNode.appendChild(document.createElement("div"));e.appendChild(t),e.style.cssText="position: fixed; left: -10000px; top: 10px";var r=getSelection(),o=document.createRange();o.selectNodeContents(t),n.dom.blur(),r.removeAllRanges(),r.addRange(o),setTimeout(function(){e.parentNode&&e.parentNode.removeChild(e),n.focus()},50)}}(n,a),r&&n.dispatch(n.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))}},st.paste=function(n,t){if(!n.composing||y.android){var e=ge?null:t.clipboardData;e&&gr(n,e.getData("text/plain"),e.getData("text/html"),t)?t.preventDefault():function(n,t){if(n.dom.parentNode){var e=n.shiftKey||n.state.selection.$from.parent.type.spec.code,r=n.dom.parentNode.appendChild(document.createElement(e?"textarea":"div"));e||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus(),setTimeout(function(){n.focus(),r.parentNode&&r.parentNode.removeChild(r),e?gr(n,r.value,null,t):gr(n,r.textContent,r.innerHTML,t)},50)}}(n,t)}};var sc=function(t,e){this.slice=t,this.move=e},gi=y.mac?"altKey":"ctrlKey";for(var mi in lt.dragstart=function(n,t){var e=n.mouseDown;if(e&&e.done(),t.dataTransfer){var r=n.state.selection,o=r.empty?null:n.posAtCoords(sn(t));if(!(o&&o.pos>=r.from&&o.pos<=(r instanceof w?r.to-1:r.to)))if(e&&e.mightDrag)n.dispatch(n.state.tr.setSelection(w.create(n.state.doc,e.mightDrag.pos)));else if(t.target&&1==t.target.nodeType){var i=n.docView.nearestDesc(t.target,!0);i&&i.node.type.spec.draggable&&i!=n.docView&&n.dispatch(n.state.tr.setSelection(w.create(n.state.doc,i.posBefore)))}var s=n.state.selection.content(),a=ei(n,s),c=a.dom,l=a.text;t.dataTransfer.clearData(),t.dataTransfer.setData(ge?"Text":"text/html",c.innerHTML),t.dataTransfer.effectAllowed="copyMove",ge||t.dataTransfer.setData("text/plain",l),n.dragging=new sc(s,!t[gi])}},lt.dragend=function(n){var t=n.dragging;window.setTimeout(function(){n.dragging==t&&(n.dragging=null)},50)},st.dragover=st.dragenter=function(n,t){return t.preventDefault()},st.drop=function(n,t){var e=n.dragging;if(n.dragging=null,t.dataTransfer){var r=n.posAtCoords(sn(t));if(r){var o=n.state.doc.resolve(r.pos);if(o){var i=e&&e.slice;i?n.someProp("transformPasted",function(g){i=g(i)}):i=ni(n,t.dataTransfer.getData(ge?"Text":"text/plain"),ge?null:t.dataTransfer.getData("text/html"),!1,o);var s=e&&!t[gi];if(n.someProp("handleDrop",function(g){return g(n,t,i||b.empty,s)}))return void t.preventDefault();if(i){t.preventDefault();var a=i?function(n,t,e){var r=n.resolve(t);if(!e.content.size)return t;for(var o=e.content,i=0;i<e.openStart;i++)o=o.firstChild.content;for(var s=1;s<=(0==e.openStart&&e.size?2:1);s++)for(var a=r.depth;a>=0;a--){var c=a==r.depth?0:r.pos<=(r.start(a+1)+r.end(a+1))/2?-1:1,l=r.index(a)+(c>0?1:0),f=r.node(a),p=!1;if(1==s)p=f.canReplace(l,l,o);else{var h=f.contentMatchAt(l).findWrapping(o.firstChild.type);p=h&&f.canReplaceWith(l,l,h[0])}if(p)return 0==c?r.pos:c<0?r.before(a+1):r.after(a+1)}return null}(n.state.doc,o.pos,i):o.pos;null==a&&(a=o.pos);var c=n.state.tr;s&&c.deleteSelection();var l=c.mapping.map(a),f=0==i.openStart&&0==i.openEnd&&1==i.content.childCount,p=c.doc;if(f?c.replaceRangeWith(l,l,i.content.firstChild):c.replaceRange(l,l,i),!c.doc.eq(p)){var h=c.doc.resolve(l);if(f&&w.isSelectable(i.content.firstChild)&&h.nodeAfter&&h.nodeAfter.sameMarkup(i.content.firstChild))c.setSelection(new w(h));else{var d=c.mapping.map(a);c.mapping.maps[c.mapping.maps.length-1].forEach(function(g,v,x,C){return d=C}),c.setSelection(er(n,h,c.doc.resolve(d)))}n.focus(),n.dispatch(c.setMeta("uiEvent","drop"))}}}}}},lt.focus=function(n){n.focused||(n.domObserver.stop(),n.dom.classList.add("ProseMirror-focused"),n.domObserver.start(),n.focused=!0,setTimeout(function(){n.docView&&n.hasFocus()&&!n.domObserver.currentSelection.eq(n.root.getSelection())&&Wt(n)},20))},lt.blur=function(n,t){n.focused&&(n.domObserver.stop(),n.dom.classList.remove("ProseMirror-focused"),n.domObserver.start(),t.relatedTarget&&n.dom.contains(t.relatedTarget)&&n.domObserver.currentSelection.set({}),n.focused=!1)},lt.beforeinput=function(n,t){if(y.chrome&&y.android&&"deleteContentBackward"==t.inputType){n.domObserver.flushSoon();var e=n.domChangeCount;setTimeout(function(){if(n.domChangeCount==e&&(n.dom.blur(),n.focus(),!n.someProp("handleKeyDown",function(i){return i(n,pe(8,"Backspace"))}))){var o=n.state.selection.$cursor;o&&o.pos>0&&n.dispatch(n.state.tr.delete(o.pos-1,o.pos).scrollIntoView())}},50)}},st)lt[mi]=st[mi];function Be(n,t){if(n==t)return!0;for(var e in n)if(n[e]!==t[e])return!1;for(var r in t)if(!(r in n))return!1;return!0}var me=function(t,e){this.spec=e||$t,this.side=this.spec.side||0,this.toDOM=t};me.prototype.map=function(t,e,r,o){var i=t.mapResult(e.from+o,this.side<0?-1:1),s=i.pos;return i.deleted?null:new J(s-r,s-r,this)},me.prototype.valid=function(){return!0},me.prototype.eq=function(t){return this==t||t instanceof me&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&Be(this.spec,t.spec))},me.prototype.destroy=function(t){this.spec.destroy&&this.spec.destroy(t)};var Ct=function(t,e){this.spec=e||$t,this.attrs=t};Ct.prototype.map=function(t,e,r,o){var i=t.map(e.from+o,this.spec.inclusiveStart?-1:1)-r,s=t.map(e.to+o,this.spec.inclusiveEnd?1:-1)-r;return i>=s?null:new J(i,s,this)},Ct.prototype.valid=function(t,e){return e.from<e.to},Ct.prototype.eq=function(t){return this==t||t instanceof Ct&&Be(this.attrs,t.attrs)&&Be(this.spec,t.spec)},Ct.is=function(t){return t.type instanceof Ct};var Le=function(t,e){this.spec=e||$t,this.attrs=t};Le.prototype.map=function(t,e,r,o){var i=t.mapResult(e.from+o,1);if(i.deleted)return null;var s=t.mapResult(e.to+o,-1);return s.deleted||s.pos<=i.pos?null:new J(i.pos-r,s.pos-r,this)},Le.prototype.valid=function(t,e){var s,r=t.content.findIndex(e.from),i=r.offset;return i==e.from&&!(s=t.child(r.index)).isText&&i+s.nodeSize==e.to},Le.prototype.eq=function(t){return this==t||t instanceof Le&&Be(this.attrs,t.attrs)&&Be(this.spec,t.spec)};var J=function(t,e,r){this.from=t,this.to=e,this.type=r},mr={spec:{configurable:!0},inline:{configurable:!0}};J.prototype.copy=function(t,e){return new J(t,e,this.type)},J.prototype.eq=function(t,e){return void 0===e&&(e=0),this.type.eq(t.type)&&this.from+e==t.from&&this.to+e==t.to},J.prototype.map=function(t,e,r){return this.type.map(t,this,e,r)},J.widget=function(t,e,r){return new J(t,t,new me(e,r))},J.inline=function(t,e,r,o){return new J(t,e,new Ct(r,o))},J.node=function(t,e,r,o){return new J(t,e,new Le(r,o))},mr.spec.get=function(){return this.type.spec},mr.inline.get=function(){return this.type instanceof Ct},Object.defineProperties(J.prototype,mr);var ln=[],$t={},I=function(t,e){this.local=t&&t.length?t:ln,this.children=e&&e.length?e:ln};I.create=function(t,e){return e.length?un(e,t,0,$t):K},I.prototype.find=function(t,e,r){var o=[];return this.findInner(null==t?0:t,null==e?1e9:e,o,0,r),o},I.prototype.findInner=function(t,e,r,o,i){for(var s=0;s<this.local.length;s++){var a=this.local[s];a.from<=e&&a.to>=t&&(!i||i(a.spec))&&r.push(a.copy(a.from+o,a.to+o))}for(var c=0;c<this.children.length;c+=3)if(this.children[c]<e&&this.children[c+1]>t){var l=this.children[c]+1;this.children[c+2].findInner(t-l,e-l,r,o+l,i)}},I.prototype.map=function(t,e,r){return this==K||0==t.maps.length?this:this.mapInner(t,e,0,0,r||$t)},I.prototype.mapInner=function(t,e,r,o,i){for(var s,a=0;a<this.local.length;a++){var c=this.local[a].map(t,r,o);c&&c.type.valid(e,c)?(s||(s=[])).push(c):i.onRemove&&i.onRemove(this.local[a].spec)}return this.children.length?function(n,t,e,r,o,i,s){for(var a=n.slice(),c=function(Ft,kt,Mt,xn){for(var at=0;at<a.length;at+=3){var W=a[at+1],Pr=void 0;if(!(W<0||Ft>W+i)){var ms=a[at]+i;kt>=ms?a[at+1]=Ft<=ms?-2:-1:Mt>=o&&(Pr=xn-Mt-(kt-Ft))&&(a[at]+=Pr,a[at+1]+=Pr)}}},l=0;l<e.maps.length;l++)e.maps[l].forEach(c);for(var f=!1,p=0;p<a.length;p+=3)if(a[p+1]<0){if(-2==a[p+1]){f=!0,a[p+1]=-1;continue}var h=e.map(n[p]+i),d=h-o;if(d<0||d>=r.content.size){f=!0;continue}var v=e.map(n[p+1]+i,-1)-o,x=r.content.findIndex(d),_=x.offset,S=r.maybeChild(x.index);if(S&&_==d&&_+S.nodeSize==v){var k=a[p+2].mapInner(e,S,h+1,n[p]+i+1,s);k!=K?(a[p]=d,a[p+1]=v,a[p+2]=k):(a[p+1]=-2,f=!0)}else f=!0}if(f){var O=un(function(n,t,e,r,o,i,s){function a(l,f){for(var p=0;p<l.local.length;p++){var h=l.local[p].map(r,o,f);h?e.push(h):s.onRemove&&s.onRemove(l.local[p].spec)}for(var d=0;d<l.children.length;d+=3)a(l.children[d+2],l.children[d]+f+1)}for(var c=0;c<n.length;c+=3)-1==n[c+1]&&a(n[c+2],t[c]+i+1);return e}(a,n,t||[],e,o,i,s),r,0,s);t=O.local;for(var R=0;R<a.length;R+=3)a[R+1]<0&&(a.splice(R,3),R-=3);for(var B=0,G=0;B<O.children.length;B+=3){for(var X=O.children[B];G<a.length&&a[G]<X;)G+=3;a.splice(G,0,O.children[B],O.children[B+1],O.children[B+2])}}return new I(t&&t.sort(te),a)}(this.children,s,t,e,r,o,i):s?new I(s.sort(te)):K},I.prototype.add=function(t,e){return e.length?this==K?I.create(t,e):this.addInner(t,e,0):this},I.prototype.addInner=function(t,e,r){var i,o=this,s=0;t.forEach(function(l,f){var h,p=f+r;if(h=yi(e,l,p)){for(i||(i=o.children.slice());s<i.length&&i[s]<f;)s+=3;i[s]==f?i[s+2]=i[s+2].addInner(l,h,p+1):i.splice(s,0,f,f+l.nodeSize,un(h,l,p+1,$t)),s+=3}});for(var a=vi(s?_i(e):e,-r),c=0;c<a.length;c++)a[c].type.valid(t,a[c])||a.splice(c--,1);return new I(a.length?this.local.concat(a).sort(te):this.local,i||this.children)},I.prototype.remove=function(t){return 0==t.length||this==K?this:this.removeInner(t,0)},I.prototype.removeInner=function(t,e){for(var r=this.children,o=this.local,i=0;i<r.length;i+=3){for(var s=void 0,a=r[i]+e,c=r[i+1]+e,l=0,f=void 0;l<t.length;l++)(f=t[l])&&f.from>a&&f.to<c&&(t[l]=null,(s||(s=[])).push(f));if(s){r==this.children&&(r=this.children.slice());var p=r[i+2].removeInner(s,a+1);p!=K?r[i+2]=p:(r.splice(i,3),i-=3)}}if(o.length)for(var h=0,d=void 0;h<t.length;h++)if(d=t[h])for(var g=0;g<o.length;g++)o[g].eq(d,e)&&(o==this.local&&(o=this.local.slice()),o.splice(g--,1));return r==this.children&&o==this.local?this:o.length||r.length?new I(o,r):K},I.prototype.forChild=function(t,e){if(this==K)return this;if(e.isLeaf)return I.empty;for(var r,o,i=0;i<this.children.length;i+=3)if(this.children[i]>=t){this.children[i]==t&&(r=this.children[i+2]);break}for(var s=t+1,a=s+e.content.size,c=0;c<this.local.length;c++){var l=this.local[c];if(l.from<a&&l.to>s&&l.type instanceof Ct){var f=Math.max(s,l.from)-s,p=Math.min(a,l.to)-s;f<p&&(o||(o=[])).push(l.copy(f,p))}}if(o){var h=new I(o.sort(te));return r?new vt([h,r]):h}return r||K},I.prototype.eq=function(t){if(this==t)return!0;if(!(t instanceof I)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(var e=0;e<this.local.length;e++)if(!this.local[e].eq(t.local[e]))return!1;for(var r=0;r<this.children.length;r+=3)if(this.children[r]!=t.children[r]||this.children[r+1]!=t.children[r+1]||!this.children[r+2].eq(t.children[r+2]))return!1;return!0},I.prototype.locals=function(t){return vr(this.localsInner(t))},I.prototype.localsInner=function(t){if(this==K)return ln;if(t.inlineContent||!this.local.some(Ct.is))return this.local;for(var e=[],r=0;r<this.local.length;r++)this.local[r].type instanceof Ct||e.push(this.local[r]);return e};var K=new I;I.empty=K,I.removeOverlap=vr;var vt=function(t){this.members=t};function vi(n,t){if(!t||!n.length)return n;for(var e=[],r=0;r<n.length;r++){var o=n[r];e.push(new J(o.from+t,o.to+t,o.type))}return e}function yi(n,t,e){if(t.isLeaf)return null;for(var r=e+t.nodeSize,o=null,i=0,s=void 0;i<n.length;i++)(s=n[i])&&s.from>e&&s.to<r&&((o||(o=[])).push(s),n[i]=null);return o}function _i(n){for(var t=[],e=0;e<n.length;e++)null!=n[e]&&t.push(n[e]);return t}function un(n,t,e,r){var o=[],i=!1;t.forEach(function(c,l){var f=yi(n,c,l+e);if(f){i=!0;var p=un(f,c,e+l+1,r);p!=K&&o.push(l,l+c.nodeSize,p)}});for(var s=vi(i?_i(n):n,-e).sort(te),a=0;a<s.length;a++)s[a].type.valid(t,s[a])||(r.onRemove&&r.onRemove(s[a].spec),s.splice(a--,1));return s.length||o.length?new I(s,o):K}function te(n,t){return n.from-t.from||n.to-t.to}function vr(n){for(var t=n,e=0;e<t.length-1;e++){var r=t[e];if(r.from!=r.to)for(var o=e+1;o<t.length;o++){var i=t[o];if(i.from!=r.from){i.from<r.to&&(t==n&&(t=n.slice()),t[e]=r.copy(r.from,i.from),xi(t,o,r.copy(i.from,r.to)));break}i.to!=r.to&&(t==n&&(t=n.slice()),t[o]=i.copy(i.from,r.to),xi(t,o+1,i.copy(r.to,i.to)))}}return t}function xi(n,t,e){for(;t<n.length&&te(e,n[t])>0;)t++;n.splice(t,0,e)}function yr(n){var t=[];return n.someProp("decorations",function(e){var r=e(n.state);r&&r!=K&&t.push(r)}),n.cursorWrapper&&t.push(I.create(n.state.doc,[n.cursorWrapper.deco])),vt.from(t)}vt.prototype.map=function(t,e){var r=this.members.map(function(o){return o.map(t,e,$t)});return vt.from(r)},vt.prototype.forChild=function(t,e){if(e.isLeaf)return I.empty;for(var r=[],o=0;o<this.members.length;o++){var i=this.members[o].forChild(t,e);i!=K&&(i instanceof vt?r=r.concat(i.members):r.push(i))}return vt.from(r)},vt.prototype.eq=function(t){if(!(t instanceof vt)||t.members.length!=this.members.length)return!1;for(var e=0;e<this.members.length;e++)if(!this.members[e].eq(t.members[e]))return!1;return!0},vt.prototype.locals=function(t){for(var e,r=!0,o=0;o<this.members.length;o++){var i=this.members[o].localsInner(t);if(i.length)if(e){r&&(e=e.slice(),r=!1);for(var s=0;s<i.length;s++)e.push(i[s])}else e=i}return e?vr(r?e:e.sort(te)):ln},vt.from=function(t){switch(t.length){case 0:return K;case 1:return t[0];default:return new vt(t)}};var V=function(t,e){this._props=e,this.state=e.state,this.directPlugins=e.plugins||[],this.directPlugins.forEach(Si),this.dispatch=this.dispatch.bind(this),this._root=null,this.focused=!1,this.trackWrites=null,this.dom=t&&t.mount||document.createElement("div"),t&&(t.appendChild?t.appendChild(this.dom):t.apply?t(this.dom):t.mount&&(this.mounted=!0)),this.editable=ki(this),this.markCursor=null,this.cursorWrapper=null,Ci(this),this.nodeViews=Mi(this),this.docView=Ro(this.state.doc,bi(this),yr(this),this.dom,this),this.lastSelectedViewDesc=null,this.dragging=null,function(n){n.shiftKey=!1,n.mouseDown=null,n.lastKeyCode=null,n.lastKeyCodeTime=0,n.lastClick={time:0,x:0,y:0,type:""},n.lastSelectionOrigin=null,n.lastSelectionTime=0,n.lastIOSEnter=0,n.lastIOSEnterFallbackTimeout=null,n.lastAndroidDelete=0,n.composing=!1,n.composingTimeout=null,n.compositionNodes=[],n.compositionEndedAt=-2e8,n.domObserver=new ht(n,function(r,o,i,s){return function(n,t,e,r,o){if(t<0){var i=n.lastSelectionTime>Date.now()-50?n.lastSelectionOrigin:null,s=Jo(n,i);if(s&&!n.state.selection.eq(s)){var a=n.state.tr.setSelection(s);"pointer"==i?a.setMeta("pointer",!0):"key"==i&&a.scrollIntoView(),n.dispatch(a)}}else{var c=n.state.doc.resolve(t),l=c.sharedDepth(e);t=c.before(l+1),e=n.state.doc.resolve(e).after(l+1);var f=n.state.selection,p=function(n,t,e){var r=n.docView.parseRange(t,e),o=r.node,i=r.fromOffset,s=r.toOffset,a=r.from,c=r.to,l=n.root.getSelection(),f=null,p=l.anchorNode;if(p&&n.dom.contains(1==p.nodeType?p:p.parentNode)&&(f=[{node:p,offset:l.anchorOffset}],jn(l)||f.push({node:l.focusNode,offset:l.focusOffset})),y.chrome&&8===n.lastKeyCode)for(var h=s;h>i;h--){var d=o.childNodes[h-1],g=d.pmViewDesc;if("BR"==d.nodeName&&!g){s=h;break}if(!g||g.size)break}var v=n.state.doc,x=n.someProp("domParser")||dt.fromSchema(n.state.schema),C=v.resolve(a),_=null,S=x.parse(o,{topNode:C.parent,topMatch:C.parent.contentMatchAt(C.index()),topOpen:!0,from:i,to:s,preserveWhitespace:"pre"!=C.parent.type.whitespace||"full",editableContent:!0,findPositions:f,ruleFromNode:Ia,context:C});if(f&&null!=f[0].pos){var k=f[0].pos,M=f[1]&&f[1].pos;null==M&&(M=k),_={anchor:k+a,head:M+a}}return{doc:S,sel:_,from:a,to:c}}(n,t,e);if(y.chrome&&n.cursorWrapper&&p.sel&&p.sel.anchor==n.cursorWrapper.deco.from){var h=n.cursorWrapper.deco.type.toDOM.nextSibling,d=h&&h.nodeValue?h.nodeValue.length:1;p.sel={anchor:p.sel.anchor+d,head:p.sel.anchor+d}}var x,C,g=n.state.doc,v=g.slice(p.from,p.to);8===n.lastKeyCode&&Date.now()-100<n.lastKeyCodeTime?(x=n.state.selection.to,C="end"):(x=n.state.selection.from,C="start"),n.lastKeyCode=null;var _=function(n,t,e,r,o){var i=n.findDiffStart(t,e);if(null==i)return null;var s=n.findDiffEnd(t,e+n.size,e+t.size),a=s.a,c=s.b;return"end"==o&&(r-=a+Math.max(0,i-Math.min(a,c))-i),a<i&&n.size<t.size?(c=(i-=r<=i&&r>=a?i-r:0)+(c-a),a=i):c<i&&(a=(i-=r<=i&&r>=c?i-r:0)+(a-c),c=i),{start:i,endA:a,endB:c}}(v.content,p.doc.content,p.from,x,C);if((y.ios&&n.lastIOSEnter>Date.now()-225||y.android)&&o.some(function(W){return"DIV"==W.nodeName||"P"==W.nodeName})&&(!_||_.endA>=_.endB)&&n.someProp("handleKeyDown",function(W){return W(n,pe(13,"Enter"))}))n.lastIOSEnter=0;else{if(!_){if(!(r&&f instanceof F&&!f.empty&&f.$head.sameParent(f.$anchor))||n.composing||p.sel&&p.sel.anchor!=p.sel.head){if(p.sel){var S=ti(n,n.state.doc,p.sel);S&&!S.eq(n.state.selection)&&n.dispatch(n.state.tr.setSelection(S))}return}_={start:f.from,endA:f.to,endB:f.to}}n.domChangeCount++,n.state.selection.from<n.state.selection.to&&_.start==_.endB&&n.state.selection instanceof F&&(_.start>n.state.selection.from&&_.start<=n.state.selection.from+2&&n.state.selection.from>=p.from?_.start=n.state.selection.from:_.endA<n.state.selection.to&&_.endA>=n.state.selection.to-2&&n.state.selection.to<=p.to&&(_.endB+=n.state.selection.to-_.endA,_.endA=n.state.selection.to)),y.ie&&y.ie_version<=11&&_.endB==_.start+1&&_.endA==_.start&&_.start>p.from&&" \xa0"==p.doc.textBetween(_.start-p.from-1,_.start-p.from+1)&&(_.start--,_.endA--,_.endB--);var R,k=p.doc.resolveNoCache(_.start-p.from),M=p.doc.resolveNoCache(_.endB-p.from),O=k.sameParent(M)&&k.parent.inlineContent;if((y.ios&&n.lastIOSEnter>Date.now()-225&&(!O||o.some(function(W){return"DIV"==W.nodeName||"P"==W.nodeName}))||!O&&k.pos<p.doc.content.size&&(R=D.findFrom(p.doc.resolve(k.pos+1),1,!0))&&R.head==M.pos)&&n.someProp("handleKeyDown",function(W){return W(n,pe(13,"Enter"))}))n.lastIOSEnter=0;else if(n.state.selection.anchor>_.start&&function(n,t,e,r,o){if(!r.parent.isTextblock||e-t<=o.pos-r.pos||ar(r,!0,!1)<o.pos)return!1;var i=n.resolve(t);if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;var s=n.resolve(ar(i,!0,!0));return!(!s.parent.isTextblock||s.pos>e||ar(s,!0,!1)<e)&&r.parent.content.cut(r.parentOffset).eq(s.parent.content)}(g,_.start,_.endA,k,M)&&n.someProp("handleKeyDown",function(W){return W(n,pe(8,"Backspace"))}))y.android&&y.chrome&&n.domObserver.suppressSelectionUpdates();else{y.chrome&&y.android&&_.toB==_.from&&(n.lastAndroidDelete=Date.now()),y.android&&!O&&k.start()!=M.start()&&0==M.parentOffset&&k.depth==M.depth&&p.sel&&p.sel.anchor==p.sel.head&&p.sel.head==_.endA&&(_.endB-=2,M=p.doc.resolveNoCache(_.endB-p.from),setTimeout(function(){n.someProp("handleKeyDown",function(W){return W(n,pe(13,"Enter"))})},20));var X,Ft,kt,Mt,B=_.start,G=_.endA;if(O)if(k.pos==M.pos)y.ie&&y.ie_version<=11&&0==k.parentOffset&&(n.domObserver.suppressSelectionUpdates(),setTimeout(function(){return Wt(n)},20)),X=n.state.tr.delete(B,G),Ft=g.resolve(_.start).marksAcross(g.resolve(_.endA));else if(_.endA==_.endB&&(Mt=g.resolve(_.start))&&(kt=function(n,t){for(var s,a,c,e=n.firstChild.marks,r=t.firstChild.marks,o=e,i=r,l=0;l<r.length;l++)o=r[l].removeFromSet(o);for(var f=0;f<e.length;f++)i=e[f].removeFromSet(i);if(1==o.length&&0==i.length)a=o[0],s="add",c=function(d){return d.mark(a.addToSet(d.marks))};else{if(0!=o.length||1!=i.length)return null;a=i[0],s="remove",c=function(d){return d.mark(a.removeFromSet(d.marks))}}for(var p=[],h=0;h<t.childCount;h++)p.push(c(t.child(h)));if(m.from(p).eq(n))return{mark:a,type:s}}(k.parent.content.cut(k.parentOffset,M.parentOffset),Mt.parent.content.cut(Mt.parentOffset,_.endA-Mt.start()))))X=n.state.tr,"add"==kt.type?X.addMark(B,G,kt.mark):X.removeMark(B,G,kt.mark);else if(k.parent.child(k.index()).isText&&k.index()==M.index()-(M.textOffset?0:1)){var xn=k.parent.textBetween(k.parentOffset,M.parentOffset);if(n.someProp("handleTextInput",function(W){return W(n,B,G,xn)}))return;X=n.state.tr.insertText(xn,B,G)}if(X||(X=n.state.tr.replace(B,G,p.doc.slice(_.start-p.from,_.endB-p.from))),p.sel){var at=ti(n,X.doc,p.sel);at&&!(y.chrome&&y.android&&n.composing&&at.empty&&(_.start!=_.endB||n.lastAndroidDelete<Date.now()-100)&&(at.head==B||at.head==X.mapping.map(G)-1)||y.ie&&at.empty&&at.head==B)&&X.setSelection(at)}Ft&&X.ensureMarks(Ft),n.dispatch(X.scrollIntoView())}}}}(n,r,o,i,s)}),n.domObserver.start(),n.domChangeCount=0,n.eventHandlers=Object.create(null);var t=function(r){var o=lt[r];n.dom.addEventListener(r,n.eventHandlers[r]=function(i){(function(n,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(var e=t.target;e!=n.dom;e=e.parentNode)if(!e||11==e.nodeType||e.pmViewDesc&&e.pmViewDesc.stopEvent(t))return!1;return!0})(n,i)&&!pr(n,i)&&(n.editable||!(i.type in st))&&o(n,i)})};for(var e in lt)t(e);y.safari&&n.dom.addEventListener("input",function(){return null}),fr(n)}(this),this.prevDirectPlugins=[],this.pluginViews=[],this.updatePluginViews()},fn={props:{configurable:!0},root:{configurable:!0},isDestroyed:{configurable:!0}};function bi(n){var t=Object.create(null);return t.class="ProseMirror",t.contenteditable=String(n.editable),t.translate="no",n.someProp("attributes",function(e){if("function"==typeof e&&(e=e(n.state)),e)for(var r in e)"class"==r&&(t.class+=" "+e[r]),"style"==r?t.style=(t.style?t.style+";":"")+e[r]:!t[r]&&"contenteditable"!=r&&"nodeName"!=r&&(t[r]=String(e[r]))}),[J.node(0,n.state.doc.content.size,t)]}function Ci(n){if(n.markCursor){var t=document.createElement("img");t.className="ProseMirror-separator",t.setAttribute("mark-placeholder","true"),t.setAttribute("alt",""),n.cursorWrapper={dom:t,deco:J.widget(n.state.selection.head,t,{raw:!0,marks:n.markCursor})}}else n.cursorWrapper=null}function ki(n){return!n.someProp("editable",function(t){return!1===t(n.state)})}function Mi(n){var t={};return n.someProp("nodeViews",function(e){for(var r in e)Object.prototype.hasOwnProperty.call(t,r)||(t[r]=e[r])}),t}function Si(n){if(n.spec.state||n.spec.filterTransaction||n.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}fn.props.get=function(){if(this._props.state!=this.state){var n=this._props;for(var t in this._props={},n)this._props[t]=n[t];this._props.state=this.state}return this._props},V.prototype.update=function(t){t.handleDOMEvents!=this._props.handleDOMEvents&&fr(this),this._props=t,t.plugins&&(t.plugins.forEach(Si),this.directPlugins=t.plugins),this.updateStateInner(t.state,!0)},V.prototype.setProps=function(t){var e={};for(var r in this._props)e[r]=this._props[r];for(var o in e.state=this.state,t)e[o]=t[o];this.update(e)},V.prototype.updateState=function(t){this.updateStateInner(t,this.state.plugins!=t.plugins)},V.prototype.updateStateInner=function(t,e){var r=this,o=this.state,i=!1,s=!1;if(t.storedMarks&&this.composing&&(di(this),s=!0),this.state=t,e){var a=Mi(this);(function(n,t){var e=0,r=0;for(var o in n){if(n[o]!=t[o])return!0;e++}for(var i in t)r++;return e!=r})(a,this.nodeViews)&&(this.nodeViews=a,i=!0),fr(this)}this.editable=ki(this),Ci(this);var c=yr(this),l=bi(this),f=e?"reset":t.scrollToSelection>o.scrollToSelection?"to selection":"preserve",p=i||!this.docView.matchesNode(t.doc,l,c);(p||!t.selection.eq(o.selection))&&(s=!0);var h="preserve"==f&&s&&null==this.dom.style.overflowAnchor&&function(n){for(var r,o,t=n.dom.getBoundingClientRect(),e=Math.max(0,t.top),i=(t.left+t.right)/2,s=e+1;s<Math.min(innerHeight,t.bottom);s+=5){var a=n.root.elementFromPoint(i,s);if(a!=n.dom&&n.dom.contains(a)){var c=a.getBoundingClientRect();if(c.top>=e-20){r=a,o=c.top;break}}}return{refDOM:r,refTop:o,stack:Mo(n.dom)}}(this);if(s){this.domObserver.stop();var d=p&&(y.ie||y.chrome)&&!this.composing&&!o.selection.empty&&!t.selection.empty&&function(n,t){var e=Math.min(n.$anchor.sharedDepth(n.head),t.$anchor.sharedDepth(t.head));return n.$anchor.start(e)!=t.$anchor.start(e)}(o.selection,t.selection);if(p){var g=y.chrome?this.trackWrites=this.root.getSelection().focusNode:null;(i||!this.docView.update(t.doc,l,c,this))&&(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=Ro(t.doc,l,c,this.dom,this)),g&&!this.trackWrites&&(d=!0)}d||!(this.mouseDown&&this.domObserver.currentSelection.eq(this.root.getSelection())&&function(n){var t=n.docView.domFromPos(n.state.selection.anchor,0),e=n.root.getSelection();return Ie(t.node,t.offset,e.anchorNode,e.anchorOffset)}(this))?Wt(this,d):(Ko(this,t.selection),this.domObserver.setCurSelection()),this.domObserver.start()}if(this.updatePluginViews(o),"reset"==f)this.dom.scrollTop=0;else if("to selection"==f){var v=this.root.getSelection().focusNode;this.someProp("handleScrollToSelection",function(x){return x(r)})||function(n,t,e){for(var r=n.someProp("scrollThreshold")||0,o=n.someProp("scrollMargin")||5,i=n.dom.ownerDocument,s=e||n.dom;s;s=Kn(s))if(1==s.nodeType){var a=s==i.body||1!=s.nodeType,c=a?ta(i):ea(s),l=0,f=0;if(t.top<c.top+Ht(r,"top")?f=-(c.top-t.top+Ht(o,"top")):t.bottom>c.bottom-Ht(r,"bottom")&&(f=t.bottom-c.bottom+Ht(o,"bottom")),t.left<c.left+Ht(r,"left")?l=-(c.left-t.left+Ht(o,"left")):t.right>c.right-Ht(r,"right")&&(l=t.right-c.right+Ht(o,"right")),l||f)if(a)i.defaultView.scrollBy(l,f);else{var p=s.scrollLeft,h=s.scrollTop;f&&(s.scrollTop+=f),l&&(s.scrollLeft+=l);var d=s.scrollLeft-p,g=s.scrollTop-h;t={left:t.left-d,top:t.top-g,right:t.right-d,bottom:t.bottom-g}}if(a)break}}(this,t.selection instanceof w?this.docView.domAfterPos(t.selection.from).getBoundingClientRect():this.coordsAtPos(t.selection.head,1),v)}else h&&function(n){var t=n.refDOM,e=n.refTop,r=n.stack,o=t?t.getBoundingClientRect().top:0;So(r,0==o?0:o-e)}(h)},V.prototype.destroyPluginViews=function(){for(var t;t=this.pluginViews.pop();)t.destroy&&t.destroy()},V.prototype.updatePluginViews=function(t){if(t&&t.plugins==this.state.plugins&&this.directPlugins==this.prevDirectPlugins)for(var s=0;s<this.pluginViews.length;s++){var a=this.pluginViews[s];a.update&&a.update(this,t)}else{this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(var e=0;e<this.directPlugins.length;e++){var r=this.directPlugins[e];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(var o=0;o<this.state.plugins.length;o++){var i=this.state.plugins[o];i.spec.view&&this.pluginViews.push(i.spec.view(this))}}},V.prototype.someProp=function(t,e){var o,r=this._props&&this._props[t];if(null!=r&&(o=e?e(r):r))return o;for(var i=0;i<this.directPlugins.length;i++){var s=this.directPlugins[i].props[t];if(null!=s&&(o=e?e(s):s))return o}var a=this.state.plugins;if(a)for(var c=0;c<a.length;c++){var l=a[c].props[t];if(null!=l&&(o=e?e(l):l))return o}},V.prototype.hasFocus=function(){return this.root.activeElement==this.dom},V.prototype.focus=function(){this.domObserver.stop(),this.editable&&function(n){if(n.setActive)return n.setActive();if(he)return n.focus(he);var t=Mo(n);n.focus(null==he?{get preventScroll(){return he={preventScroll:!0},!0}}:void 0),he||(he=!1,So(t,0))}(this.dom),Wt(this),this.domObserver.start()},fn.root.get=function(){var n=this._root;if(null==n)for(var t=this.dom.parentNode;t;t=t.parentNode)if(9==t.nodeType||11==t.nodeType&&t.host)return t.getSelection||(Object.getPrototypeOf(t).getSelection=function(){return document.getSelection()}),this._root=t;return n||document},V.prototype.posAtCoords=function(t){return la(this,t)},V.prototype.coordsAtPos=function(t,e){return void 0===e&&(e=1),Oo(this,t,e)},V.prototype.domAtPos=function(t,e){return void 0===e&&(e=0),this.docView.domFromPos(t,e)},V.prototype.nodeDOM=function(t){var e=this.docView.descAt(t);return e?e.nodeDOM:null},V.prototype.posAtDOM=function(t,e,r){void 0===r&&(r=-1);var o=this.docView.posFromDOM(t,e,r);if(null==o)throw new RangeError("DOM position not inside the editor");return o},V.prototype.endOfTextblock=function(t,e){return function(n,t,e){return Eo==t&&Do==e?Io:(Eo=t,Do=e,Io="up"==e||"down"==e?function(n,t,e){var r=t.selection,o="up"==e?r.$from:r.$to;return To(n,t,function(){for(var s=n.docView.domFromPos(o.pos,"up"==e?-1:1).node;;){var a=n.docView.nearestDesc(s,!0);if(!a)break;if(a.node.isBlock){s=a.dom;break}s=a.dom.parentNode}for(var c=Oo(n,o.pos,1),l=s.firstChild;l;l=l.nextSibling){var f=void 0;if(1==l.nodeType)f=l.getClientRects();else{if(3!=l.nodeType)continue;f=At(l,0,l.nodeValue.length).getClientRects()}for(var p=0;p<f.length;p++){var h=f[p];if(h.bottom>h.top+1&&("up"==e?c.top-h.top>2*(h.bottom-c.top):h.bottom-c.bottom>2*(c.bottom-h.top)))return!1}}return!0})}(n,t,e):function(n,t,e){var o=t.selection.$head;if(!o.parent.isTextblock)return!1;var i=o.parentOffset,s=!i,a=i==o.parent.content.size,c=n.root.getSelection();return pa.test(o.parent.textContent)&&c.modify?To(n,t,function(){var l=c.getRangeAt(0),f=c.focusNode,p=c.focusOffset,h=c.caretBidiLevel;c.modify("move",e,"character");var g=!(o.depth?n.docView.domAfterPos(o.before()):n.dom).contains(1==c.focusNode.nodeType?c.focusNode:c.focusNode.parentNode)||f==c.focusNode&&p==c.focusOffset;return c.removeAllRanges(),c.addRange(l),null!=h&&(c.caretBidiLevel=h),g}):"left"==e||"backward"==e?s:a}(n,t,e))}(this,e||this.state,t)},V.prototype.destroy=function(){!this.docView||(function(n){for(var t in n.domObserver.stop(),n.eventHandlers)n.dom.removeEventListener(t,n.eventHandlers[t]);clearTimeout(n.composingTimeout),clearTimeout(n.lastIOSEnterFallbackTimeout)}(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],yr(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)},fn.isDestroyed.get=function(){return null==this.docView},V.prototype.dispatchEvent=function(t){return function(n,t){!pr(n,t)&&lt[t.type]&&(n.editable||!(t.type in st))&&lt[t.type](n,t)}(this,t)},V.prototype.dispatch=function(t){var e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))},Object.defineProperties(V.prototype,fn);var q=ct(8583),fc=["ol",0],pc=["ul",0],hc=["li",0],wi={attrs:{order:{default:1}},parseDOM:[{tag:"ol",getAttrs:function(t){return{order:t.hasAttribute("start")?+t.getAttribute("start"):1}}}],toDOM:function(t){return 1==t.attrs.order?fc:["ol",{start:t.attrs.order},0]}},Ni={parseDOM:[{tag:"ul"}],toDOM:function(){return pc}};function mc(n){return function(t,e){var r=t.selection,o=r.$from,i=r.$to,s=r.node;if(s&&s.isBlock||o.depth<2||!o.sameParent(i))return!1;var a=o.node(-1);if(a.type!=n)return!1;if(0==o.parent.content.size&&o.node(-1).childCount==o.indexAfter(-1)){if(2==o.depth||o.node(-3).type!=n||o.index(-2)!=o.node(-2).childCount-1)return!1;if(e){for(var c=m.empty,l=o.index(-1)?1:o.index(-2)?2:3,f=o.depth-l;f>=o.depth-3;f--)c=m.from(o.node(f).copy(c));var p=o.indexAfter(-1)<o.node(-2).childCount?1:o.indexAfter(-2)<o.node(-3).childCount?2:3;c=c.append(m.from(n.createAndFill()));var h=o.before(o.depth-(l-1)),d=t.tr.replace(h,o.after(-p),new b(c,4-l,0)),g=-1;d.doc.nodesBetween(h,d.doc.content.size,function(_,S){if(g>-1)return!1;_.isTextblock&&0==_.content.size&&(g=S+1)}),g>-1&&d.setSelection(t.selection.constructor.near(d.doc.resolve(g))),e(d.scrollIntoView())}return!0}var v=i.pos==o.end()?a.contentMatchAt(0).defaultType:null,x=t.tr.delete(o.pos,i.pos),C=v&&[null,{type:v}];return!!ue(x.doc,o.pos,2,C)&&(e&&e(x.split(o.pos,2,C).scrollIntoView()),!0)}}function Ti(n){return function(t,e){var r=t.selection,o=r.$from,s=o.blockRange(r.$to,function(a){return a.childCount&&a.firstChild.type==n});return!!s&&(!e||(o.node(s.depth-1).type==n?function(n,t,e,r){var o=n.tr,i=r.end,s=r.$to.end(r.depth);return i<s&&(o.step(new ft(i-1,s,i,s,new b(m.from(e.create(null,r.parent.copy())),1,0),1,!0)),r=new ke(o.doc.resolve(r.$from.pos),o.doc.resolve(s),r.depth)),t(o.lift(r,Se(r)).scrollIntoView()),!0}(t,e,n,s):function(n,t,e){for(var r=n.tr,o=e.parent,i=e.end,s=e.endIndex-1,a=e.startIndex;s>a;s--)i-=o.child(s).nodeSize,r.delete(i-1,i+1);var c=r.doc.resolve(e.start),l=c.nodeAfter;if(r.mapping.map(e.end)!=e.start+c.nodeAfter.nodeSize)return!1;var f=0==e.startIndex,p=e.endIndex==o.childCount,h=c.node(-1),d=c.index(-1);if(!h.canReplace(d+(f?0:1),d+1,l.content.append(p?m.empty:m.from(o))))return!1;var g=c.pos,v=g+l.nodeSize;return r.step(new ft(g-(f?1:0),v+(p?1:0),g+1,v-1,new b((f?m.empty:m.from(o.copy(m.empty))).append(p?m.empty:m.from(o.copy(m.empty))),f?0:1,p?0:1),f?0:1)),t(r.scrollIntoView()),!0}(t,e,s)))}}function Ei(n){return function(t,e){var r=t.selection,s=r.$from.blockRange(r.$to,function(v){return v.childCount&&v.firstChild.type==n});if(!s)return!1;var a=s.startIndex;if(0==a)return!1;var c=s.parent,l=c.child(a-1);if(l.type!=n)return!1;if(e){var f=l.lastChild&&l.lastChild.type==c.type,p=m.from(f?n.create():null),h=new b(m.from(n.create(null,m.from(c.type.create(null,p)))),f?3:1,0),d=s.start,g=s.end;e(t.tr.step(new ft(d-(f?3:1),g,d,g,h,1,!0)).scrollIntoView())}return!0}}const Di=n=>{const t=(n=>{const t={};return Object.keys(n).forEach(e=>{n[e]&&(t[e]=n[e])}),t})(n);return Object.entries(t).map(([e,r])=>`${(n=>n.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`))(e)}:${r}`).join(";")},ee=new Qt({marks:{link:{attrs:{href:{},title:{default:null},target:{default:"_blank"}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:n=>({href:n.getAttribute("href"),title:n.getAttribute("title"),target:n.getAttribute("target")})}],toDOM(n){const{href:t,title:e,target:r}=n.attrs;return["a",{href:t,title:e,target:r},0]}},em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:()=>["em",0]},strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:n=>"normal"!==n.style.fontWeight&&null},{style:"font-weight",getAttrs:n=>/^(?:bold(?:er)?|[5-9]\d{2,})$/.test(n)&&null}],toDOM:()=>["strong",0]},code:{parseDOM:[{tag:"code"}],toDOM:()=>["code",0]},u:{parseDOM:[{tag:"u"},{style:"text-decoration=underline",consuming:!1}],toDOM:()=>["u",0]},s:{parseDOM:[{tag:"s"},{tag:"strike"},{style:"text-decoration=line-through"}],toDOM:()=>["s",0]},text_color:{attrs:{color:{default:null}},parseDOM:[{style:"color",getAttrs:n=>({color:n})}],toDOM(n){const{color:t}=n.attrs;return["span",{style:`color:${t};`},0]}},text_background_color:{attrs:{backgroundColor:{default:null}},parseDOM:[{style:"background-color",getAttrs:n=>({backgroundColor:n})}],toDOM(n){const{backgroundColor:t}=n.attrs;return["span",{style:`background-color:${t};`},0]}}},nodes:{doc:{content:"block+"},text:{group:"inline"},paragraph:{content:"inline*",group:"block",attrs:{align:{default:null}},parseDOM:[{tag:"p",getAttrs(n){const{textAlign:t}=n.style;return{align:n.getAttribute("align")||t||null}}}],toDOM(n){const{align:t}=n.attrs;return["p",{style:Di({textAlign:"left"!==t?t:null})||null},0]}},blockquote:{content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:()=>["blockquote",0]},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM:()=>["hr"]},heading:{attrs:{level:{default:1},align:{default:null}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",getAttrs(n){const{textAlign:t}=n.style;return{level:1,align:n.getAttribute("align")||t||null}}},{tag:"h2",getAttrs(n){const{textAlign:t}=n.style;return{level:2,align:n.getAttribute("align")||t||null}}},{tag:"h3",getAttrs(n){const{textAlign:t}=n.style;return{level:3,align:n.getAttribute("align")||t||null}}},{tag:"h4",getAttrs(n){const{textAlign:t}=n.style;return{level:4,align:n.getAttribute("align")||t||null}}},{tag:"h5",getAttrs(n){const{textAlign:t}=n.style;return{level:5,align:n.getAttribute("align")||t||null}}},{tag:"h6",getAttrs(n){const{textAlign:t}=n.style;return{level:6,align:n.getAttribute("align")||t||null}}}],toDOM(n){const{level:t,align:e}=n.attrs;return[`h${t}`,{style:Di({textAlign:"left"!==e?e:null})||null},0]}},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:()=>["br"]},code_block:{content:"text*",marks:"",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM:()=>["pre",["code",0]]},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null},width:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs:n=>({src:n.getAttribute("src"),title:n.getAttribute("title"),alt:n.getAttribute("alt"),width:n.getAttribute("width")})}],toDOM(n){const{src:t,alt:e,title:r,width:o}=n.attrs;return["img",{src:t,alt:e,title:r,width:o}]}},list_item:Object.assign(Object.assign({},{parseDOM:[{tag:"li"}],toDOM:function(){return hc},defining:!0}),{content:"paragraph block*"}),ordered_list:Object.assign(Object.assign({},wi),{content:"list_item+",group:"block"}),bullet_list:Object.assign(Object.assign({},Ni),{content:"list_item+",group:"block"})}});var xr=ct(9765);function Ii(n,t){return!n.selection.empty&&(t&&t(n.tr.deleteSelection().scrollIntoView()),!0)}function ve(n,t,e){for(;n;n="start"==t?n.firstChild:n.lastChild){if(n.isTextblock)return!0;if(e&&1!=n.childCount)return!1}return!1}function Ai(n){if(!n.parent.type.spec.isolating)for(var t=n.depth-1;t>=0;t--){if(n.index(t)>0)return n.doc.resolve(n.before(t+1));if(n.node(t).type.spec.isolating)break}return null}function Pi(n){if(!n.parent.type.spec.isolating)for(var t=n.depth-1;t>=0;t--){var e=n.node(t);if(n.index(t)+1<e.childCount)return n.doc.resolve(n.after(t+1));if(e.type.spec.isolating)break}return null}function Ri(n,t){var e=n.selection,r=e.$head;return!(!r.parent.type.spec.code||!r.sameParent(e.$anchor)||(t&&t(n.tr.insertText("\n").scrollIntoView()),0))}function br(n){for(var t=0;t<n.edgeCount;t++){var r=n.edge(t).type;if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}function zi(n,t){var e=n.selection,r=e.$head;if(!r.parent.type.spec.code||!r.sameParent(e.$anchor))return!1;var i=r.node(-1),s=r.indexAfter(-1),a=br(i.contentMatchAt(s));if(!i.canReplaceWith(s,s,a))return!1;if(t){var c=r.after(),l=n.tr.replaceWith(c,c,a.createAndFill());l.setSelection(D.near(l.doc.resolve(c),1)),t(l.scrollIntoView())}return!0}function Fi(n,t){var e=n.selection,r=e.$from,o=e.$to;if(e instanceof It||r.parent.inlineContent||o.parent.inlineContent)return!1;var i=br(o.parent.contentMatchAt(o.indexAfter()));if(!i||!i.isTextblock)return!1;if(t){var s=(!r.parentOffset&&o.index()<o.parent.childCount?r:o).pos,a=n.tr.insert(s,i.createAndFill());a.setSelection(F.create(a.doc,s+1)),t(a.scrollIntoView())}return!0}function Bi(n,t){var r=n.selection.$cursor;if(!r||r.parent.content.size)return!1;if(r.depth>1&&r.after()!=r.end(-1)){var o=r.before();if(ue(n.doc,o))return t&&t(n.tr.split(o).scrollIntoView()),!0}var i=r.blockRange(),s=i&&Se(i);return null!=s&&(t&&t(n.tr.lift(i,s).scrollIntoView()),!0)}function Cr(n,t){var e=n.selection,r=e.$from,o=e.$to;if(n.selection instanceof w&&n.selection.node.isBlock)return!(!r.parentOffset||!ue(n.doc,r.pos)||(t&&t(n.tr.split(r.pos).scrollIntoView()),0));if(!r.parent.isBlock)return!1;if(t){var i=o.parentOffset==o.parent.content.size,s=n.tr;(n.selection instanceof F||n.selection instanceof It)&&s.deleteSelection();var a=0==r.depth?null:br(r.node(-1).contentMatchAt(r.indexAfter(-1))),c=i&&a?[{type:a}]:null,l=ue(s.doc,s.mapping.map(r.pos),1,c);if(!c&&!l&&ue(s.doc,s.mapping.map(r.pos),1,a&&[{type:a}])&&(c=[{type:a}],l=!0),l&&(s.split(s.mapping.map(r.pos),1,c),!i&&!r.parentOffset&&r.parent.type!=a)){var f=s.mapping.map(r.before()),p=s.doc.resolve(f);r.node(-1).canReplaceWith(p.index(),p.index()+1,a)&&s.setNodeMarkup(s.mapping.map(r.before()),a)}t(s.scrollIntoView())}return!0}function Li(n,t,e){var i,s,r=t.nodeBefore,o=t.nodeAfter;if(r.type.spec.isolating||o.type.spec.isolating)return!1;if(function(n,t,e){var r=t.nodeBefore,o=t.nodeAfter,i=t.index();return!(!(r&&o&&r.type.compatibleContent(o.type))||(!r.content.size&&t.parent.canReplace(i-1,i)?(e&&e(n.tr.delete(t.pos-r.nodeSize,t.pos).scrollIntoView()),0):!t.parent.canReplace(i,i+1)||!o.isTextblock&&!Pn(n.doc,t.pos)||(e&&e(n.tr.clearIncompatible(t.pos,r.type,r.contentMatchAt(r.childCount)).join(t.pos).scrollIntoView()),0)))}(n,t,e))return!0;var a=t.parent.canReplace(t.index(),t.index()+1);if(a&&(i=(s=r.contentMatchAt(r.childCount)).findWrapping(o.type))&&s.matchType(i[0]||o.type).validEnd){if(e){for(var c=t.pos+o.nodeSize,l=m.empty,f=i.length-1;f>=0;f--)l=m.from(i[f].create(null,l));l=m.from(r.copy(l));var p=n.tr.step(new ft(t.pos-1,c,t.pos,c,new b(l,1,0),i.length,!0)),h=c+2*i.length;Pn(p.doc,h)&&p.join(h),e(p.scrollIntoView())}return!0}var d=D.findFrom(t,1),g=d&&d.$from.blockRange(d.$to),v=g&&Se(g);if(null!=v&&v>=t.depth)return e&&e(n.tr.lift(g,v).scrollIntoView()),!0;if(a&&ve(o,"start",!0)&&ve(r,"end")){for(var x=r,C=[];C.push(x),!x.isTextblock;)x=x.lastChild;for(var _=o,S=1;!_.isTextblock;_=_.firstChild)S++;if(x.canReplace(x.childCount,x.childCount,_.content)){if(e){for(var k=m.empty,M=C.length-1;M>=0;M--)k=m.from(C[M].copy(k));e(n.tr.step(new ft(t.pos-C.length,t.pos+o.nodeSize,t.pos+S,t.pos+o.nodeSize-S,new b(k,C.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function Vi(n){return function(t,e){for(var r=t.selection,o=n<0?r.$from:r.$to,i=o.depth;o.node(i).isInline;){if(!i)return!1;i--}return!!o.node(i).isTextblock&&(e&&e(t.tr.setSelection(F.create(t.doc,n<0?o.start(i):o.end(i)))),!0)}}var qc=Vi(-1),Wc=Vi(1);function kr(n,t){return function(e,r){var o=e.selection,i=o.from,s=o.to,a=!1;return e.doc.nodesBetween(i,s,function(c,l){if(a)return!1;if(c.isTextblock&&!c.hasMarkup(n,t))if(c.type==n)a=!0;else{var f=e.doc.resolve(l),p=f.index();a=f.parent.canReplaceWith(p,p+1,n)}}),!!a&&(r&&r(e.tr.setBlockType(i,s,n,t).scrollIntoView()),!0)}}function ye(n,t){return function(e,r){var o=e.selection,s=o.$cursor,a=o.ranges;if(o.empty&&!s||!function(n,t,e){for(var r=function(s){var a=t[s],c=a.$from,l=a.$to,f=0==c.depth&&n.type.allowsMarkType(e);if(n.nodesBetween(c.pos,l.pos,function(p){if(f)return!1;f=p.inlineContent&&p.type.allowsMarkType(e)}),f)return{v:!0}},o=0;o<t.length;o++){var i=r(o);if(i)return i.v}return!1}(e.doc,a,n))return!1;if(r)if(s)n.isInSet(e.storedMarks||s.marks())?r(e.tr.removeStoredMark(n)):r(e.tr.addStoredMark(n.create(t)));else{for(var c=!1,l=e.tr,f=0;!c&&f<a.length;f++){var p=a[f];c=e.doc.rangeHasMark(p.$from.pos,p.$to.pos,n)}for(var g=0;g<a.length;g++){var v=a[g],x=v.$from,C=v.$to;if(c)l.removeMark(x.pos,C.pos,n);else{var _=x.pos,S=C.pos,k=x.nodeAfter,M=C.nodeBefore,O=k&&k.isText?/^\s*/.exec(k.text)[0].length:0,R=M&&M.isText?/\s*$/.exec(M.text)[0].length:0;_+O<S&&(_+=O,S-=R),l.addMark(_,S,n.create(t))}}r(l.scrollIntoView())}return!0}}function Ve(){for(var n=[],t=arguments.length;t--;)n[t]=arguments[t];return function(e,r,o){for(var i=0;i<n.length;i++)if(n[i](e,r,o))return!0;return!1}}var Mr=Ve(Ii,function(n,t,e){var o=n.selection.$cursor;if(!o||(e?!e.endOfTextblock("backward",n):o.parentOffset>0))return!1;var i=Ai(o);if(!i){var s=o.blockRange(),a=s&&Se(s);return null!=a&&(t&&t(n.tr.lift(s,a).scrollIntoView()),!0)}var c=i.nodeBefore;if(!c.type.spec.isolating&&Li(n,i,t))return!0;if(0==o.parent.content.size&&(ve(c,"end")||w.isSelectable(c))){var l=Fn(n.doc,o.before(),o.after(),b.empty);if(l.slice.size<l.to-l.from){if(t){var f=n.tr.step(l);f.setSelection(ve(c,"end")?D.findFrom(f.doc.resolve(f.mapping.map(i.pos,-1)),-1):w.create(f.doc,i.pos-c.nodeSize)),t(f.scrollIntoView())}return!0}}return!(!c.isAtom||i.depth!=o.depth-1||(t&&t(n.tr.delete(i.pos-c.nodeSize,i.pos).scrollIntoView()),0))},function(n,t,e){var r=n.selection,o=r.$head,s=o;if(!r.empty)return!1;if(o.parent.isTextblock){if(e?!e.endOfTextblock("backward",n):o.parentOffset>0)return!1;s=Ai(o)}var a=s&&s.nodeBefore;return!(!a||!w.isSelectable(a)||(t&&t(n.tr.setSelection(w.create(n.doc,s.pos-a.nodeSize)).scrollIntoView()),0))}),Hi=Ve(Ii,function(n,t,e){var o=n.selection.$cursor;if(!o||(e?!e.endOfTextblock("forward",n):o.parentOffset<o.parent.content.size))return!1;var i=Pi(o);if(!i)return!1;var s=i.nodeAfter;if(Li(n,i,t))return!0;if(0==o.parent.content.size&&(ve(s,"start")||w.isSelectable(s))){var a=Fn(n.doc,o.before(),o.after(),b.empty);if(a.slice.size<a.to-a.from){if(t){var c=n.tr.step(a);c.setSelection(ve(s,"start")?D.findFrom(c.doc.resolve(c.mapping.map(i.pos)),1):w.create(c.doc,c.mapping.map(i.pos))),t(c.scrollIntoView())}return!0}}return!(!s.isAtom||i.depth!=o.depth-1||(t&&t(n.tr.delete(i.pos,i.pos+s.nodeSize).scrollIntoView()),0))},function(n,t,e){var r=n.selection,o=r.$head,s=o;if(!r.empty)return!1;if(o.parent.isTextblock){if(e?!e.endOfTextblock("forward",n):o.parentOffset<o.parent.content.size)return!1;s=Pi(o)}var a=s&&s.nodeAfter;return!(!a||!w.isSelectable(a)||(t&&t(n.tr.setSelection(w.create(n.doc,s.pos)).scrollIntoView()),0))}),Rt={Enter:Ve(Ri,Fi,Bi,Cr),"Mod-Enter":zi,Backspace:Mr,"Mod-Backspace":Mr,"Shift-Backspace":Mr,Delete:Hi,"Mod-Delete":Hi,"Mod-a":function(n,t){return t&&t(n.tr.setSelection(new It(n.doc))),!0}},Ji={"Ctrl-h":Rt.Backspace,"Alt-Backspace":Rt["Mod-Backspace"],"Ctrl-d":Rt.Delete,"Ctrl-Alt-Backspace":Rt["Mod-Delete"],"Alt-Delete":Rt["Mod-Delete"],"Alt-d":Rt["Mod-Delete"],"Ctrl-a":qc,"Ctrl-e":Wc};for(var qi in Rt)Ji[qi]=Rt[qi];var Qc=("undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):"undefined"!=typeof os&&"darwin"==os.platform())?Ji:Rt,zt=function(t,e){var n;this.match=t,this.handler="string"==typeof e?(n=e,function(t,e,r,o){var i=n;if(e[1]){var s=e[0].lastIndexOf(e[1]);i+=e[0].slice(s+e[1].length);var a=(r+=s)-o;a>0&&(i=e[0].slice(s-a,s)+i,r=o)}return t.tr.insertText(i,r,o)}):e};function Wi(n,t,e,r,o,i){if(n.composing)return!1;var s=n.state,a=s.doc.resolve(t);if(a.parent.type.spec.code)return!1;for(var c=a.parent.textBetween(Math.max(0,a.parentOffset-500),a.parentOffset,null,"\ufffc")+r,l=0;l<o.length;l++){var f=o[l].match.exec(c),p=f&&o[l].handler(s,f,t-(f[0].length-r.length),e);if(p)return n.dispatch(p.setMeta(i,{transform:p,from:t,to:e,text:r})),!0}return!1}var $c=new zt(/--$/,"\u2014"),tl=new zt(/\.\.\.$/,"\u2026"),il=[new zt(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"\u201c"),new zt(/"$/,"\u201d"),new zt(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"\u2018"),new zt(/'$/,"\u2019")];function Sr(n,t,e,r){return new zt(n,function(o,i,s,a){var c=e instanceof Function?e(i):e,l=o.tr.delete(s,a),p=l.doc.resolve(s).blockRange(),h=p&&An(p,t,c);if(!h)return null;l.wrap(p,h);var d=l.doc.resolve(s-1).nodeBefore;return d&&d.type==t&&Pn(l.doc,s-1)&&(!r||r(i,d))&&l.join(s-1),l})}function Zi(n,t,e){return new zt(n,function(r,o,i,s){var a=r.doc.resolve(i),c=e instanceof Function?e(o):e;return a.node(-1).canReplaceWith(a.index(-1),a.indexAfter(-1),t)?r.tr.delete(i,s).setBlockType(i,i,t,c):null})}const wr=(n,t)=>{const{from:e,$from:r,to:o,empty:i}=n.selection;return i?Boolean(t.isInSet(n.storedMarks||r.marks())):n.doc.rangeHasMark(e,o,t)},Ui=(n,t,e={})=>{const{selection:r}=n,{$from:o,to:i}=r,s=((n,t)=>{for(let e=t.depth;e>0;e-=1)if(t.node(e).type===n)return t.node(e).type;return null})(t,o);return Object.entries(e).length&&s?i<=o.end()&&o.parent.hasMarkup(t,e):Boolean(s)},Ki=n=>{const t=[],{selection:{from:e,to:r}}=n;return n.doc.nodesBetween(e,r,o=>{t.push(o)}),t},ji=(n,t,e)=>{for(const r of t){const{$from:o,$to:i}=r;let s=0===o.depth&&n.type.allowsMarkType(e);if(n.nodesBetween(o.pos,i.pos,a=>!s&&(s=a.inlineContent&&a.type.allowsMarkType(e),!0)),s)return!0}return!1},Qi=(n,t,e)=>new zt(n,(r,o,i,s)=>{const{tr:a}=r,c=i;let l=s;if(o[2]){const f=i+o[0].indexOf(o[2]),p=f+o[2].length;p<s&&a.delete(p,s),f>i&&a.delete(i,f),l=i+o[2].length}return a.addMark(c,l,t.create(e))}),Yi=(n,t={})=>(e,r)=>{const{tr:o,selection:i}=e,{empty:s,ranges:a,$from:c,$to:l}=i;if(s&&i instanceof F){const{$cursor:f}=i;if(!f||!ji(e.doc,a,n)||(o.addStoredMark(n.create(t)),!o.storedMarksSet))return!1;null==r||r(o)}else{if(o.addMark(c.pos,l.pos,n.create(t)),!o.docChanged)return!1;null==r||r(o.scrollIntoView())}return!0};for(var ul=ct(9075),Zt={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"},pn={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"},Gi="undefined"!=typeof navigator&&/Chrome\/(\d+)/.exec(navigator.userAgent),fl="undefined"!=typeof navigator&&/Apple Computer/.test(navigator.vendor),pl="undefined"!=typeof navigator&&/Gecko\/\d+/.test(navigator.userAgent),Xi="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),hl="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),dl=Gi&&(Xi||+Gi[1]<57)||pl&&Xi,j=0;j<10;j++)Zt[48+j]=Zt[96+j]=String(j);for(j=1;j<=24;j++)Zt[j+111]="F"+j;for(j=65;j<=90;j++)Zt[j]=String.fromCharCode(j+32),pn[j]=String.fromCharCode(j);for(var Nr in Zt)pn.hasOwnProperty(Nr)||(pn[Nr]=Zt[Nr]);var ml="undefined"!=typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform);function vl(n){var t=n.split(/-(?!$)/),e=t[t.length-1];"Space"==e&&(e=" ");for(var r,o,i,s,a=0;a<t.length-1;a++){var c=t[a];if(/^(cmd|meta|m)$/i.test(c))s=!0;else if(/^a(lt)?$/i.test(c))r=!0;else if(/^(c|ctrl|control)$/i.test(c))o=!0;else if(/^s(hift)?$/i.test(c))i=!0;else{if(!/^mod$/i.test(c))throw new Error("Unrecognized modifier name: "+c);ml?s=!0:o=!0}}return r&&(e="Alt-"+e),o&&(e="Ctrl-"+e),s&&(e="Meta-"+e),i&&(e="Shift-"+e),e}function Or(n,t,e){return t.altKey&&(n="Alt-"+n),t.ctrlKey&&(n="Ctrl-"+n),t.metaKey&&(n="Meta-"+n),!1!==e&&t.shiftKey&&(n="Shift-"+n),n}function hn(n){return new _t({props:{handleKeyDown:_l(n)}})}function _l(n){var t=function(n){var t=Object.create(null);for(var e in n)t[vl(e)]=n[e];return t}(n);return function(e,r){var s,o=function(n){var e=!(dl&&(n.ctrlKey||n.altKey||n.metaKey)||(fl||hl)&&n.shiftKey&&n.key&&1==n.key.length)&&n.key||(n.shiftKey?pn:Zt)[n.keyCode]||n.key||"Unidentified";return"Esc"==e&&(e="Escape"),"Del"==e&&(e="Delete"),"Left"==e&&(e="ArrowLeft"),"Up"==e&&(e="ArrowUp"),"Right"==e&&(e="ArrowRight"),"Down"==e&&(e="ArrowDown"),e}(r),i=1==o.length&&" "!=o,a=t[Or(o,r,!i)];if(a&&a(e.state,e.dispatch,e))return!0;if(i&&(r.shiftKey||r.altKey||r.metaKey||o.charCodeAt(0)>127)&&(s=Zt[r.keyCode])&&s!=o){var c=t[Or(s,r,!0)];if(c&&c(e.state,e.dispatch,e))return!0}else if(i&&r.shiftKey){var l=t[Or(o,r,!0)];if(l&&l(e.state,e.dispatch,e))return!0}return!1}}var Q=function(){};Q.prototype.append=function(t){return t.length?(t=Q.from(t),!this.length&&t||t.length<200&&this.leafAppend(t)||this.length<200&&t.leafPrepend(this)||this.appendInner(t)):this},Q.prototype.prepend=function(t){return t.length?Q.from(t).append(this):this},Q.prototype.appendInner=function(t){return new xl(this,t)},Q.prototype.slice=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.length),t>=e?Q.empty:this.sliceInner(Math.max(0,t),Math.min(this.length,e))},Q.prototype.get=function(t){if(!(t<0||t>=this.length))return this.getInner(t)},Q.prototype.forEach=function(t,e,r){void 0===e&&(e=0),void 0===r&&(r=this.length),e<=r?this.forEachInner(t,e,r,0):this.forEachInvertedInner(t,e,r,0)},Q.prototype.map=function(t,e,r){void 0===e&&(e=0),void 0===r&&(r=this.length);var o=[];return this.forEach(function(i,s){return o.push(t(i,s))},e,r),o},Q.from=function(t){return t instanceof Q?t:t&&t.length?new $i(t):Q.empty};var $i=function(n){function t(r){n.call(this),this.values=r}n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t;var e={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(o,i){return 0==o&&i==this.length?this:new t(this.values.slice(o,i))},t.prototype.getInner=function(o){return this.values[o]},t.prototype.forEachInner=function(o,i,s,a){for(var c=i;c<s;c++)if(!1===o(this.values[c],a+c))return!1},t.prototype.forEachInvertedInner=function(o,i,s,a){for(var c=i-1;c>=s;c--)if(!1===o(this.values[c],a+c))return!1},t.prototype.leafAppend=function(o){if(this.length+o.length<=200)return new t(this.values.concat(o.flatten()))},t.prototype.leafPrepend=function(o){if(this.length+o.length<=200)return new t(o.flatten().concat(this.values))},e.length.get=function(){return this.values.length},e.depth.get=function(){return 0},Object.defineProperties(t.prototype,e),t}(Q);Q.empty=new $i([]);var xl=function(n){function t(e,r){n.call(this),this.left=e,this.right=r,this.length=e.length+r.length,this.depth=Math.max(e.depth,r.depth)+1}return n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},t.prototype.forEachInner=function(r,o,i,s){var a=this.left.length;if(o<a&&!1===this.left.forEachInner(r,o,Math.min(i,a),s)||i>a&&!1===this.right.forEachInner(r,Math.max(o-a,0),Math.min(this.length,i)-a,s+a))return!1},t.prototype.forEachInvertedInner=function(r,o,i,s){var a=this.left.length;if(o>a&&!1===this.right.forEachInvertedInner(r,o-a,Math.max(i,a)-a,s+a)||i<a&&!1===this.left.forEachInvertedInner(r,Math.min(o,a),i,s))return!1},t.prototype.sliceInner=function(r,o){if(0==r&&o==this.length)return this;var i=this.left.length;return o<=i?this.left.slice(r,o):r>=i?this.right.slice(r-i,o-i):this.left.slice(r,i).append(this.right.slice(0,o-i))},t.prototype.leafAppend=function(r){var o=this.right.leafAppend(r);if(o)return new t(this.left,o)},t.prototype.leafPrepend=function(r){var o=this.left.leafPrepend(r);if(o)return new t(o,this.right)},t.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new t(this.left,new t(this.right,r)):new t(this,r)},t}(Q);const ts=Q;var Y=function(t,e){this.items=t,this.eventCount=e};Y.prototype.popEvent=function(t,e){var s,a,r=this;if(0==this.eventCount)return null;for(var o=this.items.length;;o--)if(this.items.get(o-1).selection){--o;break}e&&(s=this.remapping(o,this.items.length),a=s.maps.length);var l,f,c=t.tr,p=[],h=[];return this.items.forEach(function(d,g){if(!d.step)return s||(s=r.remapping(o,g+1),a=s.maps.length),a--,void h.push(d);if(s){h.push(new Tt(d.map));var x,v=d.step.map(s.slice(a));v&&c.maybeStep(v).doc&&p.push(new Tt(x=c.mapping.maps[c.mapping.maps.length-1],null,null,p.length+h.length)),a--,x&&s.appendMap(x,a)}else c.maybeStep(d.step);return d.selection?(l=s?d.selection.map(s.slice(a)):d.selection,f=new Y(r.items.slice(0,o).append(h.reverse().concat(p)),r.eventCount-1),!1):void 0},this.items.length,0),{remaining:f,transform:c,selection:l}},Y.prototype.addTransform=function(t,e,r,o){for(var i=[],s=this.eventCount,a=this.items,c=!o&&a.length?a.get(a.length-1):null,l=0;l<t.steps.length;l++){var h,f=t.steps[l].invert(t.docs[l]),p=new Tt(t.mapping.maps[l],f,e);(h=c&&c.merge(p))&&(p=h,l?i.pop():a=a.slice(0,a.length-1)),i.push(p),e&&(s++,e=null),o||(c=p)}var d=s-r.depth;return d>Ml&&(a=function(n,t){var e;return n.forEach(function(r,o){if(r.selection&&0==t--)return e=o,!1}),n.slice(e)}(a,d),s-=d),new Y(a.append(i),s)},Y.prototype.remapping=function(t,e){var r=new tt;return this.items.forEach(function(o,i){r.appendMap(o.map,null!=o.mirrorOffset&&i-o.mirrorOffset>=t?r.maps.length-o.mirrorOffset:null)},t,e),r},Y.prototype.addMaps=function(t){return 0==this.eventCount?this:new Y(this.items.append(t.map(function(e){return new Tt(e)})),this.eventCount)},Y.prototype.rebased=function(t,e){if(!this.eventCount)return this;var r=[],o=Math.max(0,this.items.length-e),i=t.mapping,s=t.steps.length,a=this.eventCount;this.items.forEach(function(d){d.selection&&a--},o);var c=e;this.items.forEach(function(d){var g=i.getMirror(--c);if(null!=g){s=Math.min(s,g);var v=i.maps[g];if(d.step){var x=t.steps[g].invert(t.docs[g]),C=d.selection&&d.selection.map(i.slice(c+1,g));C&&a++,r.push(new Tt(v,x,C))}else r.push(new Tt(v))}},o);for(var l=[],f=e;f<s;f++)l.push(new Tt(i.maps[f]));var p=this.items.slice(0,o).append(l).append(r),h=new Y(p,a);return h.emptyItemCount()>500&&(h=h.compress(this.items.length-r.length)),h},Y.prototype.emptyItemCount=function(){var t=0;return this.items.forEach(function(e){e.step||t++}),t},Y.prototype.compress=function(t){void 0===t&&(t=this.items.length);var e=this.remapping(0,t),r=e.maps.length,o=[],i=0;return this.items.forEach(function(s,a){if(a>=t)o.push(s),s.selection&&i++;else if(s.step){var c=s.step.map(e.slice(r)),l=c&&c.getMap();if(r--,l&&e.appendMap(l,r),c){var f=s.selection&&s.selection.map(e.slice(r));f&&i++;var h,p=new Tt(l.invert(),c,f),d=o.length-1;(h=o.length&&o[d].merge(p))?o[d]=h:o.push(p)}}else s.map&&r--},this.items.length,0),new Y(ts.from(o.reverse()),i)},Y.empty=new Y(ts.empty,0);var Tt=function(t,e,r,o){this.map=t,this.step=e,this.selection=r,this.mirrorOffset=o};Tt.prototype.merge=function(t){if(this.step&&t.step&&!t.selection){var e=t.step.merge(this.step);if(e)return new Tt(e.getMap().invert(),e,this.selection)}};var Ut=function(t,e,r,o){this.done=t,this.undone=e,this.prevRanges=r,this.prevTime=o},Ml=20;function es(n){var t=[];return n.forEach(function(e,r,o,i){return t.push(o,i)}),t}function Tr(n,t){if(!n)return null;for(var e=[],r=0;r<n.length;r+=2){var o=t.map(n[r],1),i=t.map(n[r+1],-1);o<=i&&e.push(o,i)}return e}function ns(n,t,e,r){var o=gn(t),i=Et.get(t).spec.config,s=(r?n.undone:n.done).popEvent(t,o);if(s){var a=s.selection.resolve(s.transform.doc),c=(r?n.done:n.undone).addTransform(s.transform,t.selection.getBookmark(),i,o),l=new Ut(r?c:s.remaining,r?s.remaining:c,null,0);e(s.transform.setSelection(a).setMeta(Et,{redo:r,historyState:l}).scrollIntoView())}}var Er=!1,rs=null;function gn(n){var t=n.plugins;if(rs!=t){Er=!1,rs=t;for(var e=0;e<t.length;e++)if(t[e].spec.historyPreserveItems){Er=!0;break}}return Er}var Et=new xt("history"),is=new xt("closeHistory");function ss(n,t){var e=Et.getState(n);return!(!e||0==e.done.eventCount||(t&&ns(e,n,t,!1),0))}function Dr(n,t){var e=Et.getState(n);return!(!e||0==e.undone.eventCount||(t&&ns(e,n,t,!0),0))}const Ol=["imgEl"];function Tl(n,t){if(1&n){const e=u.EpF();u.TgZ(0,"span",4),u.TgZ(1,"span",5),u.NdJ("mousedown",function(o){return u.CHM(e),u.oxw().startResizing(o,"left")}),u.qZA(),u.TgZ(2,"span",6),u.NdJ("mousedown",function(o){return u.CHM(e),u.oxw().startResizing(o,"right")}),u.qZA(),u.TgZ(3,"span",7),u.NdJ("mousedown",function(o){return u.CHM(e),u.oxw().startResizing(o,"left")}),u.qZA(),u.TgZ(4,"span",8),u.NdJ("mousedown",function(o){return u.CHM(e),u.oxw().startResizing(o,"right")}),u.qZA(),u.qZA()}}const El=function(n){return{"NgxEditor__Resizer--Active":n}},Dl=["ngxEditor"],Il=["*"];function Al(n,t){if(1&n&&(u.TgZ(0,"div",12),u._uU(1),u.qZA()),2&n){const e=u.oxw(2);u.xp6(1),u.hij(" ",(null==e.href.errors?null:e.href.errors.pattern)&&"Please enter valid url."," ")}}function Pl(n,t){if(1&n&&(u.TgZ(0,"div",12),u._uU(1),u.qZA()),2&n){const e=u.oxw(2);u.xp6(1),u.hij(" ",(null==e.text.errors?null:e.text.errors.required)&&"This is required"," ")}}function Rl(n,t){if(1&n){const e=u.EpF();u.TgZ(0,"div",2),u.TgZ(1,"form",3),u.NdJ("ngSubmit",function(o){return u.CHM(e),u.oxw().insertLink(o)}),u.TgZ(2,"div",4),u.TgZ(3,"div",5),u.TgZ(4,"label",6),u._uU(5),u.qZA(),u._UZ(6,"input",7),u.YNc(7,Al,2,1,"div",8),u.qZA(),u.qZA(),u.TgZ(8,"div",4),u.TgZ(9,"div",5),u.TgZ(10,"label",6),u._uU(11),u.qZA(),u._UZ(12,"input",9),u.YNc(13,Pl,2,1,"div",8),u.qZA(),u.qZA(),u.TgZ(14,"div",4),u.TgZ(15,"div",5),u.TgZ(16,"label"),u._UZ(17,"input",10),u._uU(18),u.qZA(),u.qZA(),u.qZA(),u.TgZ(19,"button",11),u._uU(20),u.qZA(),u.qZA(),u.qZA()}if(2&n){const e=u.oxw();u.xp6(1),u.Q6J("formGroup",e.form),u.xp6(4),u.Oqu(e.getLabel("url")),u.xp6(2),u.Q6J("ngIf",e.href.touched&&e.href.invalid),u.xp6(4),u.Oqu(e.getLabel("text")),u.xp6(2),u.Q6J("ngIf",e.text.touched&&e.text.invalid),u.xp6(5),u.hij(" ",e.getLabel("openInNewTab")," "),u.xp6(1),u.Q6J("disabled",!e.form.valid),u.xp6(1),u.Oqu(e.getLabel("insert"))}}function zl(n,t){if(1&n&&(u.TgZ(0,"div",12),u._uU(1),u.qZA()),2&n){const e=u.oxw(2);u.xp6(1),u.hij(" ",(null==e.src.errors?null:e.src.errors.pattern)&&"Please enter valid url."," ")}}function Fl(n,t){if(1&n){const e=u.EpF();u.TgZ(0,"div",2),u.TgZ(1,"form",3),u.NdJ("ngSubmit",function(o){return u.CHM(e),u.oxw().insertLink(o)}),u.TgZ(2,"div",4),u.TgZ(3,"div",5),u.TgZ(4,"label",6),u._uU(5),u.qZA(),u._UZ(6,"input",7),u.YNc(7,zl,2,1,"div",8),u.qZA(),u.qZA(),u.TgZ(8,"div",4),u.TgZ(9,"div",5),u.TgZ(10,"label",6),u._uU(11),u.qZA(),u._UZ(12,"input",9),u.qZA(),u.qZA(),u.TgZ(13,"div",4),u.TgZ(14,"div",5),u.TgZ(15,"label",6),u._uU(16),u.qZA(),u._UZ(17,"input",10),u.qZA(),u.qZA(),u.TgZ(18,"button",11),u._uU(19),u.qZA(),u.qZA(),u.qZA()}if(2&n){const e=u.oxw();u.xp6(1),u.Q6J("formGroup",e.form),u.xp6(4),u.Oqu(e.getLabel("url")),u.xp6(2),u.Q6J("ngIf",e.src.touched&&e.src.invalid),u.xp6(4),u.Oqu(e.getLabel("altText")),u.xp6(5),u.Oqu(e.getLabel("title")),u.xp6(2),u.Q6J("disabled",!e.form.valid||!e.form.dirty),u.xp6(1),u.Oqu(e.getLabel("insert"))}}const Bl=function(n,t){return{"NgxEditor__Dropdown--Active":n,"NgxEditor--Disabled":t}};function Ll(n,t){if(1&n){const e=u.EpF();u.TgZ(0,"div",4),u.NdJ("mousedown",function(o){const s=u.CHM(e).$implicit;return u.oxw(2).onClick(o,s)}),u._uU(1),u.qZA()}if(2&n){const e=t.$implicit,r=u.oxw(2);u.Q6J("ngClass",u.WLB(2,Bl,e===r.activeItem,r.disabledItems.includes(e))),u.xp6(1),u.hij(" ",r.getName(e)," ")}}function Vl(n,t){if(1&n&&(u.TgZ(0,"div",2),u.YNc(1,Ll,2,5,"div",3),u.qZA()),2&n){const e=u.oxw();u.xp6(1),u.Q6J("ngForOf",e.items)("ngForTrackBy",e.trackByIndex)}}const Hl=function(n,t){return{backgroundColor:n,color:t}},Jl=function(n){return{"NgxEditor__Color--Active":n}};function ql(n,t){if(1&n){const e=u.EpF();u.TgZ(0,"button",7),u.NdJ("mousedown",function(o){const s=u.CHM(e).$implicit;return u.oxw(3).onColorSelect(o,s)}),u.qZA()}if(2&n){const e=t.$implicit,r=u.oxw(3);u.Q6J("ngStyle",u.WLB(3,Hl,e,r.getContrastYIQ(e)))("title",e)("ngClass",u.VKq(6,Jl,r.activeColors.includes(e)))}}function Wl(n,t){if(1&n&&(u.TgZ(0,"div",5),u.YNc(1,ql,1,8,"button",6),u.qZA()),2&n){const e=t.$implicit,r=u.oxw(2);u.xp6(1),u.Q6J("ngForOf",e)("ngForTrackBy",r.trackByIndex)}}function Zl(n,t){if(1&n){const e=u.EpF();u.TgZ(0,"div",2),u.YNc(1,Wl,2,2,"div",3),u.TgZ(2,"button",4),u.NdJ("mousedown",function(o){return u.CHM(e),u.oxw().remove(o)}),u._uU(3),u.qZA(),u.qZA()}if(2&n){const e=u.oxw();u.xp6(1),u.Q6J("ngForOf",e.presets)("ngForTrackBy",e.trackByIndex),u.xp6(1),u.Q6J("disabled",!e.isActive),u.xp6(1),u.hij(" ",e.getLabel("remove")," ")}}function Ul(n,t){if(1&n&&u._UZ(0,"ngx-toggle-command",7),2&n){const e=u.oxw().$implicit,r=u.oxw(2);u.Tol(r.iconContainerClass),u.Q6J("toolbarItem",e)}}function Kl(n,t){if(1&n&&u._UZ(0,"ngx-link"),2&n){const e=u.oxw(3);u.Tol(e.iconContainerClass)}}function jl(n,t){if(1&n&&u._UZ(0,"ngx-image"),2&n){const e=u.oxw(3);u.Tol(e.iconContainerClass)}}function Ql(n,t){if(1&n&&u._UZ(0,"ngx-dropdown",9),2&n){const e=t.$implicit,r=u.oxw(4);u.Tol(r.dropdownContainerClass),u.Q6J("group",e.key)("items",e.value)}}function Yl(n,t){if(1&n&&(u.ynx(0),u.YNc(1,Ql,1,4,"ngx-dropdown",8),u.ALo(2,"keyvalue"),u.BQk()),2&n){const e=u.oxw().$implicit,r=u.oxw(2);u.xp6(1),u.Q6J("ngForOf",u.lcZ(2,2,r.getDropdownItems(e)))("ngForTrackBy",r.trackByIndex)}}function Gl(n,t){if(1&n&&u._UZ(0,"ngx-color-picker",10),2&n){const e=u.oxw(3);u.Tol(e.iconContainerClass),u.Q6J("presets",e.presets)}}function Xl(n,t){if(1&n&&u._UZ(0,"ngx-color-picker",11),2&n){const e=u.oxw(3);u.Tol(e.iconContainerClass),u.Q6J("presets",e.presets)}}function $l(n,t){if(1&n&&u._UZ(0,"div"),2&n){const e=u.oxw(3);u.Tol(e.seperatorClass)}}function tu(n,t){if(1&n&&(u.ynx(0),u.YNc(1,Ul,1,3,"ngx-toggle-command",3),u.YNc(2,Kl,1,2,"ngx-link",4),u.YNc(3,jl,1,2,"ngx-image",4),u.YNc(4,Yl,3,4,"ng-container",2),u.YNc(5,Gl,1,3,"ngx-color-picker",5),u.YNc(6,Xl,1,3,"ngx-color-picker",6),u.YNc(7,$l,1,2,"div",4),u.BQk()),2&n){const e=t.$implicit,r=t.last,o=u.oxw().last,i=u.oxw();u.xp6(1),u.Q6J("ngIf",i.toggleCommands.includes(e)),u.xp6(1),u.Q6J("ngIf","link"===e),u.xp6(1),u.Q6J("ngIf","image"===e),u.xp6(1),u.Q6J("ngIf",i.isDropDown(e)),u.xp6(1),u.Q6J("ngIf","text_color"===e),u.xp6(1),u.Q6J("ngIf","background_color"===e),u.xp6(1),u.Q6J("ngIf",r&&!o)}}function eu(n,t){if(1&n&&(u.ynx(0),u.YNc(1,tu,8,7,"ng-container",1),u.BQk()),2&n){const e=t.$implicit,r=u.oxw();u.xp6(1),u.Q6J("ngForOf",e)("ngForTrackBy",r.trackByIndex)}}function nu(n,t){if(1&n&&(u.ynx(0),u.GkF(1,12),u.BQk()),2&n){const e=u.oxw();u.xp6(1),u.Q6J("ngTemplateOutlet",e.customMenuRef)}}const ru=function(n,t){return{"NgxEditor--Disabled":n,"NgxEditor__MenuBar--Reverse":t}},cu=(n=!0)=>new _t({key:new xt("editable"),state:{init:()=>n,apply(t,e){var r;return null!==(r=t.getMeta("UPDATE_EDITABLE"))&&void 0!==r?r:e}},props:{editable(t){return this.getState(t)},attributes(t){return this.getState(t)?null:{class:"NgxEditor__Content--Disabled"}}}}),uu=n=>new _t({key:new xt("placeholder"),state:{init:()=>null!=n?n:"",apply(t,e){var r;return null!==(r=t.getMeta("UPDATE_PLACEHOLDER"))&&void 0!==r?r:e}},props:{decorations(t){const{doc:e}=t,{textContent:r,childCount:o}=e,i=this.getState(t);if(!i||o>1)return I.empty;const s=[];return e.descendants((c,l)=>{var f;if(c.type.isBlock&&0===c.childCount&&0===r.length){const d=J.node(l,l+c.nodeSize,{class:"NgxEditor__Placeholder","data-placeholder":i,"data-align":null!==(f=c.attrs.align)&&void 0!==f?f:null});s.push(d)}return!1}),I.create(e,s)}}}),as=n=>new _t({key:new xt("focus"),props:{handleDOMEvents:{focus:()=>(n(),!1)}}});let hu=(()=>{class n{constructor(){this.alt="",this.title="",this.outerWidth="",this.selected=!1,this.imageResize=new u.vpe}startResizing(e,r){e.preventDefault(),this.resizeImage(e,r)}resizeImage(e,r){const o=e.pageX,i=this.imgEl.nativeElement.clientWidth,s="left"===r,{width:a}=window.getComputedStyle(this.view.dom),c=parseInt(a,10),l=p=>{const d=p.pageX-o,g=s?i-d:i+d;g>c||g<20||(this.outerWidth=`${g}px`)},f=p=>{p.preventDefault(),document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",f),this.imageResize.emit()};document.addEventListener("mousemove",l),document.addEventListener("mouseup",f)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=u.Xpm({type:n,selectors:[["ngx-image-view"]],viewQuery:function(e,r){if(1&e&&u.Gf(Ol,7),2&e){let o;u.iGM(o=u.CRH())&&(r.imgEl=o.first)}},inputs:{src:"src",alt:"alt",title:"title",outerWidth:"outerWidth",selected:"selected",view:"view"},outputs:{imageResize:"imageResize"},decls:4,vars:9,consts:[[1,"NgxEditor__ImageWrapper",3,"ngClass"],["class","NgxEditor__ResizeHandle",4,"ngIf"],[3,"src","alt","title"],["imgEl",""],[1,"NgxEditor__ResizeHandle"],[1,"NgxEditor__ResizeHandle--TL",3,"mousedown"],[1,"NgxEditor__ResizeHandle--TR",3,"mousedown"],[1,"NgxEditor__ResizeHandle--BL",3,"mousedown"],[1,"NgxEditor__ResizeHandle--BR",3,"mousedown"]],template:function(e,r){1&e&&(u.TgZ(0,"span",0),u.YNc(1,Tl,5,0,"span",1),u._UZ(2,"img",2,3),u.qZA()),2&e&&(u.Udp("width",r.outerWidth),u.Q6J("ngClass",u.VKq(7,El,r.selected)),u.xp6(1),u.Q6J("ngIf",r.selected),u.xp6(1),u.Q6J("src",r.src,u.LSH)("alt",r.alt)("title",r.title))},directives:[q.mk,q.O5],styles:["*[_ngcontent-%COMP%], *[_ngcontent-%COMP%]:before, *[_ngcontent-%COMP%]:after{box-sizing:border-box}img[_ngcontent-%COMP%]{width:100%;height:100%}.NgxEditor__ImageWrapper[_ngcontent-%COMP%]{position:relative;display:inline-block;line-height:0;padding:2px}.NgxEditor__ImageWrapper.NgxEditor__Resizer--Active[_ngcontent-%COMP%]{padding:1px;border:1px solid #1a73e8}.NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]{position:absolute;height:100%;width:100%}.NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle--TL[_ngcontent-%COMP%], .NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle--BL[_ngcontent-%COMP%], .NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle--TR[_ngcontent-%COMP%], .NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle--BR[_ngcontent-%COMP%]{position:absolute;width:7px;height:7px;background-color:#1a73e8;border:1px solid white}.NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle--BR[_ngcontent-%COMP%]{bottom:-5px;right:-5px;cursor:se-resize}.NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle--TR[_ngcontent-%COMP%]{top:-5px;right:-5px;cursor:ne-resize}.NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle--TL[_ngcontent-%COMP%]{top:-5px;left:-5px;cursor:nw-resize}.NgxEditor__ImageWrapper[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle[_ngcontent-%COMP%]   .NgxEditor__ResizeHandle--BL[_ngcontent-%COMP%]{bottom:-5px;left:-5px;cursor:sw-resize}"]}),n})();class du{constructor(t,e,r,o){this.updating=!1,this.handleResize=()=>{if(this.updating)return;const{state:a,dispatch:c}=this.view,{tr:l}=a,f=l.setNodeMarkup(this.getPos(),void 0,Object.assign(Object.assign({},this.node.attrs),{width:this.imageComponentRef.instance.outerWidth})),p=f.doc.resolve(this.getPos()),h=new w(p);f.setSelection(h),c(f)};const i=o.get(u._Vd);this.applicationRef=o.get(u.z2F);const s=i.resolveComponentFactory(hu);this.imageComponentRef=s.create(o,[]),this.applicationRef.attachView(this.imageComponentRef.hostView),this.setNodeAttributes(t.attrs),this.imageComponentRef.instance.view=e,this.dom=this.imageComponentRef.location.nativeElement,this.view=e,this.node=t,this.getPos=r,this.resizeSubscription=this.imageComponentRef.instance.imageResize.subscribe(()=>{this.handleResize()})}computeChanges(t,e){return JSON.stringify(t)===JSON.stringify(e)}setNodeAttributes(t){this.imageComponentRef.instance.src=t.src,this.imageComponentRef.instance.alt=t.alt,this.imageComponentRef.instance.title=t.title,this.imageComponentRef.instance.outerWidth=t.width}update(t){return t.type===this.node.type&&(this.node=t,this.computeChanges(this.node.attrs,t.attrs)&&(this.updating=!0,this.setNodeAttributes(t.attrs),this.updating=!1),!0)}ignoreMutation(){return!0}selectNode(){this.imageComponentRef.instance.selected=!0}deselectNode(){this.imageComponentRef.instance.selected=!1}destroy(){this.resizeSubscription.unsubscribe(),this.applicationRef.detachView(this.imageComponentRef.hostView)}}const mu=/(?:https?:\/\/)?[\w-]+(?:\.[\w-]+)+\.?(?:\d+)?(?:\/\S*)?$/,cs=n=>{const t=[];return n.forEach(e=>{if(e.isText){const r=e.text;let o=0;const i=mu.exec(r);if(i){const s=i.index,a=s+i[0].length,{link:c}=e.type.schema.marks;s>0&&t.push(e.cut(o,s));const l=r.slice(s,a);t.push(e.cut(s,a).mark(c.create({href:l}).addToSet(e.marks))),o=a}o<r.length&&t.push(e.cut(o))}else t.push(e.copy(cs(e.content)))}),m.fromArray(t)},yu={type:"doc",content:[{type:"paragraph"}]},He=(n,t)=>{if(!n)return t.nodeFromJSON(yu);if("string"!=typeof n)return t.nodeFromJSON(n);const e=((n,t)=>{const e=null!=t?t:ee,r=document.createElement("div");return r.innerHTML=n,dt.fromSchema(e).parse(r).toJSON()})(n,t);return t.nodeFromJSON(e)};let bu=(()=>{class n{constructor(e,r,o){this.renderer=e,this.injector=r,this.elementRef=o,this.placeholder="Type Here...",this.focusOut=new u.vpe,this.focusIn=new u.vpe,this.subscriptions=[],this.onChange=()=>{},this.onTouched=()=>{}}writeValue(e){!this.outputFormat&&"string"==typeof e&&(this.outputFormat="html"),this.editor.setContent(null!=e?e:"")}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this.setMeta("UPDATE_EDITABLE",!e),this.renderer.setProperty(this.elementRef.nativeElement,"disabled",e)}handleChange(e){if("html"!==this.outputFormat)this.onChange(e);else{const r=((n,t)=>{const e=null!=t?t:ee,r=e.nodeFromJSON(n),o=Z.fromSchema(e).serializeFragment(r.content),i=document.createElement("div");return i.appendChild(o),i.innerHTML})(e,this.editor.schema);this.onChange(r)}}setMeta(e,r){const{dispatch:o,state:{tr:i}}=this.editor.view;o(i.setMeta(e,r))}setPlaceholder(e){this.setMeta("UPDATE_PLACEHOLDER",e)}registerPlugins(){this.editor.registerPlugin(cu()),this.editor.registerPlugin(uu(this.placeholder)),this.editor.registerPlugin(((n={})=>new _t({key:new xt("attributes"),props:{attributes:n}}))({class:"NgxEditor__Content"})),this.editor.registerPlugin(as(()=>{this.focusIn.emit()})),this.editor.registerPlugin(as(()=>{this.focusIn.emit()})),this.editor.registerPlugin((n=>new _t({key:new xt("blur"),props:{handleDOMEvents:{blur:()=>(n(),!1)}}}))(()=>{this.focusOut.emit(),this.onTouched()})),this.editor.features.resizeImage&&this.editor.registerPlugin((n=>new _t({key:new xt("image-resize"),props:{nodeViews:{image:(t,e,r)=>new du(t,e,r,n)}}}))(this.injector)),this.editor.features.linkOnPaste&&this.editor.registerPlugin(new _t({key:new xt("linkify"),props:{transformPasted:n=>new b(cs(n.content),n.openStart,n.openEnd)}}))}ngOnInit(){if(!this.editor)throw new Error("NgxEditor: Required editor instance");this.registerPlugins(),this.renderer.appendChild(this.ngxEditor.nativeElement,this.editor.view.dom);const e=this.editor.valueChanges.subscribe(r=>{this.handleChange(r)});this.subscriptions.push(e)}ngOnChanges(e){(null==e?void 0:e.placeholder)&&!e.placeholder.isFirstChange()&&this.setPlaceholder(e.placeholder.currentValue)}ngOnDestroy(){this.subscriptions.forEach(e=>{e.unsubscribe()})}}return n.\u0275fac=function(e){return new(e||n)(u.Y36(u.Qsj),u.Y36(u.zs3),u.Y36(u.SBq))},n.\u0275cmp=u.Xpm({type:n,selectors:[["ngx-editor"]],viewQuery:function(e,r){if(1&e&&u.Gf(Dl,7),2&e){let o;u.iGM(o=u.CRH())&&(r.ngxEditor=o.first)}},inputs:{editor:"editor",outputFormat:"outputFormat",placeholder:"placeholder"},outputs:{focusOut:"focusOut",focusIn:"focusIn"},features:[u._Bn([{provide:E.JU,useExisting:(0,u.Gpc)(()=>n),multi:!0}]),u.TTD],ngContentSelectors:Il,decls:3,vars:0,consts:[[1,"NgxEditor"],["ngxEditor",""]],template:function(e,r){1&e&&(u.F$t(),u.TgZ(0,"div",0,1),u.Hsn(2),u.qZA())},styles:['.NgxEditor{background:white;color:#000;background-clip:padding-box;border-radius:4px;border:1px solid rgba(0,0,0,.2);position:relative}.NgxEditor--Disabled{opacity:.5;pointer-events:none}.NgxEditor__Placeholder:before{color:#6c757d;opacity:1;-webkit-user-select:none;user-select:none;position:absolute;cursor:text;content:attr(data-placeholder)}.NgxEditor__Placeholder[data-align=right]:before{position:relative}.NgxEditor__Content{padding:8px;white-space:pre-wrap;outline:none;font-variant-ligatures:none;font-feature-settings:"liga" 0,none}.NgxEditor__Content p{margin:0 0 10px}.NgxEditor__Content blockquote{padding-left:16px;border-left:3px solid #ddd;margin-left:0;margin-right:0}.NgxEditor__Content--Disabled{-webkit-user-select:none;user-select:none;pointer-events:none}.NgxEditor__Wrapper{border:1px solid rgba(0,0,0,.4);border-radius:4px}.NgxEditor__Wrapper .NgxEditor__MenuBar{border-top-left-radius:4px;border-top-right-radius:4px;border-bottom:1px solid rgba(0,0,0,.2)}.NgxEditor__Wrapper .NgxEditor{border-top-left-radius:0;border-top-right-radius:0;border:none}.NgxEditor__MenuBar{display:flex;flex-wrap:wrap;padding:3px;cursor:default;background-color:#fff}.NgxEditor__MenuItem{border-radius:2px;display:flex;align-items:center;justify-content:center;position:relative;flex-shrink:0}.NgxEditor__MenuItem:hover{background-color:#f1f1f1}.NgxEditor__MenuItem.NgxEditor__MenuItem--Icon{height:30px;width:30px;transition:.3s ease-in-out}.NgxEditor__MenuItem.NgxEditor__MenuItem--Icon+.NgxEditor__MenuItem--Icon{margin-left:2px}.NgxEditor__MenuItem .NgxEditor__MenuItem--IconContainer{display:flex;height:100%;width:100%;align-items:center;justify-content:center}.NgxEditor__MenuItem.NgxEditor__MenuItem--Text{padding:0 5px}.NgxEditor__MenuItem.NgxEditor__MenuItem--Active{background-color:#e8f0fe;color:#1a73e8}.NgxEditor__Dropdown{min-width:64px;position:relative;display:flex;align-items:center;flex-shrink:0}.NgxEditor__Dropdown:hover{background-color:#f1f1f1}.NgxEditor__Dropdown .NgxEditor__Dropdown--Text{display:flex;align-items:center;justify-content:center;padding:0 5px;height:100%;width:100%}.NgxEditor__Dropdown .NgxEditor__Dropdown--Text:after{display:inline-block;content:"";margin-left:24px;vertical-align:4px;border-top:4px solid;border-right:4px solid transparent;border-bottom:0;border-left:4px solid transparent}.NgxEditor__Dropdown .NgxEditor__Dropdown--DropdownMenu{position:absolute;left:0;box-shadow:#3c404326 0 2px 6px 2px;border-radius:4px;background-color:#fff;z-index:10;width:100%;top:32px}.NgxEditor__Dropdown .NgxEditor__Dropdown--Item{padding:8px;white-space:nowrap;color:inherit}.NgxEditor__Dropdown .NgxEditor__Dropdown--Item:hover{background-color:#ececec}.NgxEditor__Dropdown.NgxEditor__Dropdown--Selected,.NgxEditor__Dropdown.NgxEditor__Dropdown--Open{background-color:#e8f0fe}.NgxEditor__Dropdown.NgxEditor__Dropdown--Selected .NgxEditor__Dropdown--Text,.NgxEditor__Dropdown.NgxEditor__Dropdown--Open .NgxEditor__Dropdown--Text{color:#1a73e8}.NgxEditor__Dropdown .NgxEditor__Dropdown--Active{background-color:#f1f1f1}.NgxEditor__Dropdown .NgxEditor__Dropdown--Active:hover{background-color:#e7e7e7}.NgxEditor__MenuBar--Reverse .NgxEditor__Dropdown--DropdownMenu{top:unset;bottom:32px}.NgxEditor__MenuBar--Reverse .NgxEditor__Dropdown--Text:after{transform:rotate(180deg)}.NgxEditor__MenuBar--Reverse .NgxEditor__Popup{top:unset;bottom:32px}.NgxEditor__Popup{position:absolute;top:32px;box-shadow:#3c404326 0 2px 6px 2px;border-radius:4px;background-color:#fff;z-index:10;min-width:192px;padding:8px}.NgxEditor__Popup .NgxEditor__Popup--FormGroup{margin-bottom:8px}.NgxEditor__Popup .NgxEditor__Popup--FormGroup label{margin-bottom:3px}.NgxEditor__Popup .NgxEditor__Popup--FormGroup input[type=text],.NgxEditor__Popup .NgxEditor__Popup--FormGroup input[type=url]{padding:2px 4px}.NgxEditor__Popup .NgxEditor__Popup--Col{display:flex;flex-direction:column;position:relative}.NgxEditor__Popup .NgxEditor__Popup--Label{font-size:85%}.NgxEditor__Seperator{border-left:1px solid #ccc;margin:0 5px}.NgxEditor__HelpText{font-size:80%}.NgxEditor__HelpText.NgxEditor__HelpText--Error{color:red}\n'],encapsulation:2}),n})(),ne=(()=>{class n{constructor(){this.customMenuRefChange=new xr.xQ}setCustomMenuRef(e){this.customMenuRefChange.next(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=u.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Ju={bold:'\n  <path d="M15.6 10.79c.97-.67 1.65-1.77 1.65-2.79 0-2.26-1.75-4-4-4H7v14h7.04c2.09 0 3.71-1.7 3.71-3.79 0-1.52-.86-2.82-2.15-3.42zM10 6.5h3c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5h-3v-3zm3.5 9H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5z" />\n',italic:'\n  <path d="M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4z" />\n',code:'\n<path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/>\n',underline:'\n<path d="M12 17c3.31 0 6-2.69 6-6V3h-2.5v8c0 1.93-1.57 3.5-3.5 3.5S8.5 12.93 8.5 11V3H6v8c0 3.31 2.69 6 6 6zm-7 2v2h14v-2H5z"/>\n',strike:'\n<path d="M6.85,7.08C6.85,4.37,9.45,3,12.24,3c1.64,0,3,0.49,3.9,1.28c0.77,0.65,1.46,1.73,1.46,3.24h-3.01 c0-0.31-0.05-0.59-0.15-0.85c-0.29-0.86-1.2-1.28-2.25-1.28c-1.86,0-2.34,1.02-2.34,1.7c0,0.48,0.25,0.88,0.74,1.21 C10.97,8.55,11.36,8.78,12,9H7.39C7.18,8.66,6.85,8.11,6.85,7.08z M21,12v-2H3v2h9.62c1.15,0.45,1.96,0.75,1.96,1.97 c0,1-0.81,1.67-2.28,1.67c-1.54,0-2.93-0.54-2.93-2.51H6.4c0,0.55,0.08,1.13,0.24,1.58c0.81,2.29,3.29,3.3,5.67,3.3 c2.27,0,5.3-0.89,5.3-4.05c0-0.3-0.01-1.16-0.48-1.94H21V12z"/>\n',ordered_list:'\n<path d="M2 17h2v.5H3v1h1v.5H2v1h3v-4H2v1zm1-9h1V4H2v1h1v3zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2v1zm5-6v2h14V5H7zm0 14h14v-2H7v2zm0-6h14v-2H7v2z"/>\n',bullet_list:'\n<path d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"/>\n',blockquote:'\n<path d="M0 0h24v24H0z" fill="none"/><path d="M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z"/>\n',link:'\n<path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>\n',unlink:'\n<path d="M17 7h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.43-.98 2.63-2.31 2.98l1.46 1.46C20.88 15.61 22 13.95 22 12c0-2.76-2.24-5-5-5zm-1 4h-2.19l2 2H16zM2 4.27l3.11 3.11C3.29 8.12 2 9.91 2 12c0 2.76 2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1 0-1.59 1.21-2.9 2.76-3.07L8.73 11H8v2h2.73L13 15.27V17h1.73l4.01 4L20 19.74 3.27 3 2 4.27z"/>\n',image:'\n<path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>\n',align_left:'\n<path d="M15 15H3v2h12v-2zm0-8H3v2h12V7zM3 13h18v-2H3v2zm0 8h18v-2H3v2zM3 3v2h18V3H3z"/>\n',align_center:'\n<path d="M7 15v2h10v-2H7zm-4 6h18v-2H3v2zm0-8h18v-2H3v2zm4-6v2h10V7H7zM3 3v2h18V3H3z"/>\n',align_right:'\n<path d="M3 21h18v-2H3v2zm6-4h12v-2H9v2zm-6-4h18v-2H3v2zm6-4h12V7H9v2zM3 3v2h18V3H3z"/>\n',align_justify:'\n<path d="M3 21h18v-2H3v2zm0-4h18v-2H3v2zm0-4h18v-2H3v2zm0-4h18V7H3v2zm0-6v2h18V3H3z"/>\n',text_color:'\n<path d="M2,20h20v4H2V20z M5.49,17h2.42l1.27-3.58h5.65L16.09,17h2.42L13.25,3h-2.5L5.49,17z M9.91,11.39l2.03-5.79h0.12l2.03,5.79 H9.91z"/>\n',color_fill:'\n<path d="M16.56,8.94L7.62,0L6.21,1.41l2.38,2.38L3.44,8.94c-0.59,0.59-0.59,1.54,0,2.12l5.5,5.5C9.23,16.85,9.62,17,10,17 s0.77-0.15,1.06-0.44l5.5-5.5C17.15,10.48,17.15,9.53,16.56,8.94z M5.21,10L10,5.21L14.79,10H5.21z M19,11.5c0,0-2,2.17-2,3.5 c0,1.1,0.9,2,2,2s2-0.9,2-2C21,13.67,19,11.5,19,11.5z M2,20h20v4H2V20z"/>\n'};class mn{static get(t,e="currentColor"){return`\n      <svg\n        xmlns="http://www.w3.org/2000/svg"\n        viewBox="0 0 24 24"\n        fill=${e}\n        height=20\n        width=20\n      >\n        ${Ju[t]||"<path></path>"}\n      </svg>\n    `}}class _e{constructor(t){this.name=t}apply(){return(t,e)=>{const{schema:r}=t,o=r.marks[this.name];return!!o&&Yi(o)(t,e)}}toggle(){return(t,e)=>{const{schema:r}=t,o=r.marks[this.name];return!!o&&ye(o)(t,e)}}isActive(t){const{schema:e}=t,r=e.marks[this.name];return!!r&&wr(t,r)}canExecute(t){return this.toggle()(t)}}class vn{constructor(t=!1){this.isBulletList=!1,this.isBulletList=t}getType(t){return this.isBulletList?t.nodes.bullet_list:t.nodes.ordered_list}toggle(){return(t,e)=>{const{schema:r}=t,o=this.getType(r);return!!o&&(this.isActive(t)?Ti(r.nodes.list_item)(t,e):function(n,t){return function(e,r){var o=e.selection,i=o.$from,s=o.$to,a=i.blockRange(s),c=!1,l=a;if(!a)return!1;if(a.depth>=2&&i.node(a.depth-1).type.compatibleContent(n)&&0==a.startIndex){if(0==i.index(a.depth-1))return!1;var f=e.doc.resolve(a.start-2);l=new ke(f,f,a.depth),a.endIndex<a.parent.childCount&&(a=new ke(i,e.doc.resolve(s.end(a.depth)),a.depth)),c=!0}var p=An(l,n,t,a);return!!p&&(r&&r(function(n,t,e,r,o){for(var i=m.empty,s=e.length-1;s>=0;s--)i=m.from(e[s].type.create(e[s].attrs,i));n.step(new ft(t.start-(r?2:0),t.end,t.start,t.end,new b(i,0,0),e.length,!0));for(var a=0,c=0;c<e.length;c++)e[c].type==o&&(a=c+1);for(var l=e.length-a,f=t.start+e.length-(r?2:0),p=t.parent,h=t.startIndex,d=t.endIndex,g=!0;h<d;h++,g=!1)!g&&ue(n.doc,f,l)&&(n.split(f,l),f+=2*l),f+=p.child(h).nodeSize;return n}(e.tr,a,p,c,n).scrollIntoView()),!0)}}(o)(t,e))}}isActive(t){const{schema:e}=t,r=this.getType(e);return!!r&&Ui(t,r)}canExecute(t){return this.toggle()(t)}}class re{constructor(t){this.level=t}apply(){return(t,e)=>{const{schema:r}=t,o=r.nodes.heading;return!!o&&kr(o)(t,e)}}toggle(){return(t,e)=>{var r;const{schema:o,selection:i,doc:s}=t,a=o.nodes.heading;if(!a)return!1;const c=i.$from.before(1),l=s.nodeAt(c),f=null!==(r=null==l?void 0:l.attrs)&&void 0!==r?r:{};return this.isActive(t)?kr(o.nodes.paragraph,f)(t,e):kr(a,Object.assign(Object.assign({},f),{level:this.level}))(t,e)}}isActive(t){const{schema:e}=t,r=Ki(t),o=e.nodes.heading;if(!o)return!1;const i=[o,e.nodes.text,e.nodes.blockquote],a=r.filter(c=>i.includes(c.type)).find(c=>c.attrs.level===this.level);return Boolean(a)}canExecute(t){return this.toggle()(t)}}class Je{constructor(t){this.align=t}toggle(){return(t,e)=>{const{doc:r,selection:o,tr:i,schema:s}=t,{from:a,to:c}=o;let l=!1;return r.nodesBetween(a,c,(f,p)=>{const h=f.type;return[s.nodes.paragraph,s.nodes.heading].includes(h)&&(l=!0,i.setNodeMarkup(p,h,Object.assign(Object.assign({},f.attrs),{align:this.align}))),!0}),!!l&&(i.docChanged&&(null==e||e(i)),!0)}}isActive(t){const r=Ki(t).find(o=>o.attrs.align===this.align);return Boolean(r)}canExecute(t){return this.toggle()(t)}}const Wu={strict:!0};class Ir{update(t){return(e,r)=>{const{schema:o,selection:i}=e,s=o.marks.link;return!(!s||i.empty)&&ye(s,t)(e,r)}}insert(t,e){return(r,o)=>{var i,s;const{schema:a,tr:c}=r;if(!a.marks.link)return!1;const f={href:e.href,title:null!==(i=e.title)&&void 0!==i?i:t,target:null!==(s=e.target)&&void 0!==s?s:"_blank"},p=a.text(t,[a.marks.link.create(f)]);return c.replaceSelectionWith(p,!1).scrollIntoView(),!!c.docChanged&&(null==o||o(c),!0)}}isActive(t,e=Wu){if(e.strict)return!0;const{schema:r}=t,o=r.marks.link;return!!o&&wr(t,o)}remove(t,e){return((n,t)=>{const{doc:e,selection:r,tr:o}=n,{$head:{pos:i},from:s,to:a}=r;if(s===a){const c=e.resolve(i),l=i-c.textOffset,f=l+c.parent.child(c.index()).nodeSize;o.removeMark(l,f)}else o.removeMark(s,a);return!!o.docChanged&&(null==t||t(o),!0)})(t,e)}canExecute(t){const e={href:""};return this.insert("Exec",e)(t)||this.update(e)(t)}}class ls{insert(t,e){return(r,o)=>{const{schema:i,tr:s,selection:a}=r,c=i.nodes.image;if(!c)return!1;const l=Object.assign({width:null,src:t},e);!l.width&&a instanceof w&&a.node.type===c&&(l.width=a.node.attrs.width),s.replaceSelectionWith(c.createAndFill(l));const f=s.doc.resolve(s.selection.anchor-s.selection.$anchor.nodeBefore.nodeSize);return s.setSelection(new w(f)).scrollIntoView(),!!s.docChanged&&(null==o||o(s),!0)}}isActive(t){const{selection:e}=t;return e instanceof w&&"image"===e.node.type.name}}class xe{constructor(t,e="color"){this.name=t,this.attrName=e}apply(t){return(e,r)=>{const{schema:o,selection:i,doc:s}=e,a=o.marks[this.name];if(!a)return!1;const{from:c,to:l,empty:f}=i;if(!f&&c+1===l){const p=s.nodeAt(c);if((null==p?void 0:p.isAtom)&&!p.isText&&p.isLeaf)return!1}return Yi(a,t)(e,r)}}isActive(t){const{schema:e}=t,r=e.marks[this.name];return!!r&&wr(t,r)}getActiveColors(t){if(!this.isActive(t))return[];const{schema:e}=t;return(n=>{let t=[];const{selection:e,storedMarks:r}=n,{from:o,to:i,empty:s,$from:a}=e;return s?t=r||a.marks():n.doc.nodesBetween(o,i,c=>{t=[...t,...c.marks]}),t})(t).filter(i=>i.type===e.marks[this.name]).map(i=>i.attrs[this.attrName]).filter(Boolean)}remove(){return(t,e)=>{const{schema:r}=t,o=r.marks[this.name];return!!o&&(n=o,(t,e)=>{const{tr:r,selection:o,storedMarks:i,doc:s}=t,{empty:a,ranges:c}=o;if(a&&o instanceof F){const{$cursor:l}=o;if(!l||!ji(t.doc,c,n))return!1;if(n.isInSet(i||l.marks()))return r.removeStoredMark(n),null==e||e(r),!0}else{for(const l of c){const{$from:f,$to:p}=l;s.rangeHasMark(f.pos,p.pos,n)&&r.removeMark(f.pos,p.pos,n)}if(!r.docChanged)return!1;null==e||e(r.scrollIntoView())}return!1})(t,e);var n}}canExecute(t){return this.apply("text_color"===this.name?{color:""}:{backgroundColor:""})(t)}}const Zu=new _e("strong"),Uu=new _e("em"),Ku=new _e("code"),ju=new _e("u"),Qu=new _e("s"),Yu=new class{toggle(){return(t,e)=>{const{schema:r}=t,o=r.nodes.blockquote;return!!o&&(this.isActive(t)?function(n,t){var e=n.selection,i=e.$from.blockRange(e.$to),s=i&&Se(i);return null!=s&&(t&&t(n.tr.lift(i,s).scrollIntoView()),!0)}(t,e):(n=o,function(e,r){var o=e.selection,a=o.$from.blockRange(o.$to),c=a&&An(a,n,void 0);return!!c&&(r&&r(e.tr.wrap(a,c).scrollIntoView()),!0)})(t,e));var n}}isActive(t){const{schema:e}=t,r=e.nodes.blockquote;return!!r&&Ui(t,r)}canExecute(t){return this.toggle()(t)}},Gu=new vn(!0),Xu=new vn(!1),$u=new re(1),tf=new re(2),ef=new re(3),nf=new re(4),rf=new re(5),of=new re(6),sf=new Je("left"),af=new Je("center"),cf=new Je("right"),lf=new Je("justify"),uf=new Ir,ff=new ls,pf=new xe("text_color","color"),hf=new xe("text_background_color","backgroundColor"),yn={bold:Zu,italic:Uu,code:Ku,underline:ju,strike:Qu,blockquote:Yu,bullet_list:Gu,ordered_list:Xu,h1:$u,h2:tf,h3:ef,h4:nf,h5:rf,h6:of,align_left:sf,align_center:af,align_right:cf,align_justify:lf},qe=uf,us=ff,df=pf,gf=hf,fs={bold:"Bold",italic:"Italic",code:"Code",underline:"Underline",strike:"Strike",blockquote:"Blockquote",bullet_list:"Bullet List",ordered_list:"Ordered List",heading:"Heading",h1:"Header 1",h2:"Header 2",h3:"Header 3",h4:"Header 4",h5:"Header 5",h6:"Header 6",align_left:"Left Align",align_center:"Center Align",align_right:"Right Align",align_justify:"Justify",text_color:"Text Color",background_color:"Background Color",insertLink:"Insert Link",removeLink:"Remove Link",insertImage:"Insert Image",url:"URL",text:"Text",openInNewTab:"Open in new tab",insert:"Insert",altText:"Alt Text",title:"Title",remove:"Remove"};class mf{constructor(t={}){this.locals=fs,this.get=e=>{var r;return null!==(r=this.locals[e])&&void 0!==r?r:""},this.locals=Object.assign(Object.assign({},fs),t)}}let Ar=(()=>{class n{constructor(){this.locals={}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=u.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),be=(()=>{class n{constructor(e){this.config=e}get locals(){return new mf(this.config.locals)}}return n.\u0275fac=function(e){return new(e||n)(u.LFG(Ar,8))},n.\u0275prov=u.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const ps=n=>{var t;return{locals:null!==(t=n.locals)&&void 0!==t?t:{}}};let We=(()=>{class n{constructor(e){this.sanitizer=e}transform(e){return this.sanitizer.bypassSecurityTrustHtml(e)}}return n.\u0275fac=function(e){return new(e||n)(u.Y36(ul.H7,16))},n.\u0275pipe=u.Yjl({name:"sanitizeHtml",type:n,pure:!0}),n})(),vf=(()=>{class n{constructor(e,r){this.ngxeService=e,this.menuService=r,this.isActive=!1,this.disabled=!1,this.update=o=>{const{state:i}=o,s=yn[this.name];this.isActive=s.isActive(i),this.disabled=!s.canExecute(i)}}get name(){return this.toolbarItem}toggle(e){if(e.preventDefault(),0!==e.button)return;const{state:r,dispatch:o}=this.editorView;yn[this.name].toggle()(r,o)}getTitle(e){return this.ngxeService.locals.get(e)}ngOnInit(){this.html=mn.get(this.name),this.editorView=this.menuService.editor.view,this.updateSubscription=this.menuService.editor.update.subscribe(e=>{this.update(e)})}ngOnDestroy(){this.updateSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(u.Y36(be),u.Y36(ne))},n.\u0275cmp=u.Xpm({type:n,selectors:[["ngx-toggle-command"]],hostVars:4,hostBindings:function(e,r){2&e&&u.ekj("NgxEditor__MenuItem--Active",r.isActive)("NgxEditor--Disabled",r.disabled)},inputs:{toolbarItem:"toolbarItem"},decls:2,vars:4,consts:[[1,"NgxEditor__MenuItem--IconContainer",3,"innerHTML","title","mousedown"]],template:function(e,r){1&e&&(u.TgZ(0,"div",0),u.NdJ("mousedown",function(i){return r.toggle(i)}),u.ALo(1,"sanitizeHtml"),u.qZA()),2&e&&u.Q6J("innerHTML",u.lcZ(1,2,r.html),u.oJD)("title",r.getTitle(r.name))},pipes:[We],styles:[""]}),n})(),yf=(()=>{class n{constructor(e,r,o){this.el=e,this.ngxeService=r,this.menuService=o,this.showPopup=!1,this.isActive=!1,this.canExecute=!0,this.form=new E.cw({href:new E.NI("",[E.kI.required,E.kI.pattern("(https?://)?([\\da-z.-]+)\\.([a-z.]{2,6})[/\\w .-]*/??([^#\n\r]*)?#?([^\n\r]*)")]),text:new E.NI("",[E.kI.required]),openInNewTab:new E.NI(!0)}),this.setText=()=>{const{state:{selection:i,doc:s}}=this.editorView,{empty:a,from:c,to:l}=i,f=a?"":s.textBetween(c,l);f&&(this.text.patchValue(f),this.text.disable())},this.update=i=>{const{state:s}=i;this.isActive=qe.isActive(s,{strict:!1}),this.canExecute=qe.canExecute(s)}}get valid(){return this.isActive||this.showPopup}get disabled(){return!this.canExecute}get icon(){return mn.get(this.isActive?"unlink":"link")}get title(){return this.ngxeService.locals.get(this.isActive?"removeLink":"insertLink")}get href(){return this.form.get("href")}get text(){return this.form.get("text")}onDocumentClick(e){!this.el.nativeElement.contains(e.target)&&this.showPopup&&this.hideForm()}getLabel(e){return this.ngxeService.locals.get(e)}hideForm(){this.showPopup=!1,this.form.reset({href:"",text:"",openInNewTab:!0}),this.text.enable()}onMouseDown(e){if(0!==e.button)return;const{state:r,dispatch:o}=this.editorView;this.isActive?qe.remove(r,o):(this.showPopup=!this.showPopup,this.showPopup&&this.setText())}insertLink(e){e.preventDefault();const{text:r,href:o,openInNewTab:i}=this.form.getRawValue(),{dispatch:s,state:a}=this.editorView,{selection:c}=a,l={title:o,href:o,target:i?"_blank":"_self"};c.empty?(qe.insert(r,l)(a,s),this.editorView.focus()):qe.update(l)(a,s),this.hideForm()}ngOnInit(){this.editorView=this.menuService.editor.view,this.updateSubscription=this.menuService.editor.update.subscribe(e=>{this.update(e)})}ngOnDestroy(){this.updateSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(u.Y36(u.SBq),u.Y36(be),u.Y36(ne))},n.\u0275cmp=u.Xpm({type:n,selectors:[["ngx-link"]],hostVars:4,hostBindings:function(e,r){1&e&&u.NdJ("mousedown",function(i){return r.onDocumentClick(i)},!1,u.evT),2&e&&u.ekj("NgxEditor__MenuItem--Active",r.valid)("NgxEditor--Disabled",r.disabled)},decls:3,vars:5,consts:[[1,"NgxEditor__MenuItem--IconContainer",3,"innerHTML","title","mousedown"],["class","NgxEditor__Popup",4,"ngIf"],[1,"NgxEditor__Popup"],[1,"NgxEditor__Popup--Form",3,"formGroup","ngSubmit"],[1,"NgxEditor__Popup--FormGroup"],[1,"NgxEditor__Popup--Col"],[1,"NgxEditor__Popup--Label"],["type","href","id","href","formControlName","href","autofocus","","autocomplete","off"],["class","NgxEditor__HelpText NgxEditor__HelpText--Error",4,"ngIf"],["type","text","formControlName","text","autocomplete","off"],["type","checkbox","formControlName","openInNewTab"],["type","submit",3,"disabled"],[1,"NgxEditor__HelpText","NgxEditor__HelpText--Error"]],template:function(e,r){1&e&&(u.TgZ(0,"div",0),u.NdJ("mousedown",function(i){return r.onMouseDown(i)}),u.ALo(1,"sanitizeHtml"),u.qZA(),u.YNc(2,Rl,21,8,"div",1)),2&e&&(u.Q6J("innerHTML",u.lcZ(1,3,r.icon),u.oJD)("title",r.title),u.xp6(2),u.Q6J("ngIf",r.showPopup))},directives:[q.O5,E._Y,E.JL,E.sg,E.Fj,E.JJ,E.u,E.Wl],pipes:[We],styles:[""]}),n})(),_f=(()=>{class n{constructor(e,r,o){this.el=e,this.ngxeService=r,this.menuService=o,this.showPopup=!1,this.isActive=!1,this.form=new E.cw({src:new E.NI("",[E.kI.required,E.kI.pattern("(https?://)?([\\da-z.-]+)\\.([a-z.]{2,6})[/\\w .-]*/??([^#\n\r]*)?#?([^\n\r]*)")]),alt:new E.NI(""),title:new E.NI("")}),this.update=i=>{const{state:s}=i;this.isActive=us.isActive(s)}}get valid(){return this.isActive||this.showPopup}get icon(){return mn.get("image")}get src(){return this.form.get("src")}onDocumentClick(e){!this.el.nativeElement.contains(e.target)&&this.showPopup&&this.hideForm()}getLabel(e){return this.ngxeService.locals.get(e)}hideForm(){this.showPopup=!1,this.form.reset({src:"",alt:"",title:""})}onMouseDown(e){0===e.button&&(this.showPopup=!this.showPopup,this.showPopup&&this.fillForm())}fillForm(){const{state:e}=this.editorView,{selection:r}=e;if(r instanceof w&&this.isActive){const{src:o,alt:i="",title:s=""}=r.node.attrs;this.form.setValue({src:o,alt:i,title:s})}}insertLink(e){e.preventDefault();const{src:r,alt:o,title:i}=this.form.getRawValue(),{dispatch:s,state:a}=this.editorView;us.insert(r,{alt:o,title:i})(a,s),this.editorView.focus(),this.hideForm()}ngOnInit(){this.editorView=this.menuService.editor.view,this.updateSubscription=this.menuService.editor.update.subscribe(e=>{this.update(e)})}ngOnDestroy(){this.updateSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(u.Y36(u.SBq),u.Y36(be),u.Y36(ne))},n.\u0275cmp=u.Xpm({type:n,selectors:[["ngx-image"]],hostVars:2,hostBindings:function(e,r){1&e&&u.NdJ("mousedown",function(i){return r.onDocumentClick(i)},!1,u.evT),2&e&&u.ekj("NgxEditor__MenuItem--Active",r.valid)},decls:3,vars:5,consts:[[1,"NgxEditor__MenuItem--IconContainer",3,"innerHTML","title","mousedown"],["class","NgxEditor__Popup",4,"ngIf"],[1,"NgxEditor__Popup"],[1,"NgxEditor__Popup--Form",3,"formGroup","ngSubmit"],[1,"NgxEditor__Popup--FormGroup"],[1,"NgxEditor__Popup--Col"],[1,"NgxEditor__Popup--Label"],["type","href","id","href","formControlName","src","autofocus","","autocomplete","off"],["class","NgxEditor__HelpText NgxEditor__HelpText--Error",4,"ngIf"],["type","text","formControlName","alt","autocomplete","off"],["type","text","formControlName","title","autocomplete","off"],["type","submit",3,"disabled"],[1,"NgxEditor__HelpText","NgxEditor__HelpText--Error"]],template:function(e,r){1&e&&(u.TgZ(0,"div",0),u.NdJ("mousedown",function(i){return r.onMouseDown(i)}),u.ALo(1,"sanitizeHtml"),u.qZA(),u.YNc(2,Fl,20,7,"div",1)),2&e&&(u.Q6J("innerHTML",u.lcZ(1,3,r.icon),u.oJD)("title",r.getLabel("insertImage")),u.xp6(2),u.Q6J("ngIf",r.showPopup))},directives:[q.O5,E._Y,E.JL,E.sg,E.Fj,E.JJ,E.u],pipes:[We],styles:[""]}),n})(),xf=(()=>{class n{constructor(e,r,o){this.ngxeService=e,this.menuService=r,this.el=o,this.isDropdownOpen=!1,this.disabledItems=[],this.update=i=>{const{state:s}=i;this.disabledItems=[];const a=[];this.items.forEach(c=>{const l=yn[c];l.isActive(s)&&a.push(c),l.canExecute(s)||this.disabledItems.push(c)}),1===a.length?[this.activeItem]=a:this.activeItem=null}}get isSelected(){return Boolean(this.activeItem||this.isDropdownOpen)}get isDropdownDisabled(){return this.disabledItems.length===this.items.length}onDocumentClick(e){!this.el.nativeElement.contains(e)&&this.isDropdownOpen&&(this.isDropdownOpen=!1)}getName(e){return this.ngxeService.locals.get(e)}toggleDropdown(e){e.preventDefault(),this.isDropdownOpen=!this.isDropdownOpen}trackByIndex(e){return e}onClick(e,r){if(e.preventDefault(),0!==e.button)return;const o=yn[r],{state:i,dispatch:s}=this.editorView;o.toggle()(i,s),this.isDropdownOpen=!1}ngOnInit(){this.editorView=this.menuService.editor.view,this.updateSubscription=this.menuService.editor.update.subscribe(e=>{this.update(e)})}ngOnDestroy(){this.updateSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(u.Y36(be),u.Y36(ne),u.Y36(u.SBq))},n.\u0275cmp=u.Xpm({type:n,selectors:[["ngx-dropdown"]],hostVars:4,hostBindings:function(e,r){1&e&&u.NdJ("mousedown",function(i){return r.onDocumentClick(i.target)},!1,u.evT),2&e&&u.ekj("NgxEditor__Dropdown--Selected",r.isSelected)("NgxEditor--Disabled",r.isDropdownDisabled)},inputs:{group:"group",items:"items"},decls:3,vars:2,consts:[[1,"NgxEditor__Dropdown--Text",3,"mousedown"],["class","NgxEditor__Dropdown--DropdownMenu",4,"ngIf"],[1,"NgxEditor__Dropdown--DropdownMenu"],["class","NgxEditor__Dropdown--Item",3,"ngClass","mousedown",4,"ngFor","ngForOf","ngForTrackBy"],[1,"NgxEditor__Dropdown--Item",3,"ngClass","mousedown"]],template:function(e,r){1&e&&(u.TgZ(0,"div",0),u.NdJ("mousedown",function(i){return r.toggleDropdown(i)}),u._uU(1),u.qZA(),u.YNc(2,Vl,2,2,"div",1)),2&e&&(u.xp6(1),u.hij(" ",r.getName(r.activeItem||r.group),"\n"),u.xp6(1),u.Q6J("ngIf",r.isDropdownOpen))},directives:[q.O5,q.sg,q.mk],styles:[""]}),n})(),bf=(()=>{class n{constructor(e,r,o){this.el=e,this.menuService=r,this.ngxeService=o,this.showPopup=!1,this.isActive=!1,this.activeColors=[],this.canExecute=!0,this.update=i=>{const{state:s}=i;this.canExecute=this.command.canExecute(s),this.isActive=this.command.isActive(s),this.activeColors=[],this.isActive&&(this.activeColors=this.command.getActiveColors(s))}}get valid(){return this.isActive||this.showPopup}get disabled(){return!this.canExecute}get title(){return this.getLabel("text_color"===this.type?"text_color":"background_color")}get icon(){return mn.get("text_color"===this.type?"text_color":"color_fill")}get command(){return"text_color"===this.type?df:gf}getContrastYIQ(e){const r=e.replace("#","");return(299*parseInt(r.substring(0,2),16)+587*parseInt(r.substring(2,4),16)+114*parseInt(r.substring(4,6),16))/1e3>=128?"black":"white"}onDocumentClick(e){!this.el.nativeElement.contains(e.target)&&this.showPopup&&this.hidePopup()}hidePopup(){this.showPopup=!1}togglePopup(e){e.preventDefault(),0===e.button&&(this.showPopup=!this.showPopup)}remove(e){e.preventDefault();const{state:r,dispatch:o}=this.editorView;this.command.remove()(r,o),this.hidePopup()}trackByIndex(e){return e}onColorSelect(e,r){if(e.preventDefault(),0!==e.button)return;const{state:o,dispatch:i}=this.editorView;"text_color"===this.type?this.command.apply({color:r})(o,i):this.command.apply({backgroundColor:r})(o,i),this.editorView.hasFocus()||this.editorView.focus(),this.hidePopup()}getLabel(e){return this.ngxeService.locals.get(e)}ngOnInit(){this.editorView=this.menuService.editor.view,this.updateSubscription=this.menuService.editor.update.subscribe(e=>{this.update(e)})}ngOnDestroy(){this.updateSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(u.Y36(u.SBq),u.Y36(ne),u.Y36(be))},n.\u0275cmp=u.Xpm({type:n,selectors:[["ngx-color-picker"]],hostVars:4,hostBindings:function(e,r){1&e&&u.NdJ("mousedown",function(i){return r.onDocumentClick(i)},!1,u.evT),2&e&&u.ekj("NgxEditor__MenuItem--Active",r.valid)("NgxEditor--Disabled",r.disabled)},inputs:{presets:"presets",type:"type"},decls:3,vars:5,consts:[[1,"NgxEditor__MenuItem--IconContainer",3,"innerHTML","title","mousedown"],["class","NgxEditor__Popup",4,"ngIf"],[1,"NgxEditor__Popup"],["class","NgxEditor__ColorContainer",4,"ngFor","ngForOf","ngForTrackBy"],[1,"NgxEditor__MenuItem--Button",3,"disabled","mousedown"],[1,"NgxEditor__ColorContainer"],["class","NgxEditor__Color",3,"ngStyle","title","ngClass","mousedown",4,"ngFor","ngForOf","ngForTrackBy"],[1,"NgxEditor__Color",3,"ngStyle","title","ngClass","mousedown"]],template:function(e,r){1&e&&(u.TgZ(0,"div",0),u.NdJ("mousedown",function(i){return r.togglePopup(i)}),u.ALo(1,"sanitizeHtml"),u.qZA(),u.YNc(2,Zl,4,4,"div",1)),2&e&&(u.Q6J("innerHTML",u.lcZ(1,3,r.icon),u.oJD)("title",r.title),u.xp6(2),u.Q6J("ngIf",r.showPopup))},directives:[q.O5,q.sg,q.PC,q.mk],pipes:[We],styles:['@charset "UTF-8";.NgxEditor__Popup[_ngcontent-%COMP%]{width:230px}.NgxEditor__ColorContainer[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.NgxEditor__ColorContainer[_ngcontent-%COMP%] + .NgxEditor__ColorContainer[_ngcontent-%COMP%]{margin-top:5px}.NgxEditor__Color[_ngcontent-%COMP%]{border:none;outline:none;border-radius:6px;width:24px;height:24px;flex-shrink:0}.NgxEditor__Color--Active[_ngcontent-%COMP%]:after{content:"\\2714";font-size:90%}.NgxEditor__MenuItem--Button[_ngcontent-%COMP%]{margin-top:5px}']}),n})();const Cf=[["bold","italic"],[{heading:["h1","h2","h3","h4","h5","h6"]}],["link","image"],["text_color","background_color"]],kf=["#b60205","#d93f0b","#fbca04","#0e8a16","#006b75","#1d76db","#0052cc","#5319e7","#e99695","#f9d0c4","#fef2c0","#c2e0c6","#bfdadc","#c5def5","#bfd4f2","#d4c5f9"];let Mf=(()=>{class n{constructor(e){this.menuService=e,this.toolbar=Cf,this.colorPresets=kf,this.disabled=!1,this.customMenuRef=null,this.dropdownPlacement="bottom",this.toggleCommands=["bold","italic","underline","strike","code","blockquote","ordered_list","bullet_list","align_left","align_center","align_right","align_justify"],this.iconContainerClass=["NgxEditor__MenuItem","NgxEditor__MenuItem--Icon"],this.dropdownContainerClass=["NgxEditor__Dropdown"],this.seperatorClass=["NgxEditor__Seperator"]}get presets(){const r=[];return this.colorPresets.forEach((o,i)=>{const s=Math.floor(i/8);r[s]||r.push([]),r[s].push(o)}),r}trackByIndex(e){return e}isDropDown(e){return!!(null==e?void 0:e.heading)}getDropdownItems(e){return e}ngOnInit(){if(!this.editor)throw new Error("NgxEditor: Required editor instance");this.menuService.editor=this.editor}}return n.\u0275fac=function(e){return new(e||n)(u.Y36(ne))},n.\u0275cmp=u.Xpm({type:n,selectors:[["ngx-editor-menu"]],inputs:{toolbar:"toolbar",colorPresets:"colorPresets",disabled:"disabled",editor:"editor",customMenuRef:"customMenuRef",dropdownPlacement:"dropdownPlacement"},features:[u._Bn([ne])],decls:3,vars:7,consts:[[1,"NgxEditor__MenuBar",3,"ngClass"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],[3,"toolbarItem","class",4,"ngIf"],[3,"class",4,"ngIf"],["type","text_color",3,"class","presets",4,"ngIf"],["type","background_color",3,"class","presets",4,"ngIf"],[3,"toolbarItem"],[3,"class","group","items",4,"ngFor","ngForOf","ngForTrackBy"],[3,"group","items"],["type","text_color",3,"presets"],["type","background_color",3,"presets"],[3,"ngTemplateOutlet"]],template:function(e,r){1&e&&(u.TgZ(0,"div",0),u.YNc(1,eu,2,2,"ng-container",1),u.YNc(2,nu,2,1,"ng-container",2),u.qZA()),2&e&&(u.Q6J("ngClass",u.WLB(4,ru,r.disabled,"top"===r.dropdownPlacement)),u.xp6(1),u.Q6J("ngForOf",r.toolbar)("ngForTrackBy",r.trackByIndex),u.xp6(1),u.Q6J("ngIf",r.customMenuRef))},directives:[q.mk,q.sg,q.O5,vf,yf,_f,xf,bf,q.tP],pipes:[q.Nd],styles:[""]}),n})(),Sf=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=u.oAB({type:n}),n.\u0275inj=u.cJS({providers:[We],imports:[[q.ez,E.UX]]}),n})();const _n=new u.OlP("NgxEditorConfig");let wf=(()=>{class n{static forRoot(e){return{ngModule:n,providers:[{provide:_n,useValue:e},{provide:Ar,useFactory:ps,deps:[_n]}]}}static forChild(e){return{ngModule:n,providers:[{provide:_n,useValue:e},{provide:Ar,useFactory:ps,deps:[_n]},be]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=u.oAB({type:n}),n.\u0275inj=u.cJS({providers:[],imports:[[q.ez,Sf]]}),n})();const hs=n=>null!==n&&"number"==typeof n.length;class Tf{static required(t){return e=>(n=>{if(!n)return!0;const{childCount:t,firstChild:e}=n;return Boolean(1===t&&(null==e?void 0:e.isTextblock)&&0===e.content.size)})(He(e.value,t||ee))?{required:!0}:null}static maxLength(t,e){return r=>{const s=He(r.value,e||ee).textContent;return hs(s)&&s.length>t?{maxlength:{requiredLength:t,actualLength:s.length}}:null}}static minLength(t,e){return r=>{const s=He(r.value,e||ee).textContent;return null!==(n=s)&&0!==n.length&&hs(s)&&s.length<t?{minlength:{requiredLength:t,actualLength:s.length}}:null;var n}}}const yt=(n,t=!1)=>(e,r)=>{const o=new _e(n);return t?o.toggle()(e,r):o.apply()(e,r)};class Ef{constructor(t){if(this.applyTrx=e=>{this.state=this.state.apply(null!=e?e:this.tr),this.tr=this.state.tr,this.tr.setMeta("APPLIED_TRX",!0)},this.dispatch=e=>{this.applyTrx(e)},!t)throw Error("NgxEditor: Required view to initialize commands.");this.view=t,this.state=t.state,this.tr=this.view.state.tr}exec(){if(!this.tr.getMeta("APPLIED_TRX"))return!1;const t=!this.view.state.doc.eq(this.state.doc);this.view.updateState(this.state);const e=this.tr.setMeta("FORCE_EMIT",t);return this.view.dispatch(e),!0}focus(){return this.view.focus(),this}scrollIntoView(){return this.tr.scrollIntoView(),this.applyTrx(),this}insertText(t){return this.tr.insertText(t),this.applyTrx(),this}insertNewLine(){return Ve(Ri,Fi,Bi,Cr)(this.state,this.dispatch),this}applyMark(t){return yt(t,!1)(this.state,this.dispatch),this}toggleMark(t){return yt(t,!0)(this.state,this.dispatch),this}bold(){return yt("strong")(this.state,this.dispatch),this}toggleBold(){return yt("strong",!0)(this.state,this.dispatch),this}italics(){return yt("em")(this.state,this.dispatch),this}toggleItalics(){return yt("em",!0)(this.state,this.dispatch),this}underline(){return yt("u")(this.state,this.dispatch),this}toggleUnderline(){return yt("u",!0)(this.state,this.dispatch),this}strike(){return yt("s")(this.state,this.dispatch),this}toggleStrike(){return yt("s",!0)(this.state,this.dispatch),this}code(){return yt("code")(this.state,this.dispatch),this}toggleCode(){return yt("code",!0)(this.state,this.dispatch),this}toggleOrderedList(){return new vn(!1).toggle()(this.state,this.dispatch),this}toggleBulletList(){return new vn(!0).toggle()(this.state,this.dispatch),this}toggleHeading(t){return new re(t).toggle()(this.state,this.dispatch),this}insertLink(t,e){return(new Ir).insert(t,e)(this.state,this.dispatch),this}updateLink(t){return(new Ir).update(t)(this.state,this.dispatch),this}insertImage(t,e={}){return(new ls).insert(t,e)(this.state,this.dispatch),this}textColor(t){return new xe("text_color").apply({color:t})(this.state,this.dispatch),this}backgroundColor(t){return new xe("text_background_color").apply({backgroundColor:t})(this.state,this.dispatch),this}removeTextColor(){return new xe("text_color").remove()(this.state,this.dispatch),this}removeBackgroundColor(){return new xe("text_background_color").remove()(this.state,this.dispatch),this}align(t){return new Je(t).toggle()(this.state,this.dispatch),this}insertHTML(t){const{selection:e,schema:r,tr:o}=this.state,{from:i,to:s}=e,a=document.createElement("div");a.innerHTML=t.trim();const c=dt.fromSchema(r).parseSlice(a),l=o.replaceRange(i,s,c);return this.applyTrx(l),this}}const Df="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),Lf=n=>{const t=il.concat(tl,$c);return t.push((n=>Qi(/(?:^|\s)(?:(?:\*\*|__)(?:(?:[^*_]+))(?:\*\*|__))$/,n))(n.marks.strong)),t.push((n=>Qi(/(?:^|\s)(?:(?:\*|_)(?:(?:[^*_]+))(?:\*|_))$/,n))(n.marks.em)),t.push((n=>Sr(/^\s*>\s$/,n))(n.nodes.blockquote)),t.push((n=>Sr(/^(?:\d+)\.\s$/,n,t=>({order:Number(t[1])}),(t,e)=>e.childCount+e.attrs.order===Number(t[1])))(n.nodes.ordered_list)),t.push((n=>Sr(/^\s*(?:[-+*])\s$/,n))(n.nodes.bullet_list)),t.push((n=>Zi(/^```$/,n))(n.nodes.code_block)),t.push(((n,t)=>Zi(new RegExp("^(#{1,6})\\s$"),n,e=>({level:e[1].length})))(n.nodes.heading)),function(n){var t=n.rules,e=new _t({state:{init:function(){return null},apply:function(o,i){return o.getMeta(this)||(o.selectionSet||o.docChanged?null:i)}},props:{handleTextInput:function(o,i,s,a){return Wi(o,i,s,a,t,e)},handleDOMEvents:{compositionend:function(r){setTimeout(function(){var i=r.state.selection.$cursor;i&&Wi(r,i.pos,i.pos,"",t,e)})}}},isInputRules:!0});return e}({rules:t})},Hf=(n,t)=>{const e=[];return t.keyboardShortcuts&&e.push(...((n,t)=>{const e={};e["Mod-z"]=ss,Df?e["Shift-Mod-z"]=Dr:e["Mod-y"]=Dr;const r=[hn({"Mod-b":ye(n.marks.strong),"Mod-i":ye(n.marks.em),"Mod-u":ye(n.marks.u),"Mod-`":ye(n.marks.code)}),hn({Enter:mc(n.nodes.list_item),"Shift-Enter":Ve(zi,(o,i)=>{const{tr:s}=o;return i(s.replaceSelectionWith(n.nodes.hard_break.create()).scrollIntoView()),!0}),"Mod-[":Ti(n.nodes.list_item),"Mod-]":Ei(n.nodes.list_item),Tab:Ei(n.nodes.list_item)}),hn(Qc)];return t.history&&r.push(hn(e)),r})(n,{history:t.history})),t.history&&e.push(function(n){return new _t({key:Et,state:{init:function(){return new Ut(Y.empty,Y.empty,null,0)},apply:function(e,r,o){return function(n,t,e,r){var i,o=e.getMeta(Et);if(o)return o.historyState;e.getMeta(is)&&(n=new Ut(n.done,n.undone,null,0));var s=e.getMeta("appendedTransaction");if(0==e.steps.length)return n;if(s&&s.getMeta(Et))return s.getMeta(Et).redo?new Ut(n.done.addTransform(e,null,r,gn(t)),n.undone,es(e.mapping.maps[e.steps.length-1]),n.prevTime):new Ut(n.done,n.undone.addTransform(e,null,r,gn(t)),null,n.prevTime);if(!1===e.getMeta("addToHistory")||s&&!1===s.getMeta("addToHistory"))return(i=e.getMeta("rebased"))?new Ut(n.done.rebased(e,i),n.undone.rebased(e,i),Tr(n.prevRanges,e.mapping),n.prevTime):new Ut(n.done.addMaps(e.mapping.maps),n.undone.addMaps(e.mapping.maps),Tr(n.prevRanges,e.mapping),n.prevTime);var a=0==n.prevTime||!s&&(n.prevTime<(e.time||0)-r.newGroupDelay||!function(n,t){if(!t)return!1;if(!n.docChanged)return!0;var e=!1;return n.mapping.maps[0].forEach(function(r,o){for(var i=0;i<t.length;i+=2)r<=t[i+1]&&o>=t[i]&&(e=!0)}),e}(e,n.prevRanges)),c=s?Tr(n.prevRanges,e.mapping):es(e.mapping.maps[e.steps.length-1]);return new Ut(n.done.addTransform(e,a?t.selection.getBookmark():null,r,gn(t)),Y.empty,c,e.time)}(r,o,e,n)}},config:n={depth:n&&n.depth||100,newGroupDelay:n&&n.newGroupDelay||500},props:{handleDOMEvents:{beforeinput:function(e,r){var o="historyUndo"==r.inputType?ss(e.state,e.dispatch):"historyRedo"==r.inputType&&Dr(e.state,e.dispatch);return o&&r.preventDefault(),o}}}})}()),t.inputRules&&e.push(Lf(n)),e},ds={linkOnPaste:!0,resizeImage:!0},gs={content:null,history:!0,keyboardShortcuts:!0,inputRules:!0,schema:ee,plugins:[],nodeViews:{},attributes:{},features:ds};class Jf{constructor(t=gs){this.valueChangesSubject=new xr.xQ,this.updateSubject=new xr.xQ,this.options=Object.assign(Object.assign({},gs),t),this.createEditor()}get valueChanges(){return this.valueChangesSubject.asObservable()}get update(){return this.updateSubject.asObservable()}get schema(){return this.options.schema||ee}get commands(){return new Ef(this.view)}get features(){return Object.assign(Object.assign({},ds),this.options.features)}handleTransactions(t){const e=this.view.state.apply(t);if(this.view.updateState(e),this.updateSubject.next(this.view),!t.docChanged&&!t.getMeta("FORCE_EMIT"))return;const r=e.doc.toJSON();this.valueChangesSubject.next(r)}createEditor(){var t,e;const{options:r,schema:o}=this,{content:i=null,nodeViews:s}=r,{history:a=!0,keyboardShortcuts:c=!0,inputRules:l=!0}=r,f=He(i,o),p=null!==(t=r.plugins)&&void 0!==t?t:[],h=null!==(e=r.attributes)&&void 0!==e?e:{},d=Hf(o,{history:a,keyboardShortcuts:c,inputRules:l});this.view=new V(null,{state:nt.create({doc:f,schema:o,plugins:[...d,...p]}),nodeViews:s,dispatchTransaction:this.handleTransactions.bind(this),attributes:h})}setContent(t){if(null==t)return;const{state:e}=this.view,{tr:r,doc:o}=e,i=He(t,this.schema);r.replaceWith(0,e.doc.content.size,i),!o.eq(r.doc)&&(!r.docChanged||this.view.dispatch(r))}registerPlugin(t){const{state:e}=this.view,r=[...e.plugins,t],o=e.reconfigure({plugins:r});this.view.updateState(o)}destroy(){this.view.destroy()}}}}]);